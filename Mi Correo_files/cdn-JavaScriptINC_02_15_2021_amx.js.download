(function($){$.browserTest=function(a,z){var u='unknown',x='X',m=function(r,h){for(var i=0;i<h.length;i=i+1){r=r.replace(h[i][0],h[i][1]);}return r;},c=function(i,a,b,c){var r={name:m((a.exec(i)||[u,u])[1],b)};r[r.name]=true;r.version=(c.exec(i)||[x,x,x,x])[3];if(r.name.match(/safari/)&&r.version>400){r.version='2.0';}if(r.name==='presto'){r.version=($.browser.version>9.27)?'futhark':'linear_b';}r.versionNumber=parseFloat(r.version,10)||0;r.versionX=(r.version!==x)?(r.version+'').substr(0,1):x;r.className=r.name+r.versionX;return r;};a=(a.match(/Opera|Navigator|Minefield|KHTML|Chrome/)?m(a,[[/(Firefox|MSIE|KHTML,\slike\sGecko|Konqueror)/,''],['Chrome Safari','Chrome'],['KHTML','Konqueror'],['Minefield','Firefox'],['Navigator','Netscape']]):a).toLowerCase();$.browser=$.extend((!z)?$.browser:{},c(a,/(camino|chrome|firefox|netscape|konqueror|lynx|msie|opera|safari)/,[],/(camino|chrome|firefox|netscape|netscape6|opera|version|konqueror|lynx|msie|safari)(\/|\s)([a-z0-9\.\+]*?)(\;|dev|rel|\s|$)/));$.layout=c(a,/(gecko|konqueror|msie|opera|webkit)/,[['konqueror','khtml'],['msie','trident'],['opera','presto']],/(applewebkit|rv|konqueror|msie)(\:|\/|\s)([a-z0-9\.]*?)(\;|\)|\s)/);$.os={name:(/(win|mac|linux|sunos|solaris|iphone)/.exec(navigator.platform.toLowerCase())||[u])[0].replace('sunos','solaris')};if(!z){$('html').addClass([$.os.name,$.browser.name,$.browser.className,$.layout.name,$.layout.className].join(' '));}};$.browserTest(navigator.userAgent);})(jQuery);/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2006, 2014 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD
		define(['jquery'], factory);
	} else if (typeof exports === 'object') {
		// CommonJS
		factory(require('jquery'));
	} else {
		// Browser globals
		factory(jQuery);
	}
}(function ($) {

	var pluses = /\+/g;

	function encode(s) {
		return config.raw ? s : encodeURIComponent(s);
	}

	function decode(s) {
		return config.raw ? s : decodeURIComponent(s);
	}

	function stringifyCookieValue(value) {
		return encode(config.json ? JSON.stringify(value) : String(value));
	}

	function parseCookieValue(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape...
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}

		try {
			// Replace server-side written pluses with spaces.
			// If we can't decode the cookie, ignore it, it's unusable.
			// If we can't parse the cookie, ignore it, it's unusable.
			s = decodeURIComponent(s.replace(pluses, ' '));
			return config.json ? JSON.parse(s) : s;
		} catch(e) {}
	}

	function read(s, converter) {
		var value = config.raw ? s : parseCookieValue(s);
		return $.isFunction(converter) ? converter(value) : value;
	}

	var config = $.cookie = function (key, value, options) {

		// Write

		if (arguments.length > 1 && !$.isFunction(value)) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setTime(+t + days * 864e+5);
			}

			return (document.cookie = [
				encode(key), '=', stringifyCookieValue(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// Read

		var result = key ? undefined : {};

		// To prevent the for loop in the first place assign an empty array
		// in case there are no cookies at all. Also prevents odd result when
		// calling $.cookie().
		var cookies = document.cookie ? document.cookie.split('; ') : [];

		for (var i = 0, l = cookies.length; i < l; i++) {
			var parts = cookies[i].split('=');
			var name = decode(parts.shift());
			var cookie = parts.join('=');

			if (key && key === name) {
				// If second argument (value) is a function it's a converter...
				result = read(cookie, value);
				break;
			}

			// Prevent storing a cookie that we couldn't decode.
			if (!key && (cookie = read(cookie)) !== undefined) {
				result[name] = cookie;
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		if ($.cookie(key) === undefined) {
			return false;
		}

		// Must not alter options, thus extending a fresh object...
		$.cookie(key, '', $.extend({}, options, { expires: -1 }));
		return !$.cookie(key);
	};

}));
 /*
 * TipTip
 * Copyright 2010 Drew Wilson
 * www.drewwilson.com
 * code.drewwilson.com/entry/tiptip-jquery-plugin
 *
 * Version 1.3   -   Updated: Mar. 23, 2010
 *
 * This Plug-In will create a custom tooltip to replace the default
 * browser tooltip. It is extremely lightweight and very smart in
 * that it detects the edges of the browser window and will make sure
 * the tooltip stays within the current window size. As a result the
 * tooltip will adjust itself to be displayed above, below, to the left 
 * or to the right depending on what is necessary to stay within the
 * browser window. It is completely customizable as well via CSS.
 *
 * This TipTip jQuery plug-in is dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */

(function($){
	$.fn.tipTip = function(options) {
	
	
		//TEMP to disable the tooltips
		return;
	
		var defaults = { 
			activation: "hover",
			keepAlive: false,
			maxWidth: "200px",
			edgeOffset: 3,
			defaultPosition: "bottom",
			delay: 400,
			fadeIn: 200,
			fadeOut: 200,
			attribute: "title",
			content: false, // HTML or String to fill TipTIp with
		  	enter: function(){},
		  	exit: function(){}
	  	};
	 	var opts = $.extend(defaults, options);

	 	// Setup tip tip elements and render them to the DOM
	 	if($("#tiptip_holder").length <= 0){
	 		var tiptip_holder = $('<div id="tiptip_holder" style="max-width:'+ opts.maxWidth +';"></div>');
			var tiptip_content = $('<div id="tiptip_content"></div>');
			var tiptip_arrow = $('<div id="tiptip_arrow"></div>');
			$("body").append(tiptip_holder.html(tiptip_content).prepend(tiptip_arrow.html('<div id="tiptip_arrow_inner"></div>')));
		} else {
			var tiptip_holder = $("#tiptip_holder");
			var tiptip_content = $("#tiptip_content");
			var tiptip_arrow = $("#tiptip_arrow");
		}

		return this.each(function(){
			var org_elem = $(this);
			if(opts.content){
				var org_title = opts.content;
			} else {
				var org_title = org_elem.attr(opts.attribute);
			}
			if(org_title != ""){
				if(!opts.content){
					org_elem.removeAttr(opts.attribute); //remove original Attribute
				}
				var timeout = false;

				if(opts.activation == "hover"){
					org_elem.hover(function(){
						active_tiptip();
					}, function(){
						if(!opts.keepAlive){
							deactive_tiptip();
						}
					});
					if(opts.keepAlive){
						tiptip_holder.hover(function(){}, function(){
							deactive_tiptip();
						});
					}
				} else if(opts.activation == "focus"){
					org_elem.focus(function(){
						active_tiptip();
					}).blur(function(){
						deactive_tiptip();
					});
				} else if(opts.activation == "click"){
					org_elem.click(function(){
						active_tiptip();
						return false;
					}).hover(function(){},function(){
						if(!opts.keepAlive){
							deactive_tiptip();
						}
					});
					if(opts.keepAlive){
						tiptip_holder.hover(function(){}, function(){
							deactive_tiptip();
						});
					}
				}

				function active_tiptip(){
					opts.enter.call(this);
					tiptip_content.html(org_title);
					tiptip_holder.hide().removeAttr("class").css("margin","0");
					tiptip_arrow.removeAttr("style");

					var top = parseInt(org_elem.offset()['top']);
					var left = parseInt(org_elem.offset()['left']);
					var org_width = parseInt(org_elem.outerWidth());
					var org_height = parseInt(org_elem.outerHeight());
					var tip_w = tiptip_holder.outerWidth();
					var tip_h = tiptip_holder.outerHeight();
					var w_compare = Math.round((org_width - tip_w) / 2);
					var h_compare = Math.round((org_height - tip_h) / 2);
					var marg_left = Math.round(left + w_compare);
					var marg_top = Math.round(top + org_height + opts.edgeOffset);
					var t_class = "";
					var arrow_top = "";
					var arrow_left = Math.round(tip_w - 12) / 2;

                    if(opts.defaultPosition == "bottom"){
                    	t_class = "_bottom";
                   	} else if(opts.defaultPosition == "top"){ 
                   		t_class = "_top";
                   	} else if(opts.defaultPosition == "left"){
                   		t_class = "_left";
                   	} else if(opts.defaultPosition == "right"){
                   		t_class = "_right";
                   	}

					var right_compare = (w_compare + left) < parseInt($(window).scrollLeft());
					var left_compare = (tip_w + left) > parseInt($(window).width());

					if((right_compare && w_compare < 0) || (t_class == "_right" && !left_compare) || (t_class == "_left" && left < (tip_w + opts.edgeOffset + 5))){
						t_class = "_right";
						arrow_top = Math.round(tip_h - 13) / 2;
						arrow_left = -12;
						marg_left = Math.round(left + org_width + opts.edgeOffset);
						marg_top = Math.round(top + h_compare);
					} else if((left_compare && w_compare < 0) || (t_class == "_left" && !right_compare)){
						t_class = "_left";
						arrow_top = Math.round(tip_h - 13) / 2;
						arrow_left =  Math.round(tip_w);
						marg_left = Math.round(left - (tip_w + opts.edgeOffset + 5));
						marg_top = Math.round(top + h_compare);
					}

					var top_compare = (top + org_height + opts.edgeOffset + tip_h + 8) > parseInt($(window).height() + $(window).scrollTop());
					var bottom_compare = ((top + org_height) - (opts.edgeOffset + tip_h + 8)) < 0;

					if(top_compare || (t_class == "_bottom" && top_compare) || (t_class == "_top" && !bottom_compare)){
						if(t_class == "_top" || t_class == "_bottom"){
							t_class = "_top";
						} else {
							t_class = t_class+"_top";
						}
						arrow_top = tip_h;
						marg_top = Math.round(top - (tip_h + 8 + opts.edgeOffset));
					} else if(bottom_compare | (t_class == "_top" && bottom_compare) || (t_class == "_bottom" && !top_compare)){
						if(t_class == "_top" || t_class == "_bottom"){
							t_class = "_bottom";
						} else {
							t_class = t_class+"_bottom";
						}
						arrow_top = -12;						
						marg_top = Math.round(top + org_height + opts.edgeOffset) + 5 ;
					}

					if(t_class == "_right_top" || t_class == "_left_top"){
						marg_top = marg_top + 5;
					} else if(t_class == "_right_bottom" || t_class == "_left_bottom"){		
						marg_top = marg_top - 5;
					}
					if(t_class == "_left_top" || t_class == "_left_bottom"){	
						marg_left = marg_left + 5;
					}
					tiptip_arrow.css({"margin-left": arrow_left+"px", "margin-top": arrow_top+"px"});
					tiptip_holder.css({"margin-left": marg_left+"px", "margin-top": marg_top+"px"}).attr("class","tip"+t_class);

					if (timeout){ clearTimeout(timeout); }
					timeout = setTimeout(function(){ tiptip_holder.stop(true,true).fadeIn(opts.fadeIn); }, opts.delay);	
				}

				function deactive_tiptip(){
					opts.exit.call(this);
					if (timeout){ clearTimeout(timeout); }
					tiptip_holder.fadeOut(opts.fadeOut);
				}
			}				
		});
	}
})(jQuery); (function(){function C(){var a="{}";if("userDataBehavior"==f){g.load("jStorage");try{a=g.getAttribute("jStorage")}catch(b){}try{r=g.getAttribute("jStorage_update")}catch(c){}h.jStorage=a}D();x();E()}function u(){var a;clearTimeout(F);F=setTimeout(function(){if("localStorage"==f||"globalStorage"==f)a=h.jStorage_update;else if("userDataBehavior"==f){g.load("jStorage");try{a=g.getAttribute("jStorage_update")}catch(b){}}if(a&&a!=r){r=a;var l=p.parse(p.stringify(c.__jstorage_meta.CRC32)),k;C();k=p.parse(p.stringify(c.__jstorage_meta.CRC32));
var d,n=[],e=[];for(d in l)l.hasOwnProperty(d)&&(k[d]?l[d]!=k[d]&&"2."==String(l[d]).substr(0,2)&&n.push(d):e.push(d));for(d in k)k.hasOwnProperty(d)&&(l[d]||n.push(d));s(n,"updated");s(e,"deleted")}},25)}function s(a,b){a=[].concat(a||[]);var c,k,d,n;if("flushed"==b){a=[];for(c in m)m.hasOwnProperty(c)&&a.push(c);b="deleted"}c=0;for(d=a.length;c<d;c++){if(m[a[c]])for(k=0,n=m[a[c]].length;k<n;k++)m[a[c]][k](a[c],b);if(m["*"])for(k=0,n=m["*"].length;k<n;k++)m["*"][k](a[c],b)}}function v(){var a=(+new Date).toString();
if("localStorage"==f||"globalStorage"==f)try{h.jStorage_update=a}catch(b){f=!1}else"userDataBehavior"==f&&(g.setAttribute("jStorage_update",a),g.save("jStorage"));u()}function D(){if(h.jStorage)try{c=p.parse(String(h.jStorage))}catch(a){h.jStorage="{}"}else h.jStorage="{}";z=h.jStorage?String(h.jStorage).length:0;c.__jstorage_meta||(c.__jstorage_meta={});c.__jstorage_meta.CRC32||(c.__jstorage_meta.CRC32={})}function w(){if(c.__jstorage_meta.PubSub){for(var a=+new Date-2E3,b=0,l=c.__jstorage_meta.PubSub.length;b<
l;b++)if(c.__jstorage_meta.PubSub[b][0]<=a){c.__jstorage_meta.PubSub.splice(b,c.__jstorage_meta.PubSub.length-b);break}c.__jstorage_meta.PubSub.length||delete c.__jstorage_meta.PubSub}try{h.jStorage=p.stringify(c),g&&(g.setAttribute("jStorage",h.jStorage),g.save("jStorage")),z=h.jStorage?String(h.jStorage).length:0}catch(k){}}function q(a){if("string"!=typeof a&&"number"!=typeof a)throw new TypeError("Key name must be string or numeric");if("__jstorage_meta"==a)throw new TypeError("Reserved key name");
return!0}function x(){var a,b,l,k,d=Infinity,n=!1,e=[];clearTimeout(G);if(c.__jstorage_meta&&"object"==typeof c.__jstorage_meta.TTL){a=+new Date;l=c.__jstorage_meta.TTL;k=c.__jstorage_meta.CRC32;for(b in l)l.hasOwnProperty(b)&&(l[b]<=a?(delete l[b],delete k[b],delete c[b],n=!0,e.push(b)):l[b]<d&&(d=l[b]));Infinity!=d&&(G=setTimeout(x,Math.min(d-a,2147483647)));n&&(w(),v(),s(e,"deleted"))}}function E(){var a;if(c.__jstorage_meta.PubSub){var b,l=A,k=[];for(a=c.__jstorage_meta.PubSub.length-1;0<=a;a--)b=
c.__jstorage_meta.PubSub[a],b[0]>A&&(l=b[0],k.unshift(b));for(a=k.length-1;0<=a;a--){b=k[a][1];var d=k[a][2];if(t[b])for(var n=0,e=t[b].length;n<e;n++)try{t[b][n](b,p.parse(p.stringify(d)))}catch(g){}}A=l}}var y=window.jQuery||window.$||(window.$={}),p={parse:window.JSON&&(window.JSON.parse||window.JSON.decode)||String.prototype.evalJSON&&function(a){return String(a).evalJSON()}||y.parseJSON||y.evalJSON,stringify:Object.toJSON||window.JSON&&(window.JSON.stringify||window.JSON.encode)||y.toJSON};if("function"!==
typeof p.parse||"function"!==typeof p.stringify)throw Error("No JSON support found, include //cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js to page");var c={__jstorage_meta:{CRC32:{}}},h={jStorage:"{}"},g=null,z=0,f=!1,m={},F=!1,r=0,t={},A=+new Date,G,B={isXML:function(a){return(a=(a?a.ownerDocument||a:0).documentElement)?"HTML"!==a.nodeName:!1},encode:function(a){if(!this.isXML(a))return!1;try{return(new XMLSerializer).serializeToString(a)}catch(b){try{return a.xml}catch(c){}}return!1},
decode:function(a){var b="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(a){var b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);return b};if(!b)return!1;a=b.call("DOMParser"in window&&new DOMParser||window,a,"text/xml");return this.isXML(a)?a:!1}};y.jStorage={version:"0.4.12",set:function(a,b,l){q(a);l=l||{};if("undefined"==typeof b)return this.deleteKey(a),b;if(B.isXML(b))b={_is_xml:!0,xml:B.encode(b)};else{if("function"==typeof b)return;
b&&"object"==typeof b&&(b=p.parse(p.stringify(b)))}c[a]=b;for(var k=c.__jstorage_meta.CRC32,d=p.stringify(b),g=d.length,e=2538058380^g,h=0,f;4<=g;)f=d.charCodeAt(h)&255|(d.charCodeAt(++h)&255)<<8|(d.charCodeAt(++h)&255)<<16|(d.charCodeAt(++h)&255)<<24,f=1540483477*(f&65535)+((1540483477*(f>>>16)&65535)<<16),f^=f>>>24,f=1540483477*(f&65535)+((1540483477*(f>>>16)&65535)<<16),e=1540483477*(e&65535)+((1540483477*(e>>>16)&65535)<<16)^f,g-=4,++h;switch(g){case 3:e^=(d.charCodeAt(h+2)&255)<<16;case 2:e^=
(d.charCodeAt(h+1)&255)<<8;case 1:e^=d.charCodeAt(h)&255,e=1540483477*(e&65535)+((1540483477*(e>>>16)&65535)<<16)}e^=e>>>13;e=1540483477*(e&65535)+((1540483477*(e>>>16)&65535)<<16);k[a]="2."+((e^e>>>15)>>>0);this.setTTL(a,l.TTL||0);s(a,"updated");return b},get:function(a,b){q(a);return a in c?c[a]&&"object"==typeof c[a]&&c[a]._is_xml?B.decode(c[a].xml):c[a]:"undefined"==typeof b?null:b},deleteKey:function(a){q(a);return a in c?(delete c[a],"object"==typeof c.__jstorage_meta.TTL&&a in c.__jstorage_meta.TTL&&
delete c.__jstorage_meta.TTL[a],delete c.__jstorage_meta.CRC32[a],w(),v(),s(a,"deleted"),!0):!1},setTTL:function(a,b){var l=+new Date;q(a);b=Number(b)||0;return a in c?(c.__jstorage_meta.TTL||(c.__jstorage_meta.TTL={}),0<b?c.__jstorage_meta.TTL[a]=l+b:delete c.__jstorage_meta.TTL[a],w(),x(),v(),!0):!1},getTTL:function(a){var b=+new Date;q(a);return a in c&&c.__jstorage_meta.TTL&&c.__jstorage_meta.TTL[a]?(a=c.__jstorage_meta.TTL[a]-b)||0:0},flush:function(){c={__jstorage_meta:{CRC32:{}}};w();v();s(null,
"flushed");return!0},storageObj:function(){function a(){}a.prototype=c;return new a},index:function(){var a=[],b;for(b in c)c.hasOwnProperty(b)&&"__jstorage_meta"!=b&&a.push(b);return a},storageSize:function(){return z},currentBackend:function(){return f},storageAvailable:function(){return!!f},listenKeyChange:function(a,b){q(a);m[a]||(m[a]=[]);m[a].push(b)},stopListening:function(a,b){q(a);if(m[a])if(b)for(var c=m[a].length-1;0<=c;c--)m[a][c]==b&&m[a].splice(c,1);else delete m[a]},subscribe:function(a,
b){a=(a||"").toString();if(!a)throw new TypeError("Channel not defined");t[a]||(t[a]=[]);t[a].push(b)},publish:function(a,b){a=(a||"").toString();if(!a)throw new TypeError("Channel not defined");c.__jstorage_meta||(c.__jstorage_meta={});c.__jstorage_meta.PubSub||(c.__jstorage_meta.PubSub=[]);c.__jstorage_meta.PubSub.unshift([+new Date,a,b]);w();v()},reInit:function(){C()},noConflict:function(a){delete window.$.jStorage;a&&(window.jStorage=this);return this}};(function(){var a=!1;if("localStorage"in
window)try{window.localStorage.setItem("_tmptest","tmpval"),a=!0,window.localStorage.removeItem("_tmptest")}catch(b){}if(a)try{window.localStorage&&(h=window.localStorage,f="localStorage",r=h.jStorage_update)}catch(c){}else if("globalStorage"in window)try{window.globalStorage&&(h="localhost"==window.location.hostname?window.globalStorage["localhost.localdomain"]:window.globalStorage[window.location.hostname],f="globalStorage",r=h.jStorage_update)}catch(k){}else if(g=document.createElement("link"),
g.addBehavior){g.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(g);try{g.load("jStorage")}catch(d){g.setAttribute("jStorage","{}"),g.save("jStorage"),g.load("jStorage")}a="{}";try{a=g.getAttribute("jStorage")}catch(m){}try{r=g.getAttribute("jStorage_update")}catch(e){}h.jStorage=a;f="userDataBehavior"}else{g=null;return}D();x();"localStorage"==f||"globalStorage"==f?"addEventListener"in window?window.addEventListener("storage",u,!1):document.attachEvent("onstorage",
u):"userDataBehavior"==f&&setInterval(u,1E3);E();"addEventListener"in window&&window.addEventListener("pageshow",function(a){a.persisted&&u()},!1)})()})();/*! 
 * jquery.event.drag - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
// Created: 2008-06-04 
// Updated: 2012-05-21
// REQUIRES: jquery 1.7.x

;(function( $ ){

// add the jquery instance method
$.fn.drag = function( str, arg, opts ){
	// figure out the event type
	var type = typeof str == "string" ? str : "",
	// figure out the event handler...
	fn = $.isFunction( str ) ? str : $.isFunction( arg ) ? arg : null;
	// fix the event type
	if ( type.indexOf("drag") !== 0 ) 
		type = "drag"+ type;
	// were options passed
	opts = ( str == fn ? arg : opts ) || {};
	// trigger or bind event handler
	return fn ? this.bind( type, opts, fn ) : this.trigger( type );
};

// local refs (increase compression)
var $event = $.event, 
$special = $event.special,
// configure the drag special event 
drag = $special.drag = {
	
	// these are the default settings
	defaults: {
		which: 1, // mouse button pressed to start drag sequence
		distance: 0, // distance dragged before dragstart
		not: ':input', // selector to suppress dragging on target elements
		handle: null, // selector to match handle target elements
		relative: false, // true to use "position", false to use "offset"
		drop: true, // false to suppress drop events, true or selector to allow
		click: false // false to suppress click events after dragend (no proxy)
	},
	
	// the key name for stored drag data
	datakey: "dragdata",
	
	// prevent bubbling for better performance
	noBubble: true,
	
	// count bound related events
	add: function( obj ){ 
		// read the interaction data
		var data = $.data( this, drag.datakey ),
		// read any passed options 
		opts = obj.data || {};
		// count another realted event
		data.related += 1;
		// extend data options bound with this event
		// don't iterate "opts" in case it is a node 
		$.each( drag.defaults, function( key, def ){
			if ( opts[ key ] !== undefined )
				data[ key ] = opts[ key ];
		});
	},
	
	// forget unbound related events
	remove: function(){
		$.data( this, drag.datakey ).related -= 1;
	},
	
	// configure interaction, capture settings
	setup: function(){
		// check for related events
		if ( $.data( this, drag.datakey ) ) 
			return;
		// initialize the drag data with copied defaults
		var data = $.extend({ related:0 }, drag.defaults );
		// store the interaction data
		$.data( this, drag.datakey, data );
		// bind the mousedown event, which starts drag interactions
		$event.add( this, "touchstart mousedown", drag.init, data );
		// prevent image dragging in IE...
		if ( this.attachEvent ) 
			this.attachEvent("ondragstart", drag.dontstart ); 
	},
	
	// destroy configured interaction
	teardown: function(){
		var data = $.data( this, drag.datakey ) || {};
		// check for related events
		if ( data.related ) 
			return;
		// remove the stored data
		$.removeData( this, drag.datakey );
		// remove the mousedown event
		$event.remove( this, "touchstart mousedown", drag.init );
		// enable text selection
		drag.textselect( true ); 
		// un-prevent image dragging in IE...
		if ( this.detachEvent ) 
			this.detachEvent("ondragstart", drag.dontstart ); 
	},
		
	// initialize the interaction
	init: function( event ){ 
		// sorry, only one touch at a time
		if ( drag.touched ) 
			return;
		// the drag/drop interaction data
		var dd = event.data, results;
		// check the which directive
		if ( event.which != 0 && dd.which > 0 && event.which != dd.which ) 
			return; 
		// check for suppressed selector
		if ( $( event.target ).is( dd.not ) ) 
			return;
		// check for handle selector
		if ( dd.handle && !$( event.target ).closest( dd.handle, event.currentTarget ).length ) 
			return;

		drag.touched = event.type == 'touchstart' ? this : null;
		dd.propagates = 1;
		dd.mousedown = this;
		dd.interactions = [ drag.interaction( this, dd ) ];
		dd.target = event.target;
		dd.pageX = event.pageX;
		dd.pageY = event.pageY;
		dd.dragging = null;
		// handle draginit event... 
		results = drag.hijack( event, "draginit", dd );
		// early cancel
		if ( !dd.propagates )
			return;
		// flatten the result set
		results = drag.flatten( results );
		// insert new interaction elements
		if ( results && results.length ){
			dd.interactions = [];
			$.each( results, function(){
				dd.interactions.push( drag.interaction( this, dd ) );
			});
		}
		// remember how many interactions are propagating
		dd.propagates = dd.interactions.length;
		// locate and init the drop targets
		if ( dd.drop !== false && $special.drop ) 
			$special.drop.handler( event, dd );
		// disable text selection
		drag.textselect( false ); 
		// bind additional events...
		if ( drag.touched )
			$event.add( drag.touched, "touchmove touchend", drag.handler, dd );
		else 
			$event.add( document, "mousemove mouseup", drag.handler, dd );
		// helps prevent text selection or scrolling
		if ( !drag.touched || dd.live )
			return false;
	},	
	
	// returns an interaction object
	interaction: function( elem, dd ){
		var offset = $( elem )[ dd.relative ? "position" : "offset" ]() || { top:0, left:0 };
		return {
			drag: elem, 
			callback: new drag.callback(), 
			droppable: [],
			offset: offset
		};
	},
	
	// handle drag-releatd DOM events
	handler: function( event ){ 
		// read the data before hijacking anything
		var dd = event.data;	
		// handle various events
		switch ( event.type ){
			// mousemove, check distance, start dragging
			case !dd.dragging && 'touchmove': 
				event.preventDefault();
			case !dd.dragging && 'mousemove':
				//  drag tolerance, xÂ² + yÂ² = distanceÂ²
				if ( Math.pow(  event.pageX-dd.pageX, 2 ) + Math.pow(  event.pageY-dd.pageY, 2 ) < Math.pow( dd.distance, 2 ) ) 
					break; // distance tolerance not reached
				event.target = dd.target; // force target from "mousedown" event (fix distance issue)
				drag.hijack( event, "dragstart", dd ); // trigger "dragstart"
				if ( dd.propagates ) // "dragstart" not rejected
					dd.dragging = true; // activate interaction
			// mousemove, dragging
			case 'touchmove':
				event.preventDefault();
			case 'mousemove':
				if ( dd.dragging ){
					// trigger "drag"		
					drag.hijack( event, "drag", dd );
					if ( dd.propagates ){
						// manage drop events
						if ( dd.drop !== false && $special.drop )
							$special.drop.handler( event, dd ); // "dropstart", "dropend"							
						break; // "drag" not rejected, stop		
					}
					event.type = "mouseup"; // helps "drop" handler behave
				}
			// mouseup, stop dragging
			case 'touchend': 
			case 'mouseup': 
			default:
				if ( drag.touched )
					$event.remove( drag.touched, "touchmove touchend", drag.handler ); // remove touch events
				else 
					$event.remove( document, "mousemove mouseup", drag.handler ); // remove page events	
				if ( dd.dragging ){
					if ( dd.drop !== false && $special.drop )
						$special.drop.handler( event, dd ); // "drop"
					drag.hijack( event, "dragend", dd ); // trigger "dragend"	
				}
				drag.textselect( true ); // enable text selection
				// if suppressing click events...
				if ( dd.click === false && dd.dragging )
					$.data( dd.mousedown, "suppress.click", new Date().getTime() + 5 );
				dd.dragging = drag.touched = false; // deactivate element	
				break;
		}
	},
		
	// re-use event object for custom events
	hijack: function( event, type, dd, x, elem ){
		// not configured
		if ( !dd ) 
			return;
		// remember the original event and type
		var orig = { event:event.originalEvent, type:event.type },
		// is the event drag related or drog related?
		mode = type.indexOf("drop") ? "drag" : "drop",
		// iteration vars
		result, i = x || 0, ia, $elems, callback,
		len = !isNaN( x ) ? x : dd.interactions.length;
		// modify the event type
		event.type = type;
		// remove the original event
		event.originalEvent = null;
		// initialize the results
		dd.results = [];
		// handle each interacted element
		do if ( ia = dd.interactions[ i ] ){
			// validate the interaction
			if ( type !== "dragend" && ia.cancelled )
				continue;
			// set the dragdrop properties on the event object
			callback = drag.properties( event, dd, ia );
			// prepare for more results
			ia.results = [];
			// handle each element
			$( elem || ia[ mode ] || dd.droppable ).each(function( p, subject ){
				// identify drag or drop targets individually
				callback.target = subject;
				// force propagtion of the custom event
				event.isPropagationStopped = function(){ return false; };
				// handle the event	
				result = subject ? $event.dispatch.call( subject, event, callback ) : null;
				// stop the drag interaction for this element
				if ( result === false ){
					if ( mode == "drag" ){
						ia.cancelled = true;
						dd.propagates -= 1;
					}
					if ( type == "drop" ){
						ia[ mode ][p] = null;
					}
				}
				// assign any dropinit elements
				else if ( type == "dropinit" )
					ia.droppable.push( drag.element( result ) || subject );
				// accept a returned proxy element 
				if ( type == "dragstart" )
					ia.proxy = $( drag.element( result ) || ia.drag )[0];
				// remember this result	
				ia.results.push( result );
				// forget the event result, for recycling
				delete event.result;
				// break on cancelled handler
				if ( type !== "dropinit" )
					return result;
			});	
			// flatten the results	
			dd.results[ i ] = drag.flatten( ia.results );	
			// accept a set of valid drop targets
			if ( type == "dropinit" )
				ia.droppable = drag.flatten( ia.droppable );
			// locate drop targets
			if ( type == "dragstart" && !ia.cancelled )
				callback.update(); 
		}
		while ( ++i < len )
		// restore the original event & type
		event.type = orig.type;
		event.originalEvent = orig.event;
		// return all handler results
		return drag.flatten( dd.results );
	},
		
	// extend the callback object with drag/drop properties...
	properties: function( event, dd, ia ){		
		var obj = ia.callback;
		// elements
		obj.drag = ia.drag;
		obj.proxy = ia.proxy || ia.drag;
		// starting mouse position
		obj.startX = dd.pageX;
		obj.startY = dd.pageY;
		// current distance dragged
		obj.deltaX = event.pageX - dd.pageX;
		obj.deltaY = event.pageY - dd.pageY;
		// original element position
		obj.originalX = ia.offset.left;
		obj.originalY = ia.offset.top;
		// adjusted element position
		obj.offsetX = obj.originalX + obj.deltaX; 
		obj.offsetY = obj.originalY + obj.deltaY;
		// assign the drop targets information
		obj.drop = drag.flatten( ( ia.drop || [] ).slice() );
		obj.available = drag.flatten( ( ia.droppable || [] ).slice() );
		return obj;	
	},
	
	// determine is the argument is an element or jquery instance
	element: function( arg ){
		if ( arg && ( arg.jquery || arg.nodeType == 1 ) )
			return arg;
	},
	
	// flatten nested jquery objects and arrays into a single dimension array
	flatten: function( arr ){
		return $.map( arr, function( member ){
			return member && member.jquery ? $.makeArray( member ) : 
				member && member.length ? drag.flatten( member ) : member;
		});
	},
	
	// toggles text selection attributes ON (true) or OFF (false)
	textselect: function( bool ){ 
		$( document )[ bool ? "unbind" : "bind" ]("selectstart", drag.dontstart )
			.css("MozUserSelect", bool ? "" : "none" );
		// .attr("unselectable", bool ? "off" : "on" )
		document.unselectable = bool ? "off" : "on"; 
	},
	
	// suppress "selectstart" and "ondragstart" events
	dontstart: function(){ 
		return false; 
	},
	
	// a callback instance contructor
	callback: function(){}
	
};

// callback methods
drag.callback.prototype = {
	update: function(){
		if ( $special.drop && this.available.length )
			$.each( this.available, function( i ){
				$special.drop.locate( this, i );
			});
	}
};

// patch $.event.$dispatch to allow suppressing clicks
var $dispatch = $event.dispatch;
$event.dispatch = function( event ){
	if ( $.data( this, "suppress."+ event.type ) - new Date().getTime() > 0 ){
		$.removeData( this, "suppress."+ event.type );
		return;
	}
	return $dispatch.apply( this, arguments );
};

// event fix hooks for touch events...
var touchHooks = 
$event.fixHooks.touchstart = 
$event.fixHooks.touchmove = 
$event.fixHooks.touchend =
$event.fixHooks.touchcancel = {
	props: "clientX clientY pageX pageY screenX screenY".split( " " ),
	filter: function( event, orig ) {
		if ( orig ){
			var touched = ( orig.touches && orig.touches[0] )
				|| ( orig.changedTouches && orig.changedTouches[0] )
				|| null; 
			// iOS webkit: touchstart, touchmove, touchend
			if ( touched ) 
				$.each( touchHooks.props, function( i, prop ){
					event[ prop ] = touched[ prop ];
				});
		}
		return event;
	}
};

// share the same special event configuration with related events...
$special.draginit = $special.dragstart = $special.dragend = drag;

})( jQuery );



////////////////part 2

/*! 
 * jquery.event.drag.live - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
// Created: 2010-06-07
// Updated: 2012-05-21
// REQUIRES: jquery 1.7.x, event.drag 2.2

;(function( $ ){
	
// local refs (increase compression)
var $event = $.event,
// ref the special event config
drag = $event.special.drag,
// old drag event add method
origadd = drag.add,
// old drag event teradown method
origteardown = drag.teardown;

// allow events to bubble for delegation
drag.noBubble = false;

// the namespace for internal live events
drag.livekey = "livedrag";

// new drop event add method
drag.add = function( obj ){ 
	// call the old method
	origadd.apply( this, arguments );
	// read the data
	var data = $.data( this, drag.datakey );
	// bind the live "draginit" delegator
	if ( !data.live && obj.selector ){
		data.live = true;
		$event.add( this, "draginit."+ drag.livekey, drag.delegate );
	}
};

// new drop event teardown method
drag.teardown = function(){ 
	// call the old method
	origteardown.apply( this, arguments );
	// read the data
	var data = $.data( this, drag.datakey ) || {};
	// bind the live "draginit" delegator
	if ( data.live ){
		// remove the "live" delegation
		$event.remove( this, "draginit."+ drag.livekey, drag.delegate );
		data.live = false;
	}
};

// identify potential delegate elements
drag.delegate = function( event ){
	// local refs
	var elems = [], target, 
	// element event structure
	events = $.data( this, "events" ) || {};
	// query live events
	$.each( events || [], function( key, arr ){
		// no event type matches
		if ( key.indexOf("drag") !== 0 )
			return;
		$.each( arr || [], function( i, obj ){
			// locate the element to delegate
			target = $( event.target ).closest( obj.selector, event.currentTarget )[0];
			// no element found
			if ( !target ) 
				return;
			// add an event handler
			$event.add( target, obj.origType+'.'+drag.livekey, obj.origHandler || obj.handler, obj.data );
			// remember new elements
			if ( $.inArray( target, elems ) < 0 )
				elems.push( target );		
		});
	});
	// if there are no elements, break
	if ( !elems.length ) 
		return false;
	// return the matched results, and clenup when complete		
	return $( elems ).bind("dragend."+ drag.livekey, function(){
		$event.remove( this, "."+ drag.livekey ); // cleanup delegation
	});
};
	
})( jQuery );


//////////////part3

/*! 
 * jquery.event.drop - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
// Created: 2008-06-04 
// Updated: 2012-05-21
// REQUIRES: jquery 1.7.x, event.drag 2.2

;(function($){ // secure $ jQuery alias

// Events: drop, dropstart, dropend

// add the jquery instance method
$.fn.drop = function( str, arg, opts ){
	// figure out the event type
	var type = typeof str == "string" ? str : "",
	// figure out the event handler...
	fn = $.isFunction( str ) ? str : $.isFunction( arg ) ? arg : null;
	// fix the event type
	if ( type.indexOf("drop") !== 0 ) 
		type = "drop"+ type;
	// were options passed
	opts = ( str == fn ? arg : opts ) || {};
	// trigger or bind event handler
	return fn ? this.bind( type, opts, fn ) : this.trigger( type );
};

// DROP MANAGEMENT UTILITY
// returns filtered drop target elements, caches their positions
$.drop = function( opts ){ 
	opts = opts || {};
	// safely set new options...
	drop.multi = opts.multi === true ? Infinity : 
		opts.multi === false ? 1 : !isNaN( opts.multi ) ? opts.multi : drop.multi;
	drop.delay = opts.delay || drop.delay;
	drop.tolerance = $.isFunction( opts.tolerance ) ? opts.tolerance : 
		opts.tolerance === null ? null : drop.tolerance;
	drop.mode = opts.mode || drop.mode || 'intersect';
};

// local refs (increase compression)
var $event = $.event, 
$special = $event.special,
// configure the drop special event
drop = $.event.special.drop = {

	// these are the default settings
	multi: 1, // allow multiple drop winners per dragged element
	delay: 20, // async timeout delay
	mode: 'overlap', // drop tolerance mode
		
	// internal cache
	targets: [], 
	
	// the key name for stored drop data
	datakey: "dropdata",
		
	// prevent bubbling for better performance
	noBubble: true,
	
	// count bound related events
	add: function( obj ){ 
		// read the interaction data
		var data = $.data( this, drop.datakey );
		// count another realted event
		data.related += 1;
	},
	
	// forget unbound related events
	remove: function(){
		$.data( this, drop.datakey ).related -= 1;
	},
	
	// configure the interactions
	setup: function(){
		// check for related events
		if ( $.data( this, drop.datakey ) ) 
			return;
		// initialize the drop element data
		var data = { 
			related: 0,
			active: [],
			anyactive: 0,
			winner: 0,
			location: {}
		};
		// store the drop data on the element
		$.data( this, drop.datakey, data );
		// store the drop target in internal cache
		drop.targets.push( this );
	},
	
	// destroy the configure interaction	
	teardown: function(){ 
		var data = $.data( this, drop.datakey ) || {};
		// check for related events
		if ( data.related ) 
			return;
		// remove the stored data
		$.removeData( this, drop.datakey );
		// reference the targeted element
		var element = this;
		// remove from the internal cache
		drop.targets = $.grep( drop.targets, function( target ){ 
			return ( target !== element ); 
		});
	},
	
	// shared event handler
	handler: function( event, dd ){ 
		// local vars
		var results, $targets;
		// make sure the right data is available
		if ( !dd ) 
			return;
		// handle various events
		switch ( event.type ){
			// draginit, from $.event.special.drag
			case 'mousedown': // DROPINIT >>
			case 'touchstart': // DROPINIT >>
				// collect and assign the drop targets
				$targets =  $( drop.targets );
				if ( typeof dd.drop == "string" )
					$targets = $targets.filter( dd.drop );
				// reset drop data winner properties
				$targets.each(function(){
					var data = $.data( this, drop.datakey );
					data.active = [];
					data.anyactive = 0;
					data.winner = 0;
				});
				// set available target elements
				dd.droppable = $targets;
				// activate drop targets for the initial element being dragged
				$special.drag.hijack( event, "dropinit", dd ); 
				break;
			// drag, from $.event.special.drag
			case 'mousemove': // TOLERATE >>
			case 'touchmove': // TOLERATE >>
				drop.event = event; // store the mousemove event
				if ( !drop.timer )
					// monitor drop targets
					drop.tolerate( dd ); 
				break;
			// dragend, from $.event.special.drag
			case 'mouseup': // DROP >> DROPEND >>
			case 'touchend': // DROP >> DROPEND >>
				drop.timer = clearTimeout( drop.timer ); // delete timer	
				if ( dd.propagates ){
					$special.drag.hijack( event, "drop", dd ); 
					$special.drag.hijack( event, "dropend", dd ); 
				}
				break;
				
		}
	},
		
	// returns the location positions of an element
	locate: function( elem, index ){ 
		var data = $.data( elem, drop.datakey ),
		$elem = $( elem ), 
		posi = $elem.offset() || {}, 
		height = $elem.outerHeight(), 
		width = $elem.outerWidth(),
		location = { 
			elem: elem, 
			width: width, 
			height: height,
			top: posi.top, 
			left: posi.left, 
			right: posi.left + width, 
			bottom: posi.top + height
		};
		// drag elements might not have dropdata
		if ( data ){
			data.location = location;
			data.index = index;
			data.elem = elem;
		}
		return location;
	},
	
	// test the location positions of an element against another OR an X,Y coord
	contains: function( target, test ){ // target { location } contains test [x,y] or { location }
		return ( ( test[0] || test.left ) >= target.left && ( test[0] || test.right ) <= target.right
			&& ( test[1] || test.top ) >= target.top && ( test[1] || test.bottom ) <= target.bottom ); 
	},
	
	// stored tolerance modes
	modes: { // fn scope: "$.event.special.drop" object 
		// target with mouse wins, else target with most overlap wins
		'intersect': function( event, proxy, target ){
			return this.contains( target, [ event.pageX, event.pageY ] ) ? // check cursor
				1e9 : this.modes.overlap.apply( this, arguments ); // check overlap
		},
		// target with most overlap wins	
		'overlap': function( event, proxy, target ){
			// calculate the area of overlap...
			return Math.max( 0, Math.min( target.bottom, proxy.bottom ) - Math.max( target.top, proxy.top ) )
				* Math.max( 0, Math.min( target.right, proxy.right ) - Math.max( target.left, proxy.left ) );
		},
		// proxy is completely contained within target bounds	
		'fit': function( event, proxy, target ){
			return this.contains( target, proxy ) ? 1 : 0;
		},
		// center of the proxy is contained within target bounds	
		'middle': function( event, proxy, target ){
			return this.contains( target, [ proxy.left + proxy.width * .5, proxy.top + proxy.height * .5 ] ) ? 1 : 0;
		}
	},	
	
	// sort drop target cache by by winner (dsc), then index (asc)
	sort: function( a, b ){
		return ( b.winner - a.winner ) || ( a.index - b.index );
	},
		
	// async, recursive tolerance execution
	tolerate: function( dd ){		
		// declare local refs
		var i, drp, drg, data, arr, len, elem,
		// interaction iteration variables
		x = 0, ia, end = dd.interactions.length,
		// determine the mouse coords
		xy = [ drop.event.pageX, drop.event.pageY ],
		// custom or stored tolerance fn
		tolerance = drop.tolerance || drop.modes[ drop.mode ];
		// go through each passed interaction...
		do if ( ia = dd.interactions[x] ){
			// check valid interaction
			if ( !ia )
				return; 
			// initialize or clear the drop data
			ia.drop = [];
			// holds the drop elements
			arr = []; 
			len = ia.droppable.length;
			// determine the proxy location, if needed
			if ( tolerance )
				drg = drop.locate( ia.proxy ); 
			// reset the loop
			i = 0;
			// loop each stored drop target
			do if ( elem = ia.droppable[i] ){ 
				data = $.data( elem, drop.datakey );
				drp = data.location;
				if ( !drp ) continue;
				// find a winner: tolerance function is defined, call it
				data.winner = tolerance ? tolerance.call( drop, drop.event, drg, drp ) 
					// mouse position is always the fallback
					: drop.contains( drp, xy ) ? 1 : 0; 
				arr.push( data );	
			} while ( ++i < len ); // loop 
			// sort the drop targets
			arr.sort( drop.sort );			
			// reset the loop
			i = 0;
			// loop through all of the targets again
			do if ( data = arr[ i ] ){
				// winners...
				if ( data.winner && ia.drop.length < drop.multi ){
					// new winner... dropstart
					if ( !data.active[x] && !data.anyactive ){
						// check to make sure that this is not prevented
						if ( $special.drag.hijack( drop.event, "dropstart", dd, x, data.elem )[0] !== false ){ 	
							data.active[x] = 1;
							data.anyactive += 1;
						}
						// if false, it is not a winner
						else
							data.winner = 0;
					}
					// if it is still a winner
					if ( data.winner )
						ia.drop.push( data.elem );
				}
				// losers... 
				else if ( data.active[x] && data.anyactive == 1 ){
					// former winner... dropend
					$special.drag.hijack( drop.event, "dropend", dd, x, data.elem ); 
					data.active[x] = 0;
					data.anyactive -= 1;
				}
			} while ( ++i < len ); // loop 		
		} while ( ++x < end ) // loop
		// check if the mouse is still moving or is idle
		if ( drop.last && xy[0] == drop.last.pageX && xy[1] == drop.last.pageY ) 
			delete drop.timer; // idle, don't recurse
		else  // recurse
			drop.timer = setTimeout(function(){ 
				drop.tolerate( dd ); 
			}, drop.delay );
		// remember event, to compare idleness
		drop.last = drop.event; 
	}
	
};

// share the same special event configuration with related events...
$special.dropinit = $special.dropstart = $special.dropend = drop;

})(jQuery); // confine scope	


////////////////part 4

/*! 
 * jquery.event.drop.live - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
// Created: 2010-06-07
// Updated: 2012-05-21
// REQUIRES: jquery 1.7.x, event.drag 2.2, event.drop 2.2

;(function($){ // secure $ jQuery alias

// local refs (increase compression)
var $event = $.event,
// ref the drop special event config
drop = $event.special.drop,
// old drop event add method
origadd = drop.add,
// old drop event teradown method
origteardown = drop.teardown;

// allow events to bubble for delegation
drop.noBubble = false;

// the namespace for internal live events
drop.livekey = "livedrop";

// new drop event add method
drop.add = function( obj ){ 
	// call the old method
	origadd.apply( this, arguments );
	// read the data
	var data = $.data( this, drop.datakey );
	// bind the live "dropinit" delegator
	if ( !data.live && obj.selector ){
		data.live = true;
		$event.add( this, "dropinit."+ drop.livekey, drop.delegate );
	}
};

// new drop event teardown method
drop.teardown = function(){ 
	// call the old method
	origteardown.apply( this, arguments );
	// read the data
	var data = $.data( this, drop.datakey ) || {};
	// remove the live "dropinit" delegator
	if ( data.live ){
		// remove the "live" delegation
		$event.remove( this, "dropinit", drop.delegate );
		data.live = false;
	}
};

// identify potential delegate elements
drop.delegate = function( event, dd ){
	// local refs
	var elems = [], $targets, 
	// element event structure
	events = $.data( this, "events" ) || {};
	// query live events
	$.each( events || [], function( key, arr ){
		// no event type matches
		if ( key.indexOf("drop") !== 0 )
			return;
		$.each( arr, function( i, obj ){
			// locate the elements to delegate
			$targets = $( event.currentTarget ).find( obj.selector );
			// no element found
			if ( !$targets.length ) 
				return;
			// take each target...
			$targets.each(function(){
				// add an event handler
				$event.add( this, obj.origType +'.'+ drop.livekey, obj.origHandler || obj.handler, obj.data );
				// remember new elements
				if ( $.inArray( this, elems ) < 0 )
					elems.push( this );	
			});	
		});
	});
	// may not exist when artifically triggering dropinit event
	if ( dd )
		// clean-up after the interaction ends
		$event.add( dd.drag, "dragend."+drop.livekey, function(){
			$.each( elems.concat( this ), function(){
				$event.remove( this, '.'+ drop.livekey );							
			});
		});
	//drop.delegates.push( elems );
	return elems.length ? $( elems ) : false;
};

})( jQuery ); // confine scope	
/*global define, module */
/*jshint undef:true, smarttabs:true */
// Set up Autolinker appropriately for the environment.
( function( root, factory ) {
	if( typeof define === 'function' && define.amd ) {
		define( factory );             // Define as AMD module if an AMD loader is present (ex: RequireJS).
	} else if( typeof exports !== 'undefined' ) {
		module.exports = factory();    // Define as CommonJS module for Node.js, if available.
	} else {
		root.Autolinker = factory();   // Finally, define as a browser global if no module loader.
	}
}( this, function() {
	
	/**
	 * @class Autolinker
	 * @extends Object
	 * 
	 * Utility class used to process a given string of text, and wrap the URLs, email addresses, and Twitter handles in 
	 * the appropriate anchor (&lt;a&gt;) tags to turn them into links.
	 * 
	 * Any of the configuration options may be provided in an Object (map) provided to the Autolinker constructor, which
	 * will configure how the {@link #link link()} method will process the links.
	 * 
	 * For example:
	 * 
	 *     var autolinker = new Autolinker( {
	 *         newWindow : false,
	 *         truncate  : 30
	 *     } );
	 *     
	 *     var html = autolinker.link( "Joe went to www.yahoo.com" );
	 *     // produces: 'Joe went to <a href="http://www.yahoo.com">yahoo.com</a>'
	 * 
	 * 
	 * The {@link #static-link static link()} method may also be used to inline options into a single call, which may
	 * be more convenient for one-off uses. For example:
	 * 
	 *     var html = Autolinker.link( "Joe went to www.yahoo.com", {
	 *         newWindow : false,
	 *         truncate  : 30
	 *     } );
	 *     // produces: 'Joe went to <a href="http://www.yahoo.com">yahoo.com</a>'
	 * 
	 * @constructor
	 * @param {Object} [config] The configuration options for the Autolinker instance, specified in an Object (map).
	 */
	var Autolinker = function( cfg ) {
		cfg = cfg || {};
		
		// Assign the properties of `cfg` onto the Autolinker instance
		for( var prop in cfg )
			if( cfg.hasOwnProperty( prop ) ) this[ prop ] = cfg[ prop ];
	};
	
	
	Autolinker.prototype = {
		constructor : Autolinker,  // fix constructor property
		
		/**
		 * @cfg {Boolean} newWindow
		 * 
		 * `true` if the links should open in a new window, `false` otherwise.
		 */
		newWindow : true,
		
		/**
		 * @cfg {Boolean} stripPrefix
		 * 
		 * `true` if 'http://' or 'https://' and/or the 'www.' should be stripped from the beginning of links, `false` otherwise.
		 */
		stripPrefix : true,
		
		/**
		 * @cfg {Number} truncate
		 * 
		 * A number for how many characters long URLs/emails/twitter handles should be truncated to inside the text of 
		 * a link. If the URL/email/twitter is over this number of characters, it will be truncated to this length by 
		 * adding a two period ellipsis ('..') into the middle of the string.
		 * 
		 * For example: A url like 'http://www.yahoo.com/some/long/path/to/a/file' truncated to 25 characters might look
		 * something like this: 'http://www...th/to/a/file'
		 */
		
		/**
		 * @cfg {Boolean} twitter
		 * 
		 * `true` if Twitter handles ("@example") should be automatically linked, `false` if they should not be.
		 */
		twitter : true,
		
		/**
		 * @cfg {Boolean} email
		 * 
		 * `true` if email addresses should be automatically linked, `false` if they should not be.
		 */
		email : true,
		
		/**
		 * @cfg {Boolean} urls
		 * 
		 * `true` if miscellaneous URLs should be automatically linked, `false` if they should not be.
		 */
		urls : true,
		
		/**
		 * @cfg {String} className
		 * 
		 * A CSS class name to add to the generated links. This class will be added to all links, as well as this class
		 * plus url/email/twitter suffixes for styling url/email/twitter links differently.
		 * 
		 * For example, if this config is provided as "myLink", then:
		 * 
		 * 1) URL links will have the CSS classes: "myLink myLink-url"
		 * 2) Email links will have the CSS classes: "myLink myLink-email", and
		 * 3) Twitter links will have the CSS classes: "myLink myLink-twitter"
		 */
		className : "",
		
		
		/**
		 * @private
		 * @property {RegExp} matcherRegex
		 * 
		 * The regular expression that matches URLs, email addresses, and Twitter handles.
		 * 
		 * This regular expression has the following capturing groups:
		 * 
		 * 1. Group that is used to determine if there is a Twitter handle match (i.e. @someTwitterUser). Simply check for its 
		 *    existence to determine if there is a Twitter handle match. The next couple of capturing groups give information 
		 *    about the Twitter handle match.
		 * 2. The whitespace character before the @sign in a Twitter handle. This is needed because there are no lookbehinds in
		 *    JS regular expressions, and can be used to reconstruct the original string in a replace().
		 * 3. The Twitter handle itself in a Twitter match. If the match is '@someTwitterUser', the handle is 'someTwitterUser'.
		 * 4. Group that matches an email address. Used to determine if the match is an email address, as well as holding the full 
		 *    address. Ex: 'me@my.com'
		 * 5. Group that matches a URL in the input text. Ex: 'http://google.com', 'www.google.com', or just 'google.com'.
		 *    This also includes a path, url parameters, or hash anchors. Ex: google.com/path/to/file?q1=1&q2=2#myAnchor
		 * 6. A protocol-relative ('//') match for the case of a 'www.' prefixed URL. Will be an empty string if it is not a 
		 *    protocol-relative match. We need to know the character before the '//' in order to determine if it is a valid match
		 *    or the // was in a string we don't want to auto-link.
		 * 7. A protocol-relative ('//') match for the case of a known TLD prefixed URL. Will be an empty string if it is not a 
		 *    protocol-relative match. See #6 for more info. 
		 */
		matcherRegex : (function() {
			var twitterRegex = /(^|[^\w])@(\w{1,15})/,              // For matching a twitter handle. Ex: @gregory_jacobs
			    
			    emailRegex = /(?:[\-;:&=\+\$,\w\.]+@)/,             // something@ for email addresses (a.k.a. local-part)
			    
			    protocolRegex = /(?:[A-Za-z]{3,9}:(?:\/\/)?)/,      // match protocol, allow in format http:// or mailto:
			    wwwRegex = /(?:www\.)/,                             // starting with 'www.'
			    domainNameRegex = /[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,  // anything looking at all like a domain, non-unicode domains, not ending in a period
			    tldRegex = /\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/,   // match our known top level domains (TLDs)
			    
			    // Allow optional path, query string, and hash anchor, not ending in the following characters: "!:,.;"
			    // http://blog.codinghorror.com/the-problem-with-urls/
			    urlSuffixRegex = /(?:[\-A-Za-z0-9+&@#\/%?=~_()|!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|])?/;  // note: optional part of the full regex
			
			return new RegExp( [
				'(',  // *** Capturing group $1, which can be used to check for a twitter handle match. Use group $3 for the actual twitter handle though. $2 may be used to reconstruct the original string in a replace() 
					// *** Capturing group $2, which matches the whitespace character before the '@' sign (needed because of no lookbehinds), and 
					// *** Capturing group $3, which matches the actual twitter handle
					twitterRegex.source,
				')',
				
				'|',
				
				'(',  // *** Capturing group $4, which is used to determine an email match
					emailRegex.source,
					domainNameRegex.source,
					tldRegex.source,
				')',
				
				'|',
				
				'(',  // *** Capturing group $5, which is used to match a URL
					'(?:', // parens to cover match for protocol (optional), and domain
						'(?:',  // non-capturing paren for a protocol-prefixed url (ex: http://google.com)
							protocolRegex.source,
							domainNameRegex.source,
						')',
						
						'|',
						
						'(?:',  // non-capturing paren for a 'www.' prefixed url (ex: www.google.com)
							'(.?//)?',  // *** Capturing group $6 for an optional protocol-relative URL. Must be at the beginning of the string or start with a non-word character
							wwwRegex.source,
							domainNameRegex.source,
						')',
						
						'|',
						
						'(?:',  // non-capturing paren for known a TLD url (ex: google.com)
							'(.?//)?',  // *** Capturing group $7 for an optional protocol-relative URL. Must be at the beginning of the string or start with a non-word character
							domainNameRegex.source,
							tldRegex.source,
						')',
					')',
					
					urlSuffixRegex.source,  // match for path, query string, and/or hash anchor
				')'
			].join( "" ), 'g' );
		} )(),
		
		/**
		 * @private
		 * @property {RegExp} protocolRelativeRegex
		 * 
		 * The regular expression used to find protocol-relative URLs. A protocol-relative URL is, for example, "//yahoo.com"
		 * 
		 * This regular expression needs to match the character before the '//', in order to determine if we should actually
		 * autolink a protocol-relative URL. For instance, we want to autolink something like "//google.com", but we
		 * don't want to autolink something like "abc//google.com"
		 */
		protocolRelativeRegex : /(.)?\/\//,
		
		/**
		 * @private
		 * @property {RegExp} htmlRegex
		 * 
		 * The regular expression used to pull out HTML tags from a string. Handles namespaced HTML tags and
		 * attribute names, as specified by http://www.w3.org/TR/html-markup/syntax.html.
		 * 
		 * Capturing groups:
		 * 
		 * 1. If it is an end tag, this group will have the '/'.
		 * 2. The tag name.
		 */
		htmlRegex : (function() {
			var tagNameRegex = /[0-9a-zA-Z:]+/,
			    attrNameRegex = /[^\s\0"'>\/=\x01-\x1F\x7F]+/,   // the unicode range accounts for excluding control chars, and the delete char
			    attrValueRegex = /(?:".*?"|'.*?'|[^'"=<>`\s]+)/; // double quoted, single quoted, or unquoted attribute values
			
			return new RegExp( [
				'<(/)?',  // Beginning of a tag. Either '<' for a start tag, or '</' for an end tag. The slash or an empty string is Capturing Group 1.
				
					// The tag name (Capturing Group 2)
					'(' + tagNameRegex.source + ')',
					
					// Zero or more attributes following the tag name
					'(?:',
						'\\s+',  // one or more whitespace chars before an attribute
						attrNameRegex.source,
						'(?:\\s*=\\s*' + attrValueRegex.source + ')?',  // optional '=[value]'
					')*',
					
					'\\s*',  // any trailing spaces before the closing '>'
				'>'
			].join( "" ), 'g' );
		} )(),

		/**
		 * @private
		 * @property {RegExp} urlPrefixRegex
		 * 
		 * A regular expression used to remove the 'http://' or 'https://' and/or the 'www.' from URLs.
		 */
		urlPrefixRegex: /^(https?:\/\/)?(www\.)?/,
		
		
		/**
		 * Automatically links URLs, email addresses, and Twitter handles found in the given chunk of HTML. 
		 * Does not link URLs found within HTML tags.
		 * 
		 * For instance, if given the text: `You should go to http://www.yahoo.com`, then the result
		 * will be `You should go to &lt;a href="http://www.yahoo.com"&gt;http://www.yahoo.com&lt;/a&gt;`
		 * 
		 * @method link
		 * @param {String} textOrHtml The HTML or text to link URLs, email addresses, and Twitter handles within.
		 * @return {String} The HTML, with URLs/emails/twitter handles automatically linked.
		 */
		link : function( textOrHtml ) {
			return this.processHtml( textOrHtml );
		},
		
		
		/**
		 * Processes the given HTML to auto-link URLs/emails/Twitter handles.
		 * 
		 * Finds the text around any HTML elements in the input `html`, which will be the text that is processed.
		 * Any original HTML elements will be left as-is, as well as the text that is already wrapped in anchor tags.
		 * 
		 * @private
		 * @method processHtml
		 * @param {String} html The input text or HTML to process in order to auto-link.
		 * @return {String}
		 */
		processHtml : function( html ) {
			// Loop over the HTML string, ignoring HTML tags, and processing the text that lies between them,
			// wrapping the URLs in anchor tags
			var htmlRegex = this.htmlRegex,
			    currentResult,
			    inBetweenTagsText,
			    lastIndex = 0,
			    anchorTagStackCount = 0,
			    resultHtml = [];
			
			while( ( currentResult = htmlRegex.exec( html ) ) !== null ) {
				var tagText = currentResult[ 0 ],
				    tagName = currentResult[ 2 ],
				    isClosingTag = !!currentResult[ 1 ];
				
				inBetweenTagsText = html.substring( lastIndex, currentResult.index );
				lastIndex = currentResult.index + tagText.length;
				
				// Process around anchor tags, and any inner text / html they may have
				if( tagName === 'a' ) {
					if( !isClosingTag ) {  // it's the start <a> tag
						anchorTagStackCount++;
						resultHtml.push( this.processTextNode( inBetweenTagsText ) );
						
					} else {   // it's the end </a> tag
						anchorTagStackCount = Math.max( anchorTagStackCount - 1, 0 );  // attempt to handle extraneous </a> tags by making sure the stack count never goes below 0
						if( anchorTagStackCount === 0 ) {
							resultHtml.push( inBetweenTagsText );  // We hit the matching </a> tag, simply add all of the text from the start <a> tag to the end </a> tag without linking it
						}
					}
					
				} else if( anchorTagStackCount === 0 ) {   // not within an anchor tag, link the "in between" text
					resultHtml.push( this.processTextNode( inBetweenTagsText ) );
					
				} else {
					// if we have a tag that is in between anchor tags (ex: <a href="..."><b>google.com</b></a>),
					// just append the inner text
					resultHtml.push( inBetweenTagsText );  
				}
				
				resultHtml.push( tagText );  // now add the text of the tag itself verbatim
			}
			
			// Process any remaining text after the last HTML element. Will process all of the text if there were no HTML elements.
			if( lastIndex < html.length ) {
				var processedTextNode = this.processTextNode( html.substring( lastIndex ) );
				resultHtml.push( processedTextNode );
			}
			
			return resultHtml.join( "" );
		},
		
		
		/**
		 * Process the text that lies inbetween HTML tags. This method does the actual wrapping of URLs with
		 * anchor tags.
		 * 
		 * @private
		 * @param {String} text The text to auto-link.
		 * @return {String} The text with anchor tags auto-filled.
		 */
		processTextNode : function( text ) {
			var me = this,  // for closures
			    matcherRegex = this.matcherRegex,
			    enableTwitter = this.twitter,
			    enableEmailAddresses = this.email,
			    enableUrls = this.urls;
			
			return text.replace( matcherRegex, function( matchStr, $1, $2, $3, $4, $5, $6, $7 ) {
				var twitterMatch = $1,
				    twitterHandlePrefixWhitespaceChar = $2,  // The whitespace char before the @ sign in a Twitter handle match. This is needed because of no lookbehinds in JS regexes
				    twitterHandle = $3,   // The actual twitterUser (i.e the word after the @ sign in a Twitter handle match)
				    emailAddress = $4,    // For both determining if it is an email address, and stores the actual email address
				    urlMatch = $5,        // The matched URL string
				    protocolRelativeMatch = $6 || $7,  // The '//' for a protocol-relative match, with the character that comes before the '//'
				    
				    prefixStr = "",       // A string to use to prefix the anchor tag that is created. This is needed for the Twitter handle match
				    suffixStr = "";       // A string to suffix the anchor tag that is created. This is used if there is a trailing parenthesis that should not be auto-linked.
				
				// Early exits with no replacements for:
				// 1) Disabled link types
				// 2) URL matches which do not have at least have one period ('.') in the domain name (effectively skipping over 
				//    matches like "abc:def")
				// 3) A protocol-relative url match (a URL beginning with '//') whose previous character is a word character 
				//    (effectively skipping over strings like "abc//google.com")
				if( 
				    ( twitterMatch && !enableTwitter ) || ( emailAddress && !enableEmailAddresses ) || ( urlMatch && !enableUrls ) ||
				    ( urlMatch && urlMatch.indexOf( '.' ) === -1 ) ||  // At least one period ('.') must exist in the URL match for us to consider it an actual URL
				    ( urlMatch && /^[A-Za-z]{3,9}:/.test( urlMatch ) && !/:.*?[A-Za-z]/.test( urlMatch ) ) ||  // At least one letter character must exist in the domain name after a protocol match. Ex: skip over something like "git:1.0"
				    ( protocolRelativeMatch && /^[\w]\/\//.test( protocolRelativeMatch ) )  // a protocol-relative match which has a word character in front of it (so we can skip something like "abc//google.com")
				) {
					return matchStr;
				}
				
				
				// Handle a closing parenthesis at the end of the match, and exclude it if there is not a matching open parenthesis
				// in the match. This handles cases like the string "wikipedia.com/something_(disambiguation)" (which should be auto-
				// linked, and when it is enclosed in parenthesis itself, such as: "(wikipedia.com/something_(disambiguation))" (in
				// which the outer parens should *not* be auto-linked.
				var lastChar = matchStr.charAt( matchStr.length - 1 );
				if( lastChar === ')' ) {
					var openParensMatch = matchStr.match( /\(/g ),
					    closeParensMatch = matchStr.match( /\)/g ),
					    numOpenParens = ( openParensMatch && openParensMatch.length ) || 0,
					    numCloseParens = ( closeParensMatch && closeParensMatch.length ) || 0;
					
					if( numOpenParens < numCloseParens ) {
						matchStr = matchStr.substr( 0, matchStr.length - 1 );  // remove the trailing ")"
						suffixStr = ")";  // this will be added after the <a> tag
					}
				}
				
				
				var anchorHref = matchStr,  // initialize both of these
				    anchorText = matchStr,  // values as the full match
				    linkType;

				// Process the urls that are found. We need to change URLs like "www.yahoo.com" to "http://www.yahoo.com" (or the browser
				// will try to direct the user to "http://current-domain.com/www.yahoo.com"), and we need to prefix 'mailto:' to email addresses.
				if( twitterMatch ) {
					linkType = 'twitter';
					prefixStr = twitterHandlePrefixWhitespaceChar;
					anchorHref = 'https://twitter.com/' + twitterHandle;
					anchorText = '@' + twitterHandle;
					
				} else if( emailAddress ) {
					linkType = 'email';
					anchorHref = 'mailto:' + emailAddress;
					anchorText = emailAddress;
					
				} else {  // url match
					linkType = 'url';
					
					if( protocolRelativeMatch ) {
						// Strip off any protocol-relative '//' from the anchor text (leaving the previous non-word character 
						// intact, if there is one)
						var protocolRelRegex = new RegExp( "^" + me.protocolRelativeRegex.source ),  // for this one, we want to only match at the beginning of the string
						    charBeforeMatch = protocolRelativeMatch.match( protocolRelRegex )[ 1 ] || "";
						
						prefixStr = charBeforeMatch + prefixStr;  // re-add the character before the '//' to what will be placed before the <a> tag
						anchorHref = anchorHref.replace( protocolRelRegex, "//" );  // remove the char before the match for the href
						anchorText = anchorText.replace( protocolRelRegex, "" );    // remove both the char before the match and the '//' for the anchor text

					} else if( !/^[A-Za-z]{3,9}:/i.test( anchorHref ) ) {
						// url string doesn't begin with a protocol, assume http://
						anchorHref = 'http://' + anchorHref;
					}
				}

				// wrap the match in an anchor tag
				var anchorTag = me.createAnchorTag( linkType, anchorHref, anchorText );
				return prefixStr + anchorTag + suffixStr;
			} );
		},
		
		
		/**
		 * Generates the actual anchor (&lt;a&gt;) tag to use in place of a source url/email/twitter link.
		 * 
		 * @private
		 * @param {"url"/"email"/"twitter"} linkType The type of link that an anchor tag is being generated for.
		 * @param {String} anchorHref The href for the anchor tag.
		 * @param {String} anchorText The anchor tag's text (i.e. what will be displayed).
		 * @return {String} The full HTML for the anchor tag.
		 */
		createAnchorTag : function( linkType, anchorHref, anchorText ) {
			var attributesStr = this.createAnchorAttrsStr( linkType, anchorHref );
			anchorText = this.processAnchorText( anchorText );
			
			return '<a ' + attributesStr + '>' + anchorText + '</a>';
		},
		
		
		/**
		 * Creates the string which will be the HTML attributes for the anchor (&lt;a&gt;) tag being generated.
		 * 
		 * @private
		 * @param {"url"/"email"/"twitter"} linkType The type of link that an anchor tag is being generated for.
		 * @param {String} href The href for the anchor tag.
		 * @return {String} The anchor tag's attribute. Ex: `href="http://google.com" class="myLink myLink-url" target="_blank"` 
		 */
		createAnchorAttrsStr : function( linkType, anchorHref ) {
			var attrs = [ 'href="' + anchorHref + '"' ];  // we'll always have the `href` attribute
			
			var cssClass = this.createCssClass( linkType );
			if( cssClass ) {
				attrs.push( 'class="' + cssClass + '"' );
			}
			if( this.newWindow ) {
				attrs.push( 'target="_blank"' );
			}
			
			return attrs.join( " " );
		},
		
		
		/**
		 * Creates the CSS class that will be used for a given anchor tag, based on the `linkType` and the {@link #className}
		 * config.
		 * 
		 * @private
		 * @param {"url"/"email"/"twitter"} linkType The type of link that an anchor tag is being generated for.
		 * @return {String} The CSS class string for the link. Example return: "myLink myLink-url". If no {@link #className}
		 *   was configured, returns an empty string.
		 */
		createCssClass : function( linkType ) {
			var className = this.className;
			
			if( !className ) 
				return "";
			else
				return className + " " + className + "-" + linkType;  // ex: "myLink myLink-url", "myLink myLink-email", or "myLink myLink-twitter"
		},
		
		
		/**
		 * Processes the `anchorText` by stripping the URL prefix (if {@link #stripPrefix} is `true`), removing
		 * any trailing slash, and truncating the text according to the {@link #truncate} config.
		 * 
		 * @private
		 * @param {String} anchorText The anchor tag's text (i.e. what will be displayed).
		 * @return {String} The processed `anchorText`.
		 */
		processAnchorText : function( anchorText ) {
			if( this.stripPrefix ) {
				anchorText = this.stripUrlPrefix( anchorText );
			}
			anchorText = this.removeTrailingSlash( anchorText );  // remove trailing slash, if there is one
			anchorText = this.doTruncate( anchorText );
			
			return anchorText;
		},
		
		
		/**
		 * Strips the URL prefix (such as "http://" or "https://") from the given text.
		 * 
		 * @private
		 * @param {String} text The text of the anchor that is being generated, for which to strip off the
		 *   url prefix (such as stripping off "http://")
		 * @return {String} The `anchorText`, with the prefix stripped.
		 */
		stripUrlPrefix : function( text ) {
			return text.replace( this.urlPrefixRegex, '' );
		},
		
		
		/**
		 * Removes any trailing slash from the given `anchorText`, in prepration for the text to be displayed.
		 * 
		 * @private
		 * @param {String} anchorText The text of the anchor that is being generated, for which to remove any trailing
		 *   slash ('/') that may exist.
		 * @return {String} The `anchorText`, with the trailing slash removed.
		 */
		removeTrailingSlash : function( anchorText ) {
			if( anchorText.charAt( anchorText.length - 1 ) === '/' ) {
				anchorText = anchorText.slice( 0, -1 );
			}
			return anchorText;
		},
		
		
		/**
		 * Performs the truncation of the `anchorText`, if the `anchorText` is longer than the {@link #truncate} option.
		 * Truncates the text to 2 characters fewer than the {@link #truncate} option, and adds ".." to the end.
		 * 
		 * @private
		 * @param {String} text The anchor tag's text (i.e. what will be displayed).
		 * @return {String} The truncated anchor text.
		 */
		doTruncate : function( anchorText ) {
			var truncateLen = this.truncate;
			
			// Truncate the anchor text if it is longer than the provided 'truncate' option
			if( truncateLen && anchorText.length > truncateLen ) {
				anchorText = anchorText.substring( 0, truncateLen - 2 ) + '..';
			}
			return anchorText;
		}
	
	};
	
	
	/**
	 * Automatically links URLs, email addresses, and Twitter handles found in the given chunk of HTML. 
	 * Does not link URLs found within HTML tags.
	 * 
	 * For instance, if given the text: `You should go to http://www.yahoo.com`, then the result
	 * will be `You should go to &lt;a href="http://www.yahoo.com"&gt;http://www.yahoo.com&lt;/a&gt;`
	 * 
	 * Example:
	 * 
	 *     var linkedText = Autolinker.link( "Go to google.com", { newWindow: false } );
	 *     // Produces: "Go to <a href="http://google.com">google.com</a>"
	 * 
	 * @static
	 * @method link
	 * @param {String} html The HTML text to link URLs within.
	 * @param {Object} [options] Any of the configuration options for the Autolinker class, specified in an Object (map).
	 *   See the class description for an example call.
	 * @return {String} The HTML text, with URLs automatically linked
	 */
	Autolinker.link = function( text, options ) {
		var autolinker = new Autolinker( options );
		return autolinker.link( text );
	};

	
	return Autolinker;
	
} ) );
!function(){"use strict";function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(t.__proto__=n)}function n(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function e(t,n,e,o){for(var r=0,i=t.length,a=[],s=void 0;i>r&&(s=n.next(t[r]));)n=s,r++;if(r>=i)return[];for(;i-1>r;)s=new h(o),a.push(s),n.on(t[r],s),n=s,r++;return s=new h(e),a.push(s),n.on(t[i-1],s),a}function o(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(t.__proto__=n)}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function i(t){return t instanceof d||t instanceof _}function a(t){return t}function s(t,n){return"url"===n?"_blank":null}function u(t){return t=t||{},{attributes:t.linkAttributes||null,defaultProtocol:t.defaultProtocol||"http",events:t.events||null,format:t.format||a,formatHref:t.formatHref||a,newLine:t.newLine||!1,nl2br:!!t.newLine||t.nl2br||!1,tagName:t.tagName||"a",target:t.target||s,linkClass:t.linkClass||"linkified"}}function l(t){for(var n=arguments.length,e=Array(n>1?n-1:0),o=1;n>o;o++)e[o-1]=arguments[o];return"function"==typeof t?t.apply(void 0,e):t}function c(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n["default"]=t,n}var p={__esModule:!0},f=function(){function t(e){n(this,t),this.j=[],this.T=e||null}return t.prototype.on=function(t,n){if(t instanceof Array)for(var e=0;e<t.length;e++)this.j.push([t[e],n]);else this.j.push([t,n])},t.prototype.next=function(t){for(var n=0;n<this.j.length;n++){var e=this.j[n],o=e[1];if(this.test(t,e[0]))return o}return!1},t.prototype.accepts=function(){return!!this.T},t.prototype.test=function(t,n){return t===n},t.prototype.emit=function(){return this.T},t}(),h=function(e){function o(){n(this,o),null!=e&&e.apply(this,arguments)}return t(o,e),o.prototype.test=function(t,n){return t===n||n instanceof RegExp&&n.test(t)},o}(f),g=function(e){function o(){n(this,o),null!=e&&e.apply(this,arguments)}return t(o,e),o.prototype.test=function(t,n){return t instanceof n},o}(f);p.CharacterState=h,p.TokenState=g,p.stateify=e;var m={__esModule:!0},y=function(){function t(n){r(this,t),this.v=n}return t.prototype.toString=function(){return this.v+""},t}(),d=function(t){function n(){r(this,n),null!=t&&t.apply(this,arguments)}return o(n,t),n}(y),b=function(t){function n(){r(this,n),t.call(this,"@")}return o(n,t),n}(y),v=function(t){function n(){r(this,n),t.call(this,":")}return o(n,t),n}(y),k=function(t){function n(){r(this,n),t.call(this,".")}return o(n,t),n}(y),w=function(t){function n(){r(this,n),null!=t&&t.apply(this,arguments)}return o(n,t),n}(y),x=function(t){function n(){r(this,n),null!=t&&t.apply(this,arguments)}return o(n,t),n}(y),O=function(t){function n(){r(this,n),t.call(this,"\n")}return o(n,t),n}(y),L=function(t){function n(){r(this,n),null!=t&&t.apply(this,arguments)}return o(n,t),n}(y),S=function(t){function n(){r(this,n),t.call(this,"+")}return o(n,t),n}(y),T=function(t){function n(){r(this,n),t.call(this,"#")}return o(n,t),n}(y),j=function(t){function n(){r(this,n),null!=t&&t.apply(this,arguments)}return o(n,t),n}(y),z=function(t){function n(){r(this,n),t.call(this,"?")}return o(n,t),n}(y),N=function(t){function n(){r(this,n),t.call(this,"/")}return o(n,t),n}(y),A=function(t){function n(){r(this,n),null!=t&&t.apply(this,arguments)}return o(n,t),n}(y),_=function(t){function n(){r(this,n),null!=t&&t.apply(this,arguments)}return o(n,t),n}(y),C=function(t){function n(){r(this,n),null!=t&&t.apply(this,arguments)}return o(n,t),n}(y),U={Base:y,DOMAIN:d,AT:b,COLON:v,DOT:k,PUNCTUATION:w,LOCALHOST:x,NL:O,NUM:L,PLUS:S,POUND:T,QUERY:z,PROTOCOL:j,SLASH:N,SYM:A,TLD:_,WS:C},M=function(){function t(n){r(this,t),this.v=n,this.type="token",this.isLink=!1}return t.prototype.toString=function(){for(var t=[],n=0;n<this.v.length;n++)t.push(this.v[n].toString());return t.join("")},t.prototype.toHref=function(){return this.toString()},t.prototype.toObject=function(t){return{type:this.type,value:this.toString(),href:this.toHref(void 0===t?"http":t)}},t}(),P=function(t){function n(e){r(this,n),t.call(this,e),this.type="email",this.isLink=!0}return o(n,t),n.prototype.toHref=function(){return"mailto:"+this.toString()},n}(M),E=function(t){function n(e){r(this,n),t.call(this,e),this.type="text"}return o(n,t),n}(M),D=function(t){function n(e){r(this,n),t.call(this,e),this.type="nl"}return o(n,t),n}(M),H=function(t){function n(e){r(this,n),t.call(this,e),this.type="url",this.isLink=!0}return o(n,t),n.prototype.toHref=function(t){t=void 0===t?"http":t;for(var n=!1,e=!1,o=this.v,r=[],a=0;o[a]instanceof j;)n=!0,r.push(o[a].toString().toLowerCase()),a++;for(;o[a]instanceof N;)e=!0,r.push(o[a].toString()),a++;for(;i(o[a]);)r.push(o[a].toString().toLowerCase()),a++;for(;a<o.length;a++)r.push(o[a].toString());return r=r.join(""),n||e||(r=t+"://"+r),r},n.prototype.hasProtocol=function(){return this.v[0]instanceof j},n}(M),q={Base:M,EMAIL:P,NL:D,TEXT:E,URL:H};m.text=U,m.multi=q;var R={__esModule:!0},I=m,Y=p,Q=function(t){return new Y.TokenState(t)},B=I.text.DOMAIN,K=I.text.AT,W=I.text.COLON,X=I.text.DOT,F=I.text.PUNCTUATION,G=I.text.LOCALHOST,J=I.text.NL,V=I.text.NUM,Z=I.text.PLUS,$=I.text.POUND,tt=I.text.PROTOCOL,nt=I.text.QUERY,et=I.text.SLASH,ot=I.text.SYM,rt=I.text.TLD,it=I.multi.EMAIL,at=I.multi.NL,st=I.multi.TEXT,ut=I.multi.URL,lt=Q(),ct=Q(),pt=Q(),ft=Q(),ht=Q(),gt=Q(),mt=Q(ut),yt=Q(),dt=Q(ut),bt=Q(),vt=Q(),kt=Q(ut),wt=Q(),xt=Q(ut),Ot=Q(ut),Lt=Q(),St=Q(),Tt=Q(),jt=Q(it),zt=Q(),Nt=Q(it),At=Q(),_t=Q(),Ct=Q(),Ut=Q(at);lt.on(J,Ut),lt.on(tt,ct),lt.on(et,pt),ct.on(et,pt),pt.on(et,ft),lt.on(rt,ht),lt.on(B,ht),lt.on(G,mt),lt.on(V,ht),ft.on(rt,bt),ft.on(B,bt),ft.on(V,bt),ft.on(G,kt),ht.on(X,gt),bt.on(X,vt),St.on(X,Tt),gt.on(rt,mt),gt.on(B,ht),gt.on(V,ht),gt.on(G,ht),vt.on(rt,kt),vt.on(B,bt),vt.on(V,bt),vt.on(G,bt),Tt.on(rt,jt),Tt.on(B,St),Tt.on(V,St),Tt.on(G,St),mt.on(X,gt),kt.on(X,vt),jt.on(X,Tt),mt.on(W,yt),mt.on(et,Ot),yt.on(V,dt),dt.on(et,Ot),kt.on(W,wt),kt.on(et,Ot),wt.on(V,xt),xt.on(et,Ot),jt.on(W,zt),zt.on(V,Nt);var Mt=[B,K,G,V,Z,$,tt,et,rt,ot],Pt=[W,X,nt,F];Ot.on(Mt,Ot),Lt.on(Mt,Ot),Ot.on(Pt,Lt),Lt.on(Pt,Lt);var Et=[B,V,Z,$,nt,ot,rt];ht.on(Et,At),ht.on(K,_t),gt.on(Et,At),mt.on(Et,At),mt.on(K,_t),At.on(Et,At),At.on(K,_t),At.on(X,Ct),Ct.on(Et,At),_t.on(rt,St),_t.on(B,St),_t.on(G,jt);var Dt=function(t){for(var n=t.length,e=0,o=[],r=[];n>e;){for(var i=lt,a=null,s=null,u=0,l=null,c=-1;n>e&&!(a=i.next(t[e]));)r.push(t[e++]);for(;n>e&&(s=a||i.next(t[e]));)a=null,i=s,i.accepts()?(c=0,l=i):c>=0&&c++,e++,u++;if(0>c)for(u=e-u;e>u;u++)r.push(t[u]);else 0<r.length&&(o.push(new st(r)),r=[]),e-=c,u-=c,i=l.emit(),o.push(new i(t.slice(e-u,e)))}return 0<r.length&&o.push(new st(r)),o},Ht=I.multi,qt=lt;R.State=Y.TokenState,R.TOKENS=Ht,R.run=Dt,R.start=qt;var Rt={__esModule:!0},It=m,Yt=p,Qt="abogado ac academy accountants active actor ad adult ae aero af ag agency ai airforce al allfinanz alsace am an android ao aq aquarelle ar archi army arpa as asia associates at attorney au auction audio autos aw ax axa az ba band bar bargains bayern bb bd be beer berlin best bf bg bh bi bid bike bio biz bj black blackfriday bloomberg blue bm bmw bn bnpparibas bo boo boutique br brussels bs bt budapest build builders business buzz bv bw by bz bzh ca cab cal camera camp cancerresearch capetown capital caravan cards care career careers casa cash cat catering cc cd center ceo cern cf cg ch channel cheap christmas chrome church ci citic city ck cl claims cleaning click clinic clothing club cm cn co coach codes coffee college cologne com community company computer condos construction consulting contractors cooking cool coop country cr credit creditcard cricket crs cruises cu cuisinella cv cw cx cy cymru cz dad dance dating day de deals degree delivery democrat dental dentist desi diamonds diet digital direct directory discount dj dk dm dnp do domains durban dvag dz eat ec edu education ee eg email emerck energy engineer engineering enterprises equipment er es esq estate et eu eurovision eus events everbank exchange expert exposed fail farm fashion feedback fi finance financial firmdale fish fishing fitness fj fk flights florist flsmidth fly fm fo foo forsale foundation fr frl frogans fund furniture futbol ga gal gallery gb gbiz gd ge gent gf gg gh gi gift gifts gives gl glass gle global globo gm gmail gmo gmx gn google gop gov gp gq gr graphics gratis green gripe gs gt gu guide guitars guru gw gy hamburg haus healthcare help here hiphop hiv hk hm hn holdings holiday homes horse host hosting house how hr ht hu ibm id ie il im immo immobilien in industries info ing ink institute insure int international investments io iq ir irish is it je jetzt jm jo jobs joburg jp juegos kaufen ke kg kh ki kim kitchen kiwi km kn koeln kp kr krd kred kw ky kz la lacaixa land latrobe lawyer lb lc lds lease legal lgbt li life lighting limited limo link lk loans london lotto lr ls lt ltda lu luxe luxury lv ly ma madrid maison management mango market marketing mc md me media meet melbourne meme memorial menu mg mh miami mil mini mk ml mm mn mo mobi moda moe monash money mormon mortgage moscow motorcycles mov mp mq mr ms mt mu museum mv mw mx my mz na nagoya name navy nc ne net network neustar new nexus nf ng ngo nhk ni ninja nl no np nr nra nrw nu nyc nz okinawa om ong onl ooo org organic otsuka ovh pa paris partners parts party pe pf pg ph pharmacy photo photography photos physio pics pictures pink pizza pk pl place plumbing pm pn pohl poker porn post pr praxi press pro prod productions prof properties property ps pt pub pw py qa qpon quebec re realtor recipes red rehab reise reisen reit ren rentals repair report republican rest restaurant reviews rich rio rip ro rocks rodeo rs rsvp ru ruhr rw ryukyu sa saarland sarl sb sc sca scb schmidt schule science scot sd se services sexy sg sh shiksha shoes si singles sj sk sl sm sn so social software sohu solar solutions soy space spiegel sr st su supplies supply support surf surgery suzuki sv sx sy sydney systems sz taipei tatar tattoo tax tc td technology tel tf tg th tienda tips tirol tj tk tl tm tn to today tokyo tools top town toys tp tr trade training travel trust tt tui tv tw tz ua ug uk university uno uol us uy uz va vacations vc ve vegas ventures versicherung vet vg vi viajes villas vision vlaanderen vn vodka vote voting voto voyage vu wales wang watch webcam website wed wedding wf whoswho wien wiki williamhill wme work works world ws wtc wtf xxx xyz yachts yandex ye yoga yokohama youtube yt za zip zm zone zw".split(" "),Bt=/[0-9]/,Kt=/[a-z0-9]/,Wt=":",Xt=[],Ft=function(t){return new Yt.CharacterState(t)},Gt=It.text.DOMAIN,Jt=It.text.LOCALHOST,Vt=It.text.NUM,Zt=It.text.PROTOCOL,$t=It.text.TLD,tn=It.text.WS,nn=Ft(),en=Ft(Vt),on=Ft(Gt),rn=Ft(),an=Ft(tn);nn.on("@",Ft(It.text.AT)),nn.on(".",Ft(It.text.DOT)),nn.on("+",Ft(It.text.PLUS)),nn.on("#",Ft(It.text.POUND)),nn.on("?",Ft(It.text.QUERY)),nn.on("/",Ft(It.text.SLASH)),nn.on(Wt,Ft(It.text.COLON)),nn.on(/[,;!]/,Ft(It.text.PUNCTUATION)),nn.on(/\n/,Ft(It.text.NL)),nn.on(/\s/,an),an.on(/[^\S\n]/,an);for(var sn=0;sn<Qt.length;sn++){var un=Yt.stateify(Qt[sn],nn,$t,Gt);Xt.push.apply(Xt,un)}var ln=Yt.stateify("file",nn,Gt,Gt),cn=Yt.stateify("ftp",nn,Gt,Gt),pn=Yt.stateify("http",nn,Gt,Gt);Xt.push.apply(Xt,ln),Xt.push.apply(Xt,cn),Xt.push.apply(Xt,pn);var fn=ln.pop(),hn=cn.pop(),gn=pn.pop(),mn=Ft(Gt),yn=Ft(Zt);hn.on("s",mn),gn.on("s",mn),Xt.push(mn),fn.on(Wt,yn),hn.on(Wt,yn),gn.on(Wt,yn),mn.on(Wt,yn);var dn=Yt.stateify("localhost",nn,Jt,Gt);for(Xt.push.apply(Xt,dn),nn.on(Bt,en),en.on("-",rn),en.on(Bt,en),en.on(Kt,on),on.on("-",rn),on.on(Kt,on),sn=0;sn<Xt.length;sn++)Xt[sn].on("-",rn),Xt[sn].on(Kt,on);rn.on("-",rn),rn.on(Bt,on),rn.on(Kt,on),nn.on(/./,Ft(It.text.SYM));var bn=function(t){for(var n=t.toLowerCase(),e=t.length,o=0,r=[];e>o;){for(var i=nn,a=null,s=0,u=null,l=-1;e>o&&(a=i.next(n[o]));)i=a,i.accepts()?(l=0,u=i):l>=0&&l++,s++,o++;0>l||(o-=l,s-=l,i=u.emit(),r.push(new i(t.substr(o-s,s))))}return r},vn=nn;Rt.State=Yt.CharacterState,Rt.TOKENS=It.text,Rt.run=bn,Rt.start=vn;var kn={__esModule:!0};kn.normalize=u,kn.resolve=l;var wn={__esModule:!0},xn=kn,On=c(xn),Ln=Rt,Sn=c(Ln),Tn=R,jn=c(Tn);Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var zn=function(t){return jn.run(Sn.run(t))},Nn=function(t,n){for(var e=void 0===n?null:n,o=zn(t),r=[],i=0;i<o.length;i++)!o[i].isLink||e&&o[i].type!==e||r.push(o[i].toObject());return r},An=function(t,n){var e=void 0===n?null:n,o=zn(t);return 1===o.length&&o[0].isLink&&(!e||o[0].type===e)};wn.find=Nn,wn.options=On,wn.parser=jn,wn.scanner=Sn,wn.test=An,wn.tokenize=zn,window.linkify=wn}();!function(e,t){"use strict";function n(e,t,n){var i=n[n.length-1];e.replaceChild(i,t);for(var r=n.length-2;r>=0;r--)e.insertBefore(n[r],i),i=n[r]}function i(e,t,n){for(var i=[],r=0;r<e.length;r++){var o=e[r];if(o.isLink){var a=o.toHref(t.defaultProtocol),l=f.resolve(t.format,o.toString(),o.type),s=f.resolve(t.formatHref,a,o.type),u=f.resolve(t.attributes,a,o.type),d=f.resolve(t.tagName,a,o.type),c=f.resolve(t.linkClass,a,o.type),m=f.resolve(t.target,a,o.type),y=f.resolve(t.events,a,o.type),v=n.createElement(d);if(v.setAttribute("href",s),v.setAttribute("class",c),m&&v.setAttribute("target",m),u)for(var h in u)v.setAttribute(h,u[h]);if(y)for(var k in y)v.addEventListener?v.addEventListener(k,y[k]):v.attachEvent&&v.attachEvent("on"+k,y[k]);v.appendChild(n.createTextNode(l)),i.push(v)}else i.push("nl"===o.type&&t.nl2br?n.createElement("br"):n.createTextNode(o.toString()))}return i}function r(e,t,o){if(!e||"object"!=typeof e||e.nodeType!==s)throw new Error("Cannot linkify "+e+" - Invalid DOM Node type");if("A"===e.tagName)return e;for(var a=e.firstChild;a;){switch(a.nodeType){case s:r(a,t,o);break;case u:var f=a.nodeValue,d=l(f),c=i(d,t,o);n(e,a,c),a=c[c.length-1]}a=a.nextSibling}return e}function o(e,t){var n=void 0===arguments[2]?null:arguments[2];try{n=n||window&&window.document||global&&global.document}catch(i){}if(!n)throw new Error("Cannot find document implementation. If you are in a non-browser environment like Node.js, pass the document implementation as the third argument to linkifyElement.");return t=f.normalize(t),r(e,t,n)}function a(e){function t(e){return e=o.normalize(e),this.each(function(){o.helper(this,e,n)})}var n=void 0===arguments[1]?null:arguments[1];e.fn=e.fn||{};try{n=n||window&&window.document||global&&global.document}catch(i){}if(!n)throw new Error("Cannot find document implementation. If you are in a non-browser environment like Node.js, pass the document implementation as the third argument to linkifyElement.");"function"!=typeof e.fn.linkify&&(e.fn.linkify=t,e(n).ready(function(){e("[data-linkify]").each(function(){var t=e(this),n=t.data(),i=n.linkify,r=n.linkifyNlbr,o={linkAttributes:n.linkifyAttributes,defaultProtocol:n.linkifyDefaultProtocol,events:n.linkifyEvents,format:n.linkifyFormat,formatHref:n.linkifyFormatHref,newLine:n.linkifyNewline,nl2br:!!r&&0!==r&&"false"!==r,tagName:n.linkifyTagname,target:n.linkifyTarget,linkClass:n.linkifyLinkclass},a="this"===i?t:t.find(i);a.linkify(o)})}))}var l=t.tokenize,f=t.options,s=1,u=3;o.helper=r,o.normalize=f.normalize;var d=void 0;try{d=document}catch(c){d=null}"undefined"!=typeof e&&d&&a(e,d),window.linkifyElement=o}(window.jQuery,window.linkify);/**
* noty - jQuery Notification Plugin v2.0.3
* Contributors: https://github.com/needim/noty/graphs/contributors
*
* Examples and Documentation - http://needim.github.com/noty/
*
* Licensed under the MIT licenses:
* http://www.opensource.org/licenses/mit-license.php
*
**/

if (typeof Object.create !== 'function') {
	Object.create = function (o) {
		function F() {};
		F.prototype = o;
		return new F();
	};
};

;(function($) {

	var NotyObject = {

		init: function(options) {

			// Mix in the passed in options with the default options
			this.options = $.extend({}, $.noty.defaults, options);

			this.options.layout = (this.options.custom) ? $.noty.layouts['inline'] : $.noty.layouts[this.options.layout];
			this.options.theme = $.noty.themes[this.options.theme];

			delete options.layout, delete options.theme;

			this.options = $.extend({}, this.options, this.options.layout.options);
			this.options.id = 'noty_' + (new Date().getTime() * Math.floor(Math.random()* 1000000));

			this.options = $.extend({}, this.options, options);

			// Build the noty dom initial structure
			this._build();

			// return this so we can chain/use the bridge with less code.
			return this;
		}, // end init

		_build: function() {

			// Generating noty bar
			var $bar = $('<div class="noty_bar"/>').attr('id', this.options.id);
			$bar.append(this.options.template).find('.noty_text').html(this.options.text);

			this.$bar = (this.options.layout.parent.object !== null) ? $(this.options.layout.parent.object).css(this.options.layout.parent.css).append($bar) : $bar;

			// Set buttons if available
			if (this.options.buttons) {

				// If we have button disable closeWith & timeout options
				this.options.closeWith = [], this.options.timeout = false;

				var $buttons = $('<div/>').addClass('noty_buttons');

				(this.options.layout.parent.object !== null) ? this.$bar.find('.noty_bar').append($buttons) : this.$bar.append($buttons);

				var self = this;

				$.each(this.options.buttons, function(i, button) {
					var $button = $('<button/>').addClass((button.addClass) ? button.addClass : 'gray').html(button.text)
					.appendTo(self.$bar.find('.noty_buttons'))
					.bind('click', function(e) { if ($.isFunction(button.onClick)) { button.onClick.call($button, self); } });
				});
			}

			// For easy access
			this.$message = this.$bar.find('.noty_message');
			this.$closeButton = this.$bar.find('.noty_close');
			this.$buttons = this.$bar.find('.noty_buttons');

			$.noty.store[this.options.id] = this; // store noty for api

		}, // end _build

		show: function() {

			var self = this;

			$(self.options.layout.container.selector).append(self.$bar);

			self.options.theme.style.apply(self);

			($.type(self.options.layout.css) === 'function') ? this.options.layout.css.apply(self.$bar) : self.$bar.css(this.options.layout.css || {});

			self.$bar.addClass(self.options.layout.addClass);

			self.options.layout.container.style.apply($(self.options.layout.container.selector));

			self.options.theme.callback.onShow.apply(this);

			if ($.inArray('click', self.options.closeWith) > -1)
				self.$bar.css('cursor', 'pointer').one('click', function() { self.close(); });

			if ($.inArray('hover', self.options.closeWith) > -1)
				self.$bar.one('mouseenter', function() { self.close(); });

			if ($.inArray('button', self.options.closeWith) > -1)
				self.$closeButton.one('click', function() { self.close(); });

			if ($.inArray('button', self.options.closeWith) == -1)
				self.$closeButton.remove();

			if (self.options.callback.onShow)
				self.options.callback.onShow.apply(self);

			self.$bar.animate(
					self.options.animation.open,
					self.options.animation.speed,
					self.options.animation.easing,
					function() { 
						if (self.options.callback.afterShow) self.options.callback.afterShow.apply(self);
						self.shown = true;
					});

			// If noty is have a timeout option
			if (self.options.timeout)
				self.$bar.delay(self.options.timeout).promise().done(function() { self.close(); });

			return this;

		}, // end show

		close: function() {

			if (this.closed) return;

			var self = this;

			if (!this.shown) { // If we are still waiting in the queue just delete from queue
				$.each($.noty.queue, function(i, n) {
					if (n.options.id == self.options.id) {
						$.noty.queue.splice(i, 1);
					}
				});
				return;
			}

			self.$bar.addClass('i-am-closing-now');

			if (self.options.callback.onClose) { self.options.callback.onClose.apply(self); }

			self.$bar.clearQueue().stop().animate(
					self.options.animation.close,
					self.options.animation.speed,
					self.options.animation.easing,
					function() { if (self.options.callback.afterClose) self.options.callback.afterClose.apply(self); })
				.promise().done(function() {

					// Modal Cleaning
					if (self.options.modal) {
						$.notyRenderer.setModalCount(-1);
						if ($.notyRenderer.getModalCount() == 0) $('.noty_modal').fadeOut('fast', function() { $(this).remove(); });
					}

					// Layout Cleaning
					$.notyRenderer.setLayoutCountFor(self, -1);
					if ($.notyRenderer.getLayoutCountFor(self) == 0) $(self.options.layout.container.selector).remove();

					self.$bar.remove();
					self.$bar = null;
					self.closed = true;

					delete $.noty.store[self.options.id]; // deleting noty from store

					if (!self.options.dismissQueue) {
						// Queue render
						$.noty.ontap = true;

						$.notyRenderer.render();
					}

				});

		}, // end close

		setText: function(text) {
			if (!this.closed) {
				this.options.text = text;
				this.$bar.find('.noty_text').html(text);
			}
			return this;
		},

		setType: function(type) {
			if (!this.closed) {
				this.options.type = type;
				this.options.theme.style.apply(this);
				this.options.theme.callback.onShow.apply(this);
			}
			return this;
		},

		closed: false,
		shown: false

	}; // end NotyObject

	$.notyRenderer = {};

	$.notyRenderer.init = function(options) {

		// Renderer creates a new noty
		var notification = Object.create(NotyObject).init(options);

		(notification.options.force) ? $.noty.queue.unshift(notification) : $.noty.queue.push(notification); 

		$.notyRenderer.render();

		return ($.noty.returns == 'object') ? notification : notification.options.id;
	};

	$.notyRenderer.render = function() {

		var instance = $.noty.queue[0];

		if ($.type(instance) === 'object') {
			if (instance.options.dismissQueue) {
				$.notyRenderer.show($.noty.queue.shift());
			} else {
				if ($.noty.ontap) {
					$.notyRenderer.show($.noty.queue.shift());
					$.noty.ontap = false;
				}
			}
		} else {
			$.noty.ontap = true; // Queue is over
		}

	};

	$.notyRenderer.show = function(notification) {

		if (notification.options.modal) {
			$.notyRenderer.createModalFor(notification);
			$.notyRenderer.setModalCount(+1);
		}

		// Where is the container?
		if ($(notification.options.layout.container.selector).length == 0) {
			if (notification.options.custom) {
				notification.options.custom.append($(notification.options.layout.container.object).addClass('i-am-new'));
			} else {
				$('body').append($(notification.options.layout.container.object).addClass('i-am-new'));
			}
		} else {
			$(notification.options.layout.container.selector).removeClass('i-am-new');
		}

		$.notyRenderer.setLayoutCountFor(notification, +1);

		notification.show();
	};

	$.notyRenderer.createModalFor = function(notification) {
		if ($('.noty_modal').length == 0) 
			$('<div/>').addClass('noty_modal').data('noty_modal_count', 0).css(notification.options.theme.modal.css).prependTo($('body')).fadeIn('fast'); 
	};

	$.notyRenderer.getLayoutCountFor = function(notification) {
		return $(notification.options.layout.container.selector).data('noty_layout_count') || 0; 
	};

	$.notyRenderer.setLayoutCountFor = function(notification, arg) {
		return $(notification.options.layout.container.selector).data('noty_layout_count', $.notyRenderer.getLayoutCountFor(notification) + arg); 
	};

	$.notyRenderer.getModalCount = function() {
		return $('.noty_modal').data('noty_modal_count') || 0;
	};

	$.notyRenderer.setModalCount = function(arg) {
		return $('.noty_modal').data('noty_modal_count', $.notyRenderer.getModalCount() + arg); 
	};

	// This is for custom container
	$.fn.noty = function(options) {
		options.custom = $(this);
		return $.notyRenderer.init(options);
	};
	 
	$.noty = {};
	$.noty.queue = [];
	$.noty.ontap = true;
	$.noty.layouts = {};
	$.noty.themes = {};
	$.noty.returns = 'object';
	$.noty.store = {};

	$.noty.get = function(id) {
		return $.noty.store.hasOwnProperty(id) ? $.noty.store[id] : false;
	};

	$.noty.close = function(id) {
		return $.noty.get(id) ? $.noty.get(id).close() : false;
	};

	$.noty.setText = function(id, text) {
		return $.noty.get(id) ? $.noty.get(id).setText(text) : false;
	};

	$.noty.setType = function(id, type) {
		return $.noty.get(id) ? $.noty.get(id).setType(type) : false;
	};

	$.noty.clearQueue = function() {
		$.noty.queue = [];
	};

	$.noty.closeAll = function() {
		$.noty.clearQueue();
		$.each($.noty.store, function(id, noty) {
			noty.close();
		});
	};

	var windowAlert = window.alert;

	$.noty.consumeAlert = function(options) {
		window.alert = function(text) {
			if (options)
				options.text = text;
			else 
				options = {text:text};

			$.notyRenderer.init(options);
		};
	};

	$.noty.stopConsumeAlert = function(){
		window.alert = windowAlert;
	};

	$.noty.defaults = {
		layout: 'top',
		theme: 'default',
		type: 'alert',
		text: '',
		dismissQueue: true,
		template: '<div class="noty_message"><span class="noty_text"></span><div class="noty_close"></div></div>',
		animation: {
			open: {height: 'toggle'},
			close: {height: 'toggle'},
			easing: 'swing',
			speed: 500
		},
		timeout: false,
		force: false,
		modal: false,
		closeWith: ['click'],
		callback: {
			onShow: function() {},
			afterShow: function() {},
			onClose: function() {},
			afterClose: function() {}
		},
		buttons: false
	};

	$(window).resize(function() {
		$.each($.noty.layouts, function(index, layout) {
			layout.container.style.apply($(layout.container.selector));
		});
	});

})(jQuery);

// Helpers
function noty(options) {

	// This is for BC  -  Will be deleted on v2.2.0
	var using_old = 0
	,	old_to_new = {
		'animateOpen': 'animation.open',
		'animateClose': 'animation.close',
		'easing': 'animation.easing',
		'speed': 'animation.speed',
		'onShow': 'callback.onShow',
		'onShown': 'callback.afterShow',
		'onClose': 'callback.onClose',
		'onClosed': 'callback.afterClose'
	}

	jQuery.each(options, function(key, value) {
		if (old_to_new[key]) {
			using_old++;
			var _new = old_to_new[key].split('.');

			if (!options[_new[0]]) options[_new[0]] = {};

			options[_new[0]][_new[1]] = (value) ? value : function() {};
			delete options[key];
		}
	});

	if (!options.closeWith) {
		options.closeWith = jQuery.noty.defaults.closeWith;
	}

	if (options.hasOwnProperty('closeButton')) {
		using_old++;
		if (options.closeButton) options.closeWith.push('button');
		delete options.closeButton;
	}

	if (options.hasOwnProperty('closeOnSelfClick')) {
		using_old++;
		if (options.closeOnSelfClick) options.closeWith.push('click');
		delete options.closeOnSelfClick;
	}

	if (options.hasOwnProperty('closeOnSelfOver')) {
		using_old++;
		if (options.closeOnSelfOver) options.closeWith.push('hover');
		delete options.closeOnSelfOver;
	}

	if (options.hasOwnProperty('custom')) {
		using_old++;
		if (options.custom.container != 'null') options.custom = options.custom.container;
	}

	if (options.hasOwnProperty('cssPrefix')) {
		using_old++;
		delete options.cssPrefix;
	}

	if (options.theme == 'noty_theme_default') {
		using_old++;
		options.theme = 'default';
	}

	if (!options.hasOwnProperty('dismissQueue')) {
		if (options.layout == 'topLeft'
			|| options.layout == 'topRight' 
			|| options.layout == 'bottomLeft'
			|| options.layout == 'bottomRight') {
			options.dismissQueue = true;
		} else {
			options.dismissQueue = false;
		}
	}

	if (options.buttons) {
		jQuery.each(options.buttons, function(i, button) {
			if (button.click) {
				using_old++;
				button.onClick = button.click;
				delete button.click;
			}
			if (button.type) {
				using_old++;
				button.addClass = button.type;
				delete button.type;
			}
		});
	}

	if (using_old) console.warn('You are using noty v2 with v1.x.x options. @deprecated until v2.2.0 - Please update your options.');

	// console.log(options);
	// End of the BC

	return jQuery.notyRenderer.init(options);
};(function($) {

	$.noty.layouts.bottomRight = {
		name: 'bottomRight',
		options: { // overrides options
			
		},
		container: {
			object: '<ul id="noty_bottomRight_layout_container" />',
			selector: 'ul#noty_bottomRight_layout_container',
			style: function() {
				$(this).css({
					bottom: 20,
					right: 20,
					position: 'fixed',
					width: '310px',
					height: 'auto',
					margin: 0,
					padding: 0,
					listStyleType: 'none',
					zIndex: 10000000
				});

				if (window.innerWidth < 600) {
					$(this).css({
						right: 5
					});
				}
			}
		},
		parent: {
			object: '<li />',
			selector: 'li',
			css: {}
		},
		css: {
			display: 'none',
			width: '310px'
		},
		addClass: ''
	};

})(jQuery);;(function($) {

	$.noty.themes.default = {
		name: 'default',
		helpers: {
			borderFix: function() {
				if (this.options.dismissQueue) {
					var selector = this.options.layout.container.selector + ' ' + this.options.layout.parent.selector;
					switch (this.options.layout.name) {
						case 'top':
							$(selector).css({borderRadius: '0px 0px 0px 0px'});
							$(selector).last().css({borderRadius: '0px 0px 5px 5px'}); break;
						case 'topCenter': case 'topLeft': case 'topRight':
						case 'bottomCenter': case 'bottomLeft': case 'bottomRight':
						case 'center': case 'centerLeft': case 'centerRight': case 'inline':
							$(selector).css({borderRadius: '0px 0px 0px 0px'});
							$(selector).first().css({'border-top-left-radius': '5px', 'border-top-right-radius': '5px'});
							$(selector).last().css({'border-bottom-left-radius': '5px', 'border-bottom-right-radius': '5px'}); break;
						case 'bottom':
							$(selector).css({borderRadius: '0px 0px 0px 0px'});
							$(selector).first().css({borderRadius: '5px 5px 0px 0px'}); break;
						default: break;
					}
				}
			}
		},
		modal: {
			css: {
				position: 'fixed',
				width: '100%',
				height: '100%',
				backgroundColor: '#000',
				zIndex: 10000,
				opacity: 0.6,
				display: 'none',
				left: 0,
				top: 0,
			}
		},
		style: function() {
				
			this.$bar.css({
				overflow: 'hidden',
				background: "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAoCAYAAAAPOoFWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAPZJREFUeNq81tsOgjAMANB2ov7/7ypaN7IlIwi9rGuT8QSc9EIDAsAznxvY4pXPKr05RUE5MEVB+TyWfCEl9LZApYopCmo9C4FKSMtYoI8Bwv79aQJU4l6hXXCZrQbokJEksxHo9KMOgc6w1atHXM8K9DVC7FQnJ0i8iK3QooGgbnyKgMDygBWyYFZoqx4qS27KqLZJjA1D0jK6QJcYEQEiWv9PGkTsbqxQ8oT+ZtZB6AkdsJnQDnMoHXHLGKOgDYuCWmYhEERCI5gaamW0bnHdA3k2ltlIN+2qKRyCND0bhqSYCyTB3CAOc4WusBEIpkeBuPgJMAAX8Hs1NfqHRgAAAABJRU5ErkJggg==') repeat-x scroll left top #fff"
			});
			
			this.$message.css({
				fontSize: '13px',
				lineHeight: '16px',
				textAlign: 'center',
				padding: '8px 10px 9px',
				width: 'auto',
				position: 'relative'
			});
			
			this.$closeButton.css({
				position: 'absolute',
				top: 4, right: 4,
				width: 10, height: 10,
				background: "url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAATpJREFUeNoszrFqVFEUheG19zlz7sQ7ijMQBAvfYBqbpJCoZSAQbOwEE1IHGytbLQUJ8SUktW8gCCFJMSGSNxCmFBJO7j5rpXD6n5/P5vM53H3b3T9LOiB5AQDuDjM7BnA7DMPHDGBH0nuSzwHsRcRVRNRSysuU0i6AOwA/02w2+9Fae00SEbEh6SGAR5K+k3zWWptKepCm0+kpyRoRGyRBcpPkDsn1iEBr7drdP2VJZyQXERGSPpiZAViTBACXKaV9kqd5uVzCzO5KKb/d/UZSDwD/eyxqree1VqSu6zKAF2Z2RPJJaw0rAkjOJT0m+SuT/AbgDcmnkmBmfwAsJL1dXQ8lWY6IGwB1ZbrOOb8zs8thGP4COFwx/mE8Ho9Go9ErMzvJOW/1fY/JZIJSypqZfXX3L13X9fcDAKJct1sx3OiuAAAAAElFTkSuQmCC)",
				display: 'none',
				cursor: 'pointer',
			});
			
			this.$buttons.css({
				padding: 5,
				textAlign: 'right',
				borderTop: '1px solid #ccc',
				backgroundColor: '#fff',
			});
			
			this.$buttons.find('button').css({
				marginLeft: 5
			});
			
			this.$buttons.find('button:first').css({
				marginLeft: 0
			});
			
			this.$bar.bind({
				mouseenter: function() { $(this).find('.noty_close').fadeIn(); },
				mouseleave: function() { $(this).find('.noty_close').fadeOut(); }
			});
			
			switch (this.options.layout.name) {
				case 'top':
					this.$bar.css({
						borderRadius: '0px 0px 5px 5px',
						borderBottom: '2px solid #eee',
						borderLeft: '2px solid #eee',
						borderRight: '2px solid #eee',
						boxShadow: "0 2px 4px rgba(0, 0, 0, 0.1)"
					});
				break;
				case 'topCenter': case 'center': case 'bottomCenter': case 'inline':
					this.$bar.css({
						borderRadius: '5px',
						border: '1px solid #eee',
						boxShadow: "0 2px 4px rgba(0, 0, 0, 0.1)"
					});
					this.$message.css({fontSize: '13px', textAlign: 'center'});
				break;
				case 'topLeft': case 'topRight':
				case 'bottomLeft': case 'bottomRight':
				case 'centerLeft': case 'centerRight':
					this.$bar.css({
						borderRadius: '5px',
						border: '1px solid #eee',
						boxShadow: "0 2px 4px rgba(0, 0, 0, 0.1)"
					});
					this.$message.css({fontSize: '13px', textAlign: 'left'});
				break;
				case 'bottom':
					this.$bar.css({
						borderRadius: '5px 5px 0px 0px',
						borderTop: '2px solid #eee',
						borderLeft: '2px solid #eee',
						borderRight: '2px solid #eee',
						boxShadow: "0 -2px 4px rgba(0, 0, 0, 0.1)"
					});
				break;
				default:
					this.$bar.css({
						border: '2px solid #eee',
						boxShadow: "0 2px 4px rgba(0, 0, 0, 0.1)"
					});
				break;
			}
			
			switch (this.options.type) {
				case 'alert': case 'notification':
					this.$bar.css({backgroundColor: '#FFF', borderColor: '#CCC', color: '#444'}); break;
				case 'warning':
					this.$bar.css({backgroundColor: '#FFEAA8', borderColor: '#FFC237', color: '#826200'}); 
					this.$buttons.css({borderTop: '1px solid #FFC237'}); break;
				case 'error':
					this.$bar.css({backgroundColor: 'red', borderColor: 'darkred', color: '#FFF'});
					this.$message.css({fontWeight: 'bold'}); 
					this.$buttons.css({borderTop: '1px solid darkred'}); break;
				case 'information':
					this.$bar.css({backgroundColor: '#57B7E2', borderColor: '#0B90C4', color: '#FFF'}); 
					this.$buttons.css({borderTop: '1px solid #0B90C4'}); break;
				case 'success':
					this.$bar.css({backgroundColor: 'lightgreen', borderColor: '#50C24E', color: 'darkgreen'}); 
					this.$buttons.css({borderTop: '1px solid #50C24E'});break;
				default:
					this.$bar.css({backgroundColor: '#FFF', borderColor: '#CCC', color: '#444'}); break;
			}
		},
		callback: {
			onShow: function() { $.noty.themes.default.helpers.borderFix.apply(this); },
			onClose: function() { $.noty.themes.default.helpers.borderFix.apply(this); }
		}
	};

})(jQuery);//
// openWYSIWYG v1.0 Copyright (c) 2006 openWebWare.com
// This copyright notice MUST stay intact for use.
//
// An open source WYSIWYG editor for use in web based applications.
// For full source code and docs, visit http://www.openwebware.com/
//
// This library is free software; you can redistribute it and/or modify 
// it under the terms of the GNU Lesser General Public License as published 
// by the Free Software Foundation; either version 2.1 of the License, or 
// (at your option) any later version.
//
// This library is distributed in the hope that it will be useful, but 
// WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
// or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public 
// License for more details.
//
// You should have received a copy of the GNU Lesser General Public License along 
// with this library; if not, write to the Free Software Foundation, Inc., 59 
// Temple Place, Suite 330, Boston, MA 02111-1307 USA 


/* ---------------------------------------------------------------------- *\
  Global Variables: Set global variables such as images directory, 
	                  WYSIWYG Height, Width, and CSS Directory.
\* ---------------------------------------------------------------------- */

var m_selection;

m_sRTID = "";
m_iframeId = "";

// WYSIWYG Width and Height
wysiwygWidth = 600;
wysiwygHeight = 400;

var isSafari = (navigator.userAgent.toLowerCase().search("safari") > 0)? true : false;


/* ---------------------------------------------------------------------- *\
  Toolbar Settings: Set the features and buttons available in the WYSIWYG
	                  Toolbar.
\* ---------------------------------------------------------------------- */


// List of available font types
    var Fonts = new Array();
    Fonts[0] = "Arial";
    Fonts[1] = "Sans Serif";
    Fonts[2] = "Tahoma";
    Fonts[3] = "Verdana";
    Fonts[4] = "Courier New";
    Fonts[5] = "Georgia";
    Fonts[6] = "Times New Roman";
    Fonts[7] = "Impact";
    Fonts[8] = "Comic Sans MS";

// List of available block formats (not in use)
    var BlockFormats = new Array();
    BlockFormats[0]  = "Address";
    BlockFormats[1]  = "Bulleted List";
    BlockFormats[2]  = "Definition";
    BlockFormats[3]  = "Definition Term";
    BlockFormats[4]  = "Directory List";
    BlockFormats[5]  = "Formatted";
    BlockFormats[6]  = "Heading 1";
    BlockFormats[7]  = "Heading 2";
    BlockFormats[8]  = "Heading 3";
    BlockFormats[9]  = "Heading 4";
    BlockFormats[10] = "Heading 5";
    BlockFormats[11] = "Heading 6";
    BlockFormats[12] = "Menu List";
    BlockFormats[13] = "Normal";
    BlockFormats[14] = "Numbered List";

// List of available font sizes
    var FontSizes = new Array();
    FontSizes[0]  = "1";
    FontSizes[1]  = "2";
    FontSizes[2]  = "3";
    FontSizes[3]  = "4";
    FontSizes[4]  = "5";
    FontSizes[5]  = "6";
    FontSizes[6]  = "7";

// Order of available commands in toolbar one
    var buttonName = new Array();
    buttonName[0]  = "bold";
    buttonName[1]  = "italic";
    buttonName[2]  = "underline";
    buttonName[3]  = "seperator";
    buttonName[4]  = "justifyleft";
    buttonName[5]  = "justifycenter";
    buttonName[6] = "justifyright";
    buttonName[7] = "justifyfull";
    buttonName[8]  = "seperator";
    buttonName[9]  = "forecolor";
    buttonName[10]  = "backcolor";
    buttonName[11]  = "createlink";
    buttonName[12] = "seperator";
    buttonName[13] = "unorderedlist";
    buttonName[14] = "orderedlist";
    buttonName[15] = "outdent";
    buttonName[16] = "indent";
    buttonName[17]  = "seperator";
    buttonName[18]  = "Insert Emoticons";
    buttonName[19]  = "Insert Signature";


    var buttonName2 = new Array();
        
/*
// List of available actions and their respective ID and images
var ToolbarList = {
//Name              buttonID                 buttonTitle           buttonImage                            buttonImageRollover
    "bold":           ['Bold',                 f_sAltBold,               '',               imagesDir + 'bold_on.gif'],
    "italic":         ['Italic',               f_sAltItalic,             '',            imagesDir + 'italics_on.gif'],
    "underline":      ['Underline',            f_sAltUnderline,          '',          imagesDir + 'underline_on.gif'],
    "strikethrough":  ['Strikethrough',        'Strikethrough',      '',      imagesDir + 'strikethrough_on.gif'],
    "seperator":      ['',                     '',                   '',          imagesDir + 'seperator.gif'],
    "subscript":      ['Subscript',            'Subscript',          '',          imagesDir + 'subscript_on.gif'],
    "superscript":    ['Superscript',          'Superscript',        '',        imagesDir + 'superscript_on.gif'],
    "justifyleft":    ['Justifyleft',          f_sAltLeft,        '',       imagesDir + 'justify_left_on.gif'],
    "justifycenter":  ['Justifycenter',        f_sAltCenter,      '',     imagesDir + 'justify_center_on.gif'],
    "justifyright":   ['Justifyright',         f_sAltRight,       '',     imagesDir + 'justify_right_on.gif'],
    "justifyfull": 	  ['Justifyfull', 		   f_sAltJustify,        '',	 imagesDir + 'justify_justify_on.gif', 	  'justify_justify_on.gif'], 
    "unorderedlist":  ['InsertUnorderedList',  f_sAltUList,'',     imagesDir + 'list_unordered_on.gif'],
    "orderedlist":    ['InsertOrderedList',    f_sAltOList,  '',       imagesDir + 'list_ordered_on.gif'],
    "outdent":        ['Outdent',              f_sAltDecInd,            '',        imagesDir + 'indent_left_on.gif'],
    "indent":         ['Indent',               f_sAltIncInd,             '',       imagesDir + 'indent_right_on.gif'],
    "cut":            ['Cut',                  f_sAltCut,                '',                imagesDir + 'cut_on.gif'],
    "copy":           ['Copy',                 f_sAltCopy,               '',               imagesDir + 'copy_on.gif'],
    "paste":          ['Paste',                f_sAltPaste,              '',              imagesDir + 'paste_on.gif'],
    "Check Spelling":      ['CheckSpelling',    f_sAltSpelling,     '',          imagesDir + 'spell_check_on.gif'],
    "forecolor":      ['ForeColor',            f_sAltColor,          '',          imagesDir + 'forecolor_on.gif'],
    "backcolor":      ['BackColor',            f_sAltBG,          '',          imagesDir + 'backcolor_on.gif'],
    "undo":           ['Undo',                 'Undo',               '',               imagesDir + 'undo_on.gif'],
    "redo":           ['Redo',                 'Redo',               '',               imagesDir + 'redo_on.gif'],
    "remove":         ['Removeformat',         'Remove Format',     '',               imagesDir + 'remove_on.gif'],
    "inserttable":    ['InsertTable',          'InsertTable',        '',       imagesDir + 'insert_table_on.gif'],
    "insertimage":    ['InsertImage',          'InsertImage',        '',     imagesDir + 'insert_picture_on.gif'],
    "createlink":     ['CreateLink',           f_sAltLink,         '',   imagesDir + 'insert_hyperlink_on.gif'],
    "Insert Signature":     ['InsertSignature',           f_sAltSig,         '',   imagesDir + 'signature_ico_on.gif'],
    "Insert Files from Backpack":     ['InsertBackpack',           'Insert Files from Backpack',         '',   imagesDir + 'data_disk_on.gif'],
    "Insert Emoticons":     ['InsertEmoticons',           f_sAltEmoticon,         '',   imagesDir + 'smile_on.gif'],
    "viewSource":     ['ViewSource',           'ViewSource',         '',        imagesDir + 'view_source_on.gif'],
    "viewText":       ['ViewText',             'ViewText',           '',          imagesDir + 'view_text_on.gif'],
    "help":           ['Help',                 'Help',               '',               imagesDir + 'help_on.gif'],
    "selectfont":     ['SelectFont',           lableFont,         imagesDir + 'select_font_'+ lang +'.gif',        imagesDir + 'select_font_on_'+ lang +'.gif'],
    "selectsize":     ['SelectSize',           lableSize,         imagesDir + 'select_size_'+ lang +'.gif',        imagesDir + 'select_size_on_'+ lang +'.gif']
};
*/


/* ---------------------------------------------------------------------- *\
  Function    : insertAdjacentHTML(), insertAdjacentText() and insertAdjacentElement()
  Description : Emulates insertAdjacentHTML(), insertAdjacentText() and 
	              insertAdjacentElement() three functions so they work with 
								Netscape 6/Mozilla
  Notes       : by Thor Larholm me@jscript.dk
\* ---------------------------------------------------------------------- */
if(typeof HTMLElement!="undefined" && !HTMLElement.prototype.insertAdjacentElement){
  HTMLElement.prototype.insertAdjacentElement = function
  (where,parsedNode)
	{
	  switch (where){
		case 'beforeBegin':
			this.parentNode.insertBefore(parsedNode,this)
			break;
		case 'afterBegin':
			this.insertBefore(parsedNode,this.firstChild);
			break;
		case 'beforeEnd':
			this.appendChild(parsedNode);
			break;
		case 'afterEnd':
			if (this.nextSibling) 
      this.parentNode.insertBefore(parsedNode,this.nextSibling);
			else this.parentNode.appendChild(parsedNode);
			break;
		}
	}

	HTMLElement.prototype.insertAdjacentHTML = function
  (where,htmlStr)
	{
		var r = this.ownerDocument.createRange();
		r.setStartBefore(this);
		var parsedHTML = r.createContextualFragment(htmlStr);
		this.insertAdjacentElement(where,parsedHTML)
	}


	HTMLElement.prototype.insertAdjacentText = function
  (where,txtStr)
	{
		var parsedText = document.createTextNode(txtStr)
		this.insertAdjacentElement(where,parsedText)
	}
};


// Create viewTextMode global variable and set to 0
// enabling all toolbar commands while in HTML mode
viewTextMode = 0;



/* ---------------------------------------------------------------------- *\
  Function    : generate_wysiwyg()
  Description : replace textarea with wysiwyg editor
  Usage       : generate_wysiwyg("textarea_id");
  Arguments   : textarea_id - ID of textarea to replace
\* ---------------------------------------------------------------------- */
function generate_wysiwyg(textareaID, iframeID, displyStyle) {

  m_iframeId = iframeID;
  m_sRTID = textareaID
	
	
  var content = '';
  var doc = document.getElementById(m_iframeId).contentWindow.document;
	
  // Write the textarea's content into the iframe
  //doc.open();
  //doc.write('');
  //doc.close();
	
	//return;
	
  // Make the iframe editable in both Mozilla and IE
  try {  
    if (doc.body.contentEditable) {
	  doc.body.contentEditable = true;
	} else {
	  //doc.designMode = "on";	
	}
	doc.body.contentEditable = true;
    //doc.designMode = "on";
    //set the default Font and Font size
    //doc.body.style.fontFamily = "sans-serif";
    //doc.body.style.fontSize = "13px";
  }catch(e)
  		{
  			//alert(e);
  		}
	
	
	
 	
};



/* ---------------------------------------------------------------------- *\
  Function    : formatText()
  Description : replace textarea with wysiwyg editor
  Usage       : formatText(id, n, selected);
  Arguments   : id - The execCommand (e.g. Bold)
                n  - The editor identifier that the command 
								     affects (the textarea's ID)
                selected - The selected value when applicable (e.g. Arial)
\* ---------------------------------------------------------------------- */
function formatText(id, n, selected) {

  // When user clicks toolbar button make sure it always targets its respective WYSIWYG
  var ifrm = document.getElementById(m_iframeId);
  if (ifrm.contentWindow) {
    //alert ('contentWindow is supported');
    ifrm.contentWindow.focus();
  } else {
    //alert ('sorry, contentWindow is NOT supported');
  }
  //document.getElementById(m_iframeId).contentWindow.focus();
  //document.getElementById(m_iframeId).document.defaultView.focus();
	n = m_iframeId;
	// When in Text Mode these execCommands are disabled
	var formatIDs = new Array("FontSize","FontName","Bold","Italic","Underline","Subscript","Superscript","Strikethrough","Justifyleft","Justifyright","Justifycenter","InsertUnorderedList","InsertOrderedList","Indent","Outdent","ForeColor","BackColor","InsertImage","InsertTable","CreateLink","InsertSignature","InsertEmoticons");
  
	// Check if button clicked is in disabled list
	for (var i = 0; i <= formatIDs.length;) {
		if (formatIDs[i] == id) {
			 var disabled_id = 1; 
		}
	  i++;
	}
	
	// Check if in Text Mode and disabled button was clicked
	if (viewTextMode == 1 && disabled_id == 1) {
	  //alert ("You are in HTML Mode. This feature has been disabled.");	
	}
	
	else {
	
	  // FontSize
	  if (id == "FontSize") {
      document.getElementById(m_iframeId).contentWindow.document.execCommand("FontSize", false, selected);
	  }
	  
		// FontName
	  else if (id == "FontName") {
      document.getElementById(m_iframeId).contentWindow.document.execCommand("FontName", false, selected);
	  }
	
	  // ForeColor and BackColor
    else if (id == 'ForeColor' || id == 'BackColor') {
      var w = screen.availWidth;
      var h = screen.availHeight;
      var popW = 240, popH = 260;
      var leftPos = (w-popW)/2, topPos = (h-popH)/2;
      var currentColor = _dec_to_rgb(document.getElementById(m_iframeId).contentWindow.document.queryCommandValue(id));
   
	    //window.open(popupsDir + 'select_color.html?color=' + currentColor + '&command=' + id + '&wysiwyg=' + n,'popup','location=0,status=0,scrollbars=0,width=' + popW + ',height=' + popH + ',top=' + topPos + ',left=' + leftPos);
	    document.getElementById('RTpops').style.width = popW + "px";
	    document.getElementById('RTpops').style.height = popH + "px";
	    document.getElementById('RTpops').src = popupsDir + 'select_color.html?color=' + currentColor + '&command=' + id + '&wysiwyg=' + n;
    }
	  
		// CreateLink
	  else if (id == "CreateLink") {
	    document.getElementById('RTpops').style.width = "300px";
	    document.getElementById('RTpops').style.height = "110px";
	    document.getElementById('RTpops').src = popupsDir + 'insert_hyperlink.html?wysiwyg=' + n;
	  }	  
		// ViewSource
    else if (id == "ViewSource") {
	    viewSource(n);
	  }
		
		// ViewText
    else if (id == "ViewText") {		
	    viewText(n);
	  }
	  
	  // InsertEmoticons
	else if (id == "InsertEmoticons") {
		
        if (document.selection)
        {
		    m_selection = document.getElementById(m_iframeId).contentWindow.document.selection.createRange();
		    document.getElementById(m_iframeId).contentWindow.document.body.focus();
        }
		
		iIndex = "1"				
		sEmoticonsURL = "RT_4NoIE/emoticons/emoticons_picker" + iIndex + ".htm"
	    document.getElementById('RTpops').src = sEmoticonsURL;
	    document.getElementById('RTpops').style.width = "360px";
	    document.getElementById('RTpops').style.height = "165px";	    
	    document.getElementById('RTpops').style.top = "166px" //parseInt(document.getElementById('CompTools').clientHeight)
	    	    
	    document.getElementById('RTpops').style.display = "";
	  }
	  
        // InsertSignature
	else if (id == "InsertSignature") {
	    document.getElementById('RTpops').style.width = "330px";
	    document.getElementById('RTpops').style.height = "210px";
	    document.getElementById('RTpops').src = popupsDir + 'InsertSignature.asp?wysiwyg=' + n;
	  }    
		// Every other command
    else {
      document.getElementById(m_iframeId).contentWindow.document.execCommand(id, false, null);
		}
  }
};
function getSelectionLocal() {
	var ifrm = document.getElementById(m_iframeId).contentWindow;
	var doc = ifrm.document;
	var sel = null;
	if(ifrm.getSelection){
		sel = ifrm.getSelection();
	}
	else if (doc.getSelection) {
		sel = doc.getSelection();
	}
	else if (doc.selection) {
		sel = doc.selection;
	}
	return sel;
}
	
function getSlctn() {
    try {
       if (document.selection)
       {
            if (parent.document.getElementById(m_iframeId)){
		        m_selection = parent.document.getElementById(m_iframeId).contentWindow.document.selection.createRange();
		        parent.document.getElementById(m_iframeId).contentWindow.focus();
		    }
		    else if (document.getElementById(m_iframeId)){
		        m_selection = document.getElementById(m_iframeId).contentWindow.document.selection.createRange();
		        document.getElementById(m_iframeId).contentWindow.focus();
		    }
       } else {
            if ( parent.document.getElementById(m_iframeId) ){
                m_selection = parent.document.getElementById(m_iframeId).contentWindow.document;
               parent.document.getElementById(m_iframeId).contentWindow.focus();
            }
            else if (document.getElementById(m_iframeId)) {
                m_selection = document.getElementById(m_iframeId).contentWindow.document;
                document.getElementById(m_iframeId).contentWindow.focus();
            }
       }
    }
    catch(e){}
}

function closeRTpopsWindow () {
    try {
        if (parent.document.getElementById('RTpops')) {
            parent.document.getElementById('RTpops').src = "about:blank";
            parent.document.getElementById('RTpops').style.display = "none";
            parent.document.getElementById(m_iframeId).contentWindow.focus();
        } 
        else if (document.getElementById('RTpops')) {
            document.getElementById('RTpops').src = "about:blank";
            document.getElementById('RTpops').style.display = "none";
            document.getElementById(m_iframeId).contentWindow.focus();
        }
    }
    catch(e){}
}


/* ---------------------------------------------------------------------- *\
  Function    : insertHTML()
  Description : insert HTML into WYSIWYG in rich text
  Usage       : insertHTML(<b>hello</b>, "textareaID")
  Arguments   : html - The HTML being inserted (e.g. <b>hello</b>)
                n  - The editor identifier that the HTML 
								     will be inserted into (the textarea's ID)
\* ---------------------------------------------------------------------- */
function insertHTML(html, n) 
{
    n= m_iframeId;

  var browserName = navigator.appName;
	 	 
	if (browserName == "Microsoft Internet Explorer") 
	{	  
        if (document.selection)
       {

		     m_selection.pasteHTML(html);  
        }
        else
            document.getElementById(m_iframeId).contentWindow.document.selection.createRange().pasteHTML(html); 
	} 
	 
	else {
	  var div = document.getElementById(m_iframeId).contentWindow.document.createElement("span");
		 
		div.innerHTML = html;
		var node = insertNodeAtSelection(div, n);		
	}
	
}


/* ---------------------------------------------------------------------- *\
  Function    : insertNodeAtSelection()
  Description : insert HTML into WYSIWYG in rich text (mozilla)
  Usage       : insertNodeAtSelection(insertNode, n)
  Arguments   : insertNode - The HTML being inserted (must be innerHTML 
	                           inserted within a div element)
                n          - The editor identifier that the HTML will be 
								             inserted into (the textarea's ID)
\* ---------------------------------------------------------------------- */
function insertNodeAtSelection(insertNode, n) {
    // get current selection  
    var sel = getSelectionLocal();

    // get the first range of the selection
    // (there's almost always only one range)
    var range = sel.getRangeAt(0);

    // deselect everything
    sel.removeAllRanges();

    // remove content of current selection from document
    range.deleteContents();

    // get location of current selection
    var container = range.startContainer;
    var pos = range.startOffset;

    // make a new range for the new selection
    //range=document.createRange();
    // fix WRONG_DOCUMENT_ERR = 4 for Safari.     
    range=document.getElementById(m_iframeId).contentWindow.document.createRange();

    if (container.nodeType==3 && insertNode.nodeType==3) {

        // if we insert text in a textnode, do optimized insertion
        container.insertData(pos, insertNode.nodeValue);

        // put cursor after inserted text
        range.setEnd(container, pos+insertNode.length);
        range.setStart(container, pos+insertNode.length);
    } else {
        var afterNode;

        if (container.nodeType==3) {
            // when inserting into a textnode
            // we create 2 new textnodes
            // and put the insertNode in between

            var textNode = container;
            container = textNode.parentNode;
            var text = textNode.nodeValue;

            // text before the split
            var textBefore = text.substr(0,pos);
            // text after the split
            var textAfter = text.substr(pos);

            var beforeNode = document.createTextNode(textBefore);
            afterNode = document.createTextNode(textAfter);

            // insert the 3 new nodes before the old one
            container.insertBefore(afterNode, textNode);
            container.insertBefore(insertNode, afterNode);
            container.insertBefore(beforeNode, insertNode);

            // remove the old node
            container.removeChild(textNode);
        } else {
            // else simply insert the node
            afterNode = container.childNodes[pos];
            container.insertBefore(insertNode, afterNode);
            }
            try {
                range.setStart(afterNode, 0);            
                range.setEnd(afterNode, 0);
            }catch(e) {};
    }

    sel.addRange(range);
};

	

/* ---------------------------------------------------------------------- *\
  Function    : _dec_to_rgb
  Description : convert a decimal color value to rgb hexadecimal
  Usage       : var hex = _dec_to_rgb('65535');   // returns FFFF00
  Arguments   : value   - dec value
\* ---------------------------------------------------------------------- */

function _dec_to_rgb(value) {
  var hex_string = "";
  for (var hexpair = 0; hexpair < 3; hexpair++) {
    var myByte = value & 0xFF;            // get low byte
    value >>= 8;                          // drop low byte
    var nybble2 = myByte & 0x0F;          // get low nybble (4 bits)
    var nybble1 = (myByte >> 4) & 0x0F;   // get high nybble
    hex_string += nybble1.toString(16);   // convert nybble to hex
    hex_string += nybble2.toString(16);   // convert nybble to hex
  }
  return hex_string.toUpperCase();
};



/* ---------------------------------------------------------------------- *\
  Function    : outputFontSelect()
  Description : creates the Font Select drop down and inserts it into 
	              the toolbar
  Usage       : outputFontSelect(n)
  Arguments   : n   - The editor identifier that the Font Select will update
	                    when making font changes (the textarea's ID)
\* ---------------------------------------------------------------------- */
function outputFontSelect(n) {

};



/* ---------------------------------------------------------------------- *\
  Function    : outputFontSizes()
  Description : creates the Font Sizes drop down and inserts it into 
	              the toolbar
  Usage       : outputFontSelect(n)
  Arguments   : n   - The editor identifier that the Font Sizes will update
	                    when making font changes (the textarea's ID)
\* ---------------------------------------------------------------------- */
function outputFontSizes(n) {

};



/* ---------------------------------------------------------------------- *\
  Function    : hideFonts()
  Description : Hides the list of font names in the font select drop down
  Usage       : hideFonts(n)
  Arguments   : n   - The editor identifier (the textarea's ID)
\* ---------------------------------------------------------------------- */
function hideFonts(n) {
  document.getElementById('Fonts' + n).style.display = 'none'; 
};



/* ---------------------------------------------------------------------- *\
  Function    : hideFontSizes()
  Description : Hides the list of font sizes in the font sizes drop down
  Usage       : hideFontSizes(n)
  Arguments   : n   - The editor identifier (the textarea's ID)
\* ---------------------------------------------------------------------- */
function hideFontSizes(n) {
  document.getElementById('Sizes' + n).style.display = 'none'; 
};



/* ---------------------------------------------------------------------- *\
  Function    : showFonts()
  Description : Shows the list of font names in the font select drop down
  Usage       : showFonts(n)
  Arguments   : n   - The editor identifier (the textarea's ID)
\* ---------------------------------------------------------------------- */
function showFonts(n) { 
};



/* ---------------------------------------------------------------------- *\
  Function    : showFontSizes()
  Description : Shows the list of font sizes in the font sizes drop down
  Usage       : showFonts(n)
  Arguments   : n   - The editor identifier (the textarea's ID)
\* ---------------------------------------------------------------------- */
function showFontSizes(n) { 
};



/* ---------------------------------------------------------------------- *\
  Function    : viewSource()
  Description : Shows the HTML source code generated by the WYSIWYG editor
  Usage       : showFonts(n)
  Arguments   : n   - The editor identifier (the textarea's ID)
\* ---------------------------------------------------------------------- */
function viewSource(n) {
  var getDocument = document.getElementById(m_iframeId).contentWindow.document;
  var browserName = navigator.appName;
	
	// View Source for IE 	 
  if (browserName == "Microsoft Internet Explorer") {
    var iHTML = getDocument.body.innerHTML;
    getDocument.body.innerText = iHTML;
	}
 
  // View Source for Mozilla/Netscape
  else {
    var html = document.createTextNode(getDocument.body.innerHTML);
    getDocument.body.innerHTML = "";
    getDocument.body.appendChild(html);
	}
  
	// Hide the HTML Mode button and show the Text Mode button
    document.getElementById('HTMLMode' + m_sRTID).style.display = 'none'; 
	document.getElementById('textMode' + m_sRTID).style.display = 'block';
	
	// set the font values for displaying HTML source
	getDocument.body.style.fontSize = "12px";
	getDocument.body.style.fontFamily = "Courier New"; 
	
  viewTextMode = 1;
};



/* ---------------------------------------------------------------------- *\
  Function    : viewSource()
  Description : Shows the HTML source code generated by the WYSIWYG editor
  Usage       : showFonts(n)
  Arguments   : n   - The editor identifier (the textarea's ID)
\* ---------------------------------------------------------------------- */
function viewText(n) {
  var getDocument = document.getElementById(m_iframeId).contentWindow.document;
  var browserName = navigator.appName;
	
	// View Text for IE 	  	 
  if (browserName == "Microsoft Internet Explorer") {
    var iText = getDocument.body.innerText;
    getDocument.body.innerHTML = iText;
	}
  
	// View Text for Mozilla/Netscape
  else {
    var html = getDocument.body.ownerDocument.createRange();
    html.selectNodeContents(getDocument.body);
    getDocument.body.innerHTML = html.toString();
	}
  
	// Hide the Text Mode button and show the HTML Mode button
  document.getElementById('textMode' + m_sRTID).style.display = 'none'; 
	document.getElementById('HTMLMode' + m_sRTID).style.display = 'block';
	
	// reset the font values
  getDocument.body.style.fontSize = "";
	getDocument.body.style.fontFamily = ""; 
	viewTextMode = 0;
};



/* ---------------------------------------------------------------------- *\
  Function    : updateTextArea()
  Description : Updates the text area value with the HTML source of the WYSIWYG
  Usage       : updateTextArea(n)
  Arguments   : n   - The editor identifier (the textarea's ID)
\* ---------------------------------------------------------------------- */
function updateTextArea(n) {
  document.getElementById(n).value = document.getElementById(m_iframeId).contentWindow.document.body.innerHTML;
};


////CUSTOM RT functions/calls

//::::::
function GetHTMLBody()
{
	if(viewMode == 2)
		doToggleView();
	
	return (document.getElementById(m_iframeId).contentWindow.document.body.innerHTML); 
}

//::::::
function GetTextBody()
{
	return (document.getElementById(m_iframeId).contentWindow.document.body.innerHTML);
}


//::::::
function AddSignatureRichText()
{
    var objRT = document.getElementById(m_iframeId).contentWindow.document.body	
	var Msg_Body = objRT.innerHTML;	
	var origjsAddSig = document.main_form.jsaddsig.value
    
	var objDiv = document.createElement("div");
    // get what exactly signature is in FF or safari
	objDiv.innerHTML = origjsAddSig;	
	jsAddSig = objDiv.innerHTML;
	// get what exactly delimiter is in FF or safari
	objDiv.innerHTML = jsPara_composer_OrigMsgDelimeter;	
	var Msg_delimiter = objDiv.innerHTML;
	objDiv  = null; // destory the temp obj;	
	
	var sArray = Msg_Body.split(Msg_delimiter);
	
	//no original message?
	if (sArray.length <= 1) 
	{
	    if (Msg_Body.indexOf(jsAddSig) < 0)
        {
		    objRT.innerHTML += origjsAddSig;
		}
	}
	else
	{
	    if (sArray[0].indexOf(jsAddSig) < 0)
	    {
	        sArray[0] += origjsAddSig + '<div><br>';
		    objRT.innerHTML = sArray.join(Msg_delimiter) + '</div>';
		}
	}
}    var msg_attv3_14 = '[-] Hide Options';
    var msg_attv3_15 = '[+] Show Options';
    var msg_attv3_4  = 'Images';
    var msg_attv3_3  = '';
    var m_sDomaincode = 'mail2world';
    var imgp_txt_click_DL = 'Click here to download this file to you computer';
    var baseDownloadURL = "/webrestapi/graph/mailbox/web/attachments/download";





	function CATTACH(f_iIndex, f_sFileID, f_bImg, f_sName, f_sSize, f_bBP, f_sURL, f_sIcon, f_sDate)
    {
        	this.index  = f_iIndex;
        	this.FileID = f_sFileID;
        	this.bImg   = f_bImg;
        	this.name   = f_sName;
        	this.size   = f_sSize;
        	this.bBP    = f_bBP;
        	this.URL    = f_sURL;
       		this.icon   = f_sIcon;
       		this.sDate  = f_sDate;
    }

    //Aattach v3
    var m_Group = true;
    var m_SortBy = "name";
    var m_bHideOptions = false;
	m_aCAtt = null;

    var m_ConstMisc         = 0;	
    var m_ConstVideoAudio   = 1;
    var m_ConstImage        = 2;
    
    var m_arrFileType = new Array(); 
    m_arrFileType[m_ConstMisc]       = top.mcLang.Text('lang_drive_7',0) + "|"; 
    m_arrFileType[m_ConstVideoAudio] = top.mcLang.Text('lang_drive_8',0) +"|*MP3*M3U*WMA*WAV*WAX*AIFF*AIF*AIFC*AU*RA*ASF*ASX*WPL*WM*WMX*WMD*WMZ*WMA*AVI*RAM*MPG*MOV*QT*MPEG*MP4*"; 
    m_arrFileType[m_ConstImage]      = top.mcLang.Text('lang_drive_9',0) + "|*JPEG*JPG*GIF*PNG*BMP*"; 
    
    var m_arrFileHTML = new Array(); 
    m_arrFileHTML[m_ConstMisc]       = ""; //Misc. Files
    m_arrFileHTML[m_ConstVideoAudio] = ""; //Audio Files 
    m_arrFileHTML[m_ConstImage]      = ""; //Images
    
    var m_iTotalMsgAttach = 0;
    var m_iTotalMsgAttachSize = 0;


    //:::::::
	//:::::::    
    function fnDownloadMsgAttach(iTotalAttach)
    {
		//location = '../../app/zip_api.asp?MsgID=' + escape(top.m_MSGID) + '&TotalAttach=' + iTotalAttach;
        location = baseDownloadURL + '?msgid=' + escape(top.m_MSGID) + '&format=zip&TotalAttach=' + iTotalAttach;
    }

    //:::
    function Thumbnail(f_sAttachBulk, bBackpackApp, sExtraBackpack)
    {
    	m_aCAtt = [];
    	var bDriveBox = false;
        var i;

		var arr_AttachList = f_sAttachBulk.split("|-*_|");
		for (i=0; i <  arr_AttachList.length; i++)
		{
			if (arr_AttachList[i].length > 0)
			{
					m_aCAtt[i] =  eval('new CATTACH(' + arr_AttachList[i] + ')');
			}
		}


		myBubbleSort(m_aCAtt);
			    
        var f_sAttachHTML   = "";
        var f_sHTML         = "";
        var f_sALLHTML      = "";
        var sGroupBox       = "";
        var f_sWH           = "128";
        var f_iFileType     = 0;
        var v_iSize = "";
        
        //m_bEmbededMSG  'true/false'
        
        m_arrFileHTML[m_ConstMisc]       = ""; //Misc. Files
        m_arrFileHTML[m_ConstVideoAudio] = ""; //Video Files
        m_arrFileHTML[m_ConstImage]      = ""; //Images

        if (m_Group == true)
            sGroupBox = " checked ";
            
        if (m_aCAtt.length > 0)    
        	if ( m_aCAtt[0].URL == 'DriveBox' )
        		bDriveBox = true;
        		
        iNameWidth = '265px';
        iDateWidth = '130px';
        i_ClientWidth = top.$(window).width();
        if ( i_ClientWidth <= 1024)
        {
          		iNameWidth = '165px';
          		iDateWidth = '100px';
        }

        
        for (i=0; i < m_aCAtt.length; i++)
        {  
            m_iTotalMsgAttach +=1;
            m_aCAtt[i].size = parseInt(m_aCAtt[i].size);
            m_iTotalMsgAttachSize += m_aCAtt[i].size;
            
            //#########
			v_iSize = "(" + top.formatSizeUnits(m_aCAtt[i].size) + ")"; 
			//#######

		    
		    f_IMGIcon = m_aCAtt[i].icon;
		    		    
			var iDivWidth = 193;
			var iDivNameWidth = 180;
			var sEditStyleIco = '';
			var sTooltip = top.mcLang.Text('lang_drive_30',1) ;

			 if (m_aCAtt[i].bImg == true)
		     {
		      	  if (bBackpackApp)
		      	  {
		          	sPICPREV = m_aCAtt[i].FileID;
		          	
		          	sPICPREV = sPICPREV.replace(/{/gi, "");
					sPICPREV = sPICPREV.replace(/}/gi, "");
		          	f_IMGIcon = 'http://download.pangia.biz/attach/V12DRIVE/' + sPICPREV + '_prev.jpg'
		            f_IMGIcon = '../../app/backpack_imgprev.asp?uidFileID=' +  m_aCAtt[i].FileID;
						
		          }
		          else
		          {
		            //Attachment Preview?
		          	AutoImageDisplay = top.fnReadCookie('M2W1', 'AutoImageDisplay', true);
		          	if (AutoImageDisplay == '2')
		          		f_IMGIcon = fnFindAttachIcon(m_aCAtt[i].name);
					else
                        if (m_aCAtt[i].icon)
                            f_IMGIcon = m_aCAtt[i].icon;
                        else
		          		    f_IMGIcon = "../../FileCabinet/MsgAtt.asp?File=" + m_aCAtt[i].FileID + "&g3=on&Att=1&AttL=" + f_sWH + "&FileName=" + escape(m_aCAtt[i].name);
		          }
		          		
		          //m_aCAtt[i].FileID = escape(m_aCAtt[i].name);
		          if (bBackpackApp)
		          	sTooltip = top.mcLang.Text('lang_drive_29',1);
		     }
		     else
		     {
		       	f_IMGIcon = fnFindAttachIcon(m_aCAtt[i].name);
		       	//iDivWidth = 140;
		       	//iDivNameWidth = 130;
		       	sEditStyleIco = " visibility:hidden ";
		       	
		    }

                f_sDownloadURL = m_aCAtt[i].URL;
                bBackPackShare = false;
                sHideActionIcons = 'display:block';
                sHideDownloadIcon = 'display:block';

                f_sBackPackCheckBox = '';
                f_sDragClass = '';
                f_sForwardClick = 'parent.fnForwardMsgAttachFile(\'' + i + '\',event)';
                
                sNewIcon = '';
                sNewIconList = '';
                
                sEditPicURL = "top.fnOpenEditTool('" + m_aCAtt[i].name + "')";
                
                if (bBackpackApp)
                {
                	 f_sBackPackCheckBox = '<a style="float:left;display:block; width:20px"><input type="checkbox" onclick="CBBackPack(this, event)" fileid="' + m_aCAtt[i].FileID + '" id="pkc' + m_aCAtt[i].index + '" value="ON"></a>';
                	 f_sDragClass = ' class="drag BPFile" ';
                	 f_sForwardClick = 'fnBackPack_ShareIcon(' + m_aCAtt[i].index + ', event)';
                	 
                	 //////
                	 sDate = m_aCAtt[i].sDate.split(' ');
                	 var DigitalT=new Date();
		   			 FullTime = (DigitalT.getMonth() + 1) + '/' + DigitalT.getDate() + '/' + DigitalT.getFullYear();
		    		 FullTimeY = (DigitalT.getMonth() + 1) + '/' + DigitalT.getDate() + '/' + DigitalT.getFullYear(); 
		    		 
		    		 
		    		 if (sDate[0] == FullTimeY)
		    		 {
		    		 	sNewIcon = '<img border="0" src="' + m_sRessIMGURL + 'new.gif" style="position:absolute; padding-bottom:3px; display:block" align="absmiddle" width="28" height="11">';
		    		 	
		    		 	sNewIconList = '<img border="0" src="' + m_sRessIMGURL + 'new.gif"  align="absmiddle" width="28" height="11">';
		    		 	
		    		 	if ( (top.slang == "av") || (top.slang == "es") )
		    		 	{
		    		 		sNewIcon = '<img border="0" src="' + m_sRessIMGURL + 'icon_nuevo.gif" style="position:relative; left: 0px; padding-bottom:3px; display:block" align="absmiddle" width="34" height="11">';
		    		 		sNewIconList = '<img border="0" src="' + m_sRessIMGURL + 'icon_nuevo.gif" align="absmiddle" width="34" height="11">';
		    		 	}
		    		 	
		    		 }
		    		 else
		    		 	sNewIcon = '';
		    		 	
		    		 sEditPicURL = "top.fnBackpackOpenEditTool('" + m_aCAtt[i].FileID + "')";
		    		 
		    		 sTooltip = m_sBP_UploadedH + ': ' + m_aCAtt[i].sDate + '<br><br>' + top.mcLang.Text('lang_drive_30',1);
		    		 	
		    		 	
            	 
                }
                else
                	 f_sBackPackCheckBox = '<a style="float:left;display:block; width:20px">&nbsp;</a>';

                
                if ( f_sDownloadURL.indexOf('SHARED') > 1 )
                {
                	f_sDownloadURL = '';
                	bBackPackShare = true;
                	sTooltip = '';
                	f_sDragClass = '';
                	sHideActionIcons = 'display:none'
                	sEditStyleIco = " visibility:hidden "
                }
                
                
                if (top.m_bDriveShareMode)
                {
                	bBackPackShare = true;
                	sTooltip = '';
                	f_sDragClass = '';
                	sHideActionIcons = 'display:none';
                	f_sBackPackCheckBox = '<a style="float:left;display:block; width:20px; visibility:hidden;"><input type="checkbox" onclick="CBBackPack(this, event)" fileid="' + m_aCAtt[i].FileID + '" id="pkc' + m_aCAtt[i].index + '" value="ON"></a>';
              		sEditStyleIco = " visibility:hidden "
                }

				sCursor = 'cursor:pointer;';
				sClass = 'instagramPic BPFile';       
                //

				if (bDriveBox)
				{
					f_sBackPackCheckBox = '<a style="float:left;display:block; width:20px"><input type="checkbox" onclick="CDriveBox(this, event)" fileid="' + m_aCAtt[i].FileID + '" id="pkc' + m_aCAtt[i].index + '" value="ON"></a>';
		   			sTooltip = m_aCAtt[i].name;
		   			f_sDownloadURL = 'fnDriveBoxSelect(' + i + ')';
		   			sHideActionIcons = 'display:none';
		   			sHideDownloadIcon = 'display:none';
		   			sCursor = 'cursor:pointer;';
		   			//sClass = 'DriveBoxPic';
		   			sEditStyleIco = " visibility:hidden "
				}
                       
      
 

         		if ( (top.m_sDriveViewMode == 'details') && (bBackpackApp) && (bDriveBox != true) )
         		{
      			
					sName = top.ShowFileIcon(m_aCAtt[i].name,0,'');
					sClass = ''; 
					
					v_iSize =v_iSize.replace("(", "");
					v_iSize =v_iSize.replace(")", "");
					
					sTooltip = sTooltip.replace("<br>", "\n");
					sTooltip = sTooltip.replace("<br>", "\n");
					
					sHideActionIcons = sHideActionIcons.replace("block", "");
					
					var DigitalT = new Date(m_aCAtt[i].sDate);
      			 	if ( (top.slang == 'av') ||  (top.slang == 'es') || (top.mSkinUI == 'telmex') )
		    			FullTimeY =   (DigitalT.getDate() - 1) + '/' + (DigitalT.getMonth() + 1) + '/' + DigitalT.getFullYear(); 
		    		else
		    			FullTimeY = (DigitalT.getMonth() + 1) + '/' + (DigitalT.getDate() - 1) + '/' + DigitalT.getFullYear();
		    				
					//
					f_sFileName = m_aCAtt[i].name
					ext = f_sFileName.substr(f_sFileName.lastIndexOf('.') + 1);
					ext = ext.toUpperCase();
					
					if (m_aCAtt[i].bImg == true)
						sNametitle = top.m_sDriveImgClk;
					else
						sNametitle = top.mcLang.Text('lang_drive_30',1);
						
					sNametitle = f_sFileName.replace(/"/gi, '\"') + '\n' + FullTimeY + ' ' +  m_aCAtt[i].sDate.split(' ')[1] + ' ' +  m_aCAtt[i].sDate.split(' ')[2] + '\n' + sNametitle;	
					
					f_sBackPackCheckBox = '<a style="float:left;display:block; width:20px; padding-top:6px"><input type="checkbox" onclick="CBBackPack(this, event)" fileid="' + m_aCAtt[i].FileID + '"  id="pkc' + m_aCAtt[i].index + '" value="ON"></a>';
					
     				f_sHTML ='<div contenteditable="false" class="MData drag BPFile" id="imgprevbox' + m_aCAtt[i].index + '" cindex="' + m_aCAtt[i].index + '"  cbxi="' + m_aCAtt[i].index + '" style="cursor:default; min-width:800px !important" >' + 
						 '	<div style="width:30px;">' + f_sBackPackCheckBox + '</div>' +
						 '	<div title="' + sNametitle  + '" onmouseover="fnDrivePrevImg(' + m_aCAtt[i].index + ')" onmouseout="fnDrivePrevImgOff()" onclick="' + f_sDownloadURL + '" imgtype="prev" cindex="' + m_aCAtt[i].index + '" class="BPFile" style="padding-right:6px; width:25px; padding-left:6px;  cursor:pointer" ><a imgtype="prev" id="insta' + m_aCAtt[i].index + '" class="' + sClass + '" style="display:inline-block"><img  imgtype="prev" id="aprevbx' + m_aCAtt[i].index + '"  src="' + f_IMGIcon + '" style="width:20px; height:20px; margin-top:4px"  /></a></div>' +
						 '	<div title="' + sNametitle  + '" onmouseover="fnDrivePrevImg(' + m_aCAtt[i].index + ')" onmouseout="fnDrivePrevImgOff()"onclick="' + f_sDownloadURL + '" imgtype="prev" cindex="' + m_aCAtt[i].index + '" class="BPFile" style="width:' + iNameWidth + '; cursor:pointer" id="attname' + m_aCAtt[i].index + '" >' + m_aCAtt[i].name + '</div>' +
						 '   <div title="' + top.m_sDriveDateUploaded + '" style="width:' + iDateWidth  + '; text-align:right">&nbsp;&nbsp;' + FullTimeY + '</div>\n' +
						 '   <div style="width:90px; text-align:right; cursor:default;">&nbsp;&nbsp;' + ext + '</div>\n' +
						 '   <div style="width:70px; text-align:right; cursor:default;">&nbsp;&nbsp;' + v_iSize + '</div>\n' +
						 '   <div style="width:95px; text-align:right; cursor:default;">&nbsp;<img style="' + sHideActionIcons + '; height:20px; height:20px; cursor:pointer; padding-right:5px; padding-left:5px" src="' + m_sRessIMGURL + 'share_gray.png" id="shareico' + m_aCAtt[i].index + '" onclick="' + f_sForwardClick + '; fnCancelClick(event)" class="jqTootltip" title="' + top.mcLang.Text('lang_drive_31',1) + '"/><img src="' + m_sRessIMGURL + 'download.png" imgtype="down" onclick="' + f_sDownloadURL + '; fnCancelClick(event)" class="jqTootltip" title="' + top.mcLang.Text('lang_drive_32',1) + '" style="height:20px; height:20px; cursor:pointer; ; padding-right:5px; padding-left:5px"/><img  src="' + m_sRessIMGURL + 'wizard.png" onclick="' + sEditPicURL + '; fnCancelClick(event)" class="jqTootltip" title="' + top.mcLang.Text('lang_drive_33',1) + '" style="padding-right:5px; padding-left:5px; height:20px; height:20px; cursor:pointer; ' + sEditStyleIco + '; ' + sHideActionIcons + '"/></div>\n' +
						 '</div>';
      			}
      			else
      			{
      				//
					f_sFileName = m_aCAtt[i].name
					ext = f_sFileName.substr(f_sFileName.lastIndexOf('.') + 1);
					ext = ext.toUpperCase();

 					if (bBackpackApp)
 					{
						var DigitalT = new Date(m_aCAtt[i].sDate);
	      			 	if ( (top.slang == 'av') ||  (top.slang == 'es') || (top.mSkinUI == 'telmex') )
			    			FullTimeY =   (DigitalT.getDate() - 1) + '/' + (DigitalT.getMonth() + 1) + '/' + DigitalT.getFullYear(); 
			    		else
			    			FullTimeY = (DigitalT.getMonth() + 1) + '/' + (DigitalT.getDate() - 1) + '/' + DigitalT.getFullYear();
			    				
						
						if (m_aCAtt[i].bImg == true)
							sNametitle = top.m_sDriveImgClk;
						else
							sNametitle = top.mcLang.Text('lang_drive_30',1);
							
						sTooltip = f_sFileName.replace(/"/gi, '\"') + '\n' + FullTimeY + ' ' +  m_aCAtt[i].sDate.split(' ')[1] + ' ' +  m_aCAtt[i].sDate.split(' ')[2] + '\n' + sNametitle;	
     				}
     				
     				if (m_aCAtt[i].bImg == true)
     					sCursor = ' ;';
     				else
     					sCursor = 'cursor:pointer;';
      			
      				f_sHTML ='<div id="imgprevbox' + m_aCAtt[i].index + '" cbxi="' + m_aCAtt[i].index + '" cindex="' + m_aCAtt[i].index + '" style="width:' + iDivWidth + 'px; height:100px; font-family: arial,helvetica,sans-serif; font-size: 11px; text-align:center; color:#4c6776; float:left; margin-right:5px; margin-bottom:20px" ' + f_sDragClass + ' >' +
						 f_sBackPackCheckBox  +
						 '	<div title="' + sTooltip + '" attext="' + ext + '" onclick="' + f_sDownloadURL + '" class="attDocView" attsize=' + m_aCAtt[i].size + ' style="' + sCursor + ' float:left;max-height: 150px; background-color:#fff; display:inline-block; padding-right:6px"><a id="insta' + m_aCAtt[i].index + '" class="' + sClass + '" cindex="' + m_aCAtt[i].index + '" style="' + sCursor + ' display:inline-block;">' + sNewIcon + '<img imgtype="prev" id="aprevbx' + m_aCAtt[i].index + '"  class="BPFile" cindex="' + m_aCAtt[i].index + '" src="' + f_IMGIcon + '"   /></a></div>' +
						 '	<div class="msg_prev_attach_action" style="float:left; width:20px;"><a class="msg_prev_attach_action"><img style="' + sHideActionIcons + '; height:20px; height:20px; display:block; padding-top:2px;  cursor:pointer" src="' + m_sRessIMGURL + 'share_gray.png" id="shareico' + m_aCAtt[i].index + '" onclick="' + f_sForwardClick + '" title="' + top.mcLang.Text('lang_drive_31',1) + '" /></a><a class="msg_prev_attach_action"><img src="' + m_sRessIMGURL + 'download.png" imgtype="down" onclick="' + f_sDownloadURL + '" class="jqTootltip" title="' + top.mcLang.Text('lang_drive_32',1) + '" style="height:20px; height:20px; cursor:pointer; padding-bottom:10px; padding-top:10px; ' + sHideDownloadIcon + '"/></a><a class="msg_prev_attach_action"><img src="' + m_sRessIMGURL + 'wizard.png" onclick="' + sEditPicURL + '" class="jqTootltip" title="' + top.mcLang.Text('lang_drive_33',1) + '" style="height:20px; height:20px; cursor:pointer; ' + sEditStyleIco + '"/></a></div>' +
						 '	<div id="attname' + m_aCAtt[i].index + '" style="display:block;  clear:both;  height:22px; line-height:22px; width:' + iDivNameWidth  + 'px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap; overflow:hidden">' + m_aCAtt[i].name + '</div>' + 
						 '</div>';
      			}

       
           
   
               f_iFileType = FindFileType(m_aCAtt[i].name);             
               m_arrFileHTML[f_iFileType] += f_sHTML;
        }
        
        var sHeaderColor = '#5B6A7B';
        if (top.mSkinUI == 'telmex')
        	sHeaderColor = '#64afff';

        
            for(var i5=0; i5 < m_arrFileType.length; i5++)
            {
                if (m_arrFileHTML[i5].length > 10)
                {
                	i_TotalFiles = m_arrFileHTML[i5].split(' id="imgprevbox')
                	
                	sDriveOneFile  = top.m_sDriveOneFile.replace("xxxx ", "");
          			sDriveFiles =  top.m_sDriveFiles.replace("xxxx ", "");
          			
          			iTotalCatFiles = (i_TotalFiles.length - 1);
          			if (iTotalCatFiles == 1)
							sTotalFiles = sDriveOneFile;
						else
							sTotalFiles = sDriveFiles;
                
                   f_sALLHTML += '<tr>\n' +
                                 '    <td height="24">&nbsp;</td>\n' +
                                 '    <td width="100%" style="FONT-SIZE: 13px; color:' + sHeaderColor + '; padding-top: 5px;  padding-bottom: 15px" height="24" valign="bottom"><b>' + m_arrFileType[i5].split('|')[0] + ' (' + iTotalCatFiles + ' ' + sTotalFiles + ')</b></td>\n' +
                                 '</tr>\n' +
                                 '<tr>\n' +
                                 '     <td style="padding-top: 15px">&nbsp;</td>\n' +
                                 '     <td id="AttachMFTD" width="100%">' + m_arrFileHTML[i5] + '</td>\n' +
                                 '    </tr>\n' +
                                 '    <tr>\n';
                }       
            } 
    
 
 
 	    if (m_sDomaincode == "spray")
 	    {
	        sHideBPActions = ' style="display:none" ' 
	    }
 
	        
	    if (m_bHideOptions == false)
	    {
	        f_sHTMLHideOptions = msg_attv3_14;
	        f_sTRHideStyle = ''
	    }
	    else
	    {
	        f_sHTMLHideOptions = msg_attv3_15;
	        f_sTRHideStyle = ' style="display:none" ';
	    }
	    
	    sHideBPActions = '';
	    
	    if (m_iTotalMsgAttachSize  >= 1023)
		    m_iTotalMsgAttachSize = parseInt(m_iTotalMsgAttachSize  / 1023) + "MB";
		else
			m_iTotalMsgAttachSize = parseInt(m_iTotalMsgAttachSize) + "KB";

			
	   if (m_iTotalMsgAttach > 1)
			sAttachCountSize = m_iTotalMsgAttach + ' ' +  top.m_sAttachments + ' &nbsp;' + m_iTotalMsgAttachSize + '&nbsp;';
		else
		{
			var sMessage = top.mcLang.Text('lang_mail_122',1);
			sMessage = sMessage.replace(/xxxx/g, m_iTotalMsgAttach);
		
			//sAttachCountSize = sMessage + ' &nbsp;' + m_iTotalMsgAttachSize + '&nbsp;';
			
			sAttachCountSize = m_iTotalMsgAttach + ' ' + top.m_sOneAttachment  + ' &nbsp;' + m_iTotalMsgAttachSize + '&nbsp;';
			
		}

	    if (m_iTotalMsgAttach > 0)
	    {
	    	if (bBackpackApp)
	    	{
			    f_sAttachHTML = '<table class="IMGTD" border="0" width="100%" style="border-collapse: collapse; background-color:#fff">\n';			          
			}
			else
			{
				f_sAttachHTML = '<table class="IMGTD" border="0" width="100%" style="border-collapse: collapse; background-color:#fff">\n' +
		                    	'<tr>\n' +
			                	'    <td>&nbsp;&nbsp;</td>\n' +
			                	'    <td  style="padding-bottom: 15px; FONT-SIZE: 14px" width="100%"><div onclick="top.fnDownloadMsgAttach(' + m_iTotalMsgAttach + ')" class="jqTootltip" title="' + top.mcLang.Text('lang_drive_61',1) + '" style="color:#5B6A7B; cursor: pointer; text-decoration:underline; display:inline-block"><img src="' + m_sRessIMGURL + 'a.png" style="padding-top: 3px;" width="16px" height="16px" align="absmiddle/">&nbsp;' + sAttachCountSize + '</div></td>\n' +
		                    	'</tr>\n';
		                    
		                   //top.document.getElementById("Msg_Attach").innerHTML = '<a  href="JavaScript:fnMsgGoToAttach()" name="attachList" style="color:#5B6A7B"><img src="' + m_sRessIMGURL + 'a.png" style="padding-top: 3px;" align="absmiddle/">&nbsp;' + sAttachCountSize + '</a>'

			}
			
			m_iTotalMsgAttachSize = 0;
			//m_iTotalMsgAttach = 0;

			
	        f_sAttachHTML += f_sALLHTML;
	
	        f_sAttachHTML +='<tr>\n' +
			                '        <td>&nbsp;</td>\n' +
			                '        <td width="100%">&nbsp;</td>\n' +
		                    '    </tr>\n' +
	                        '</table>\n'
	       
			if (bBackpackApp)
			{
				return(f_sAttachHTML);
			}
			else 
			{
	        	return('<base target="_blank">\n' + f_sAttachHTML + '\n</base>\n');
	        	//document.getElementById('DIVAttachPrev').ondragstart = function() { return false; };
	        }
	        	
	        	
	        	
	        //$(".jqTootltip").tipTip();
        }

    }


    
    //:::::::
	//:::::::
    function FindFileType(f_sName)
    {
        var f_iType = m_ConstMisc;
        var f_String;
        var f_FileX = "";
        
        if(f_sName.indexOf(".") != -1)
        {
            f_String = f_sName.split(".");
            f_FileX = f_String[f_String.length - 1];
            f_FileX = '*' + f_FileX.toUpperCase() + '*';
            for(var i=0; i < m_arrFileType.length; i++)
            {
                if(m_arrFileType[i].indexOf(f_FileX) != -1)
                    return i;
            }   
        }  
        return f_iType;
    }
    
    
    //:::::::
	//:::::::
	function fnFindAttachIcon(f_sFileName)
	{
		var m_sAttachShareImgURL = m_sRessIMGURL + 'file_type/';
		var m_sIcon = '';
		var ext = f_sFileName.substr(f_sFileName.lastIndexOf('.') + 1);
		
		var sDefaultIco = '1371517465_url.png';
		
		switch (ext.toLowerCase()) 
		{	
			case 'xlsx' : m_sIcon = 'xlsx.png';   break;		
			case 'docx' :
			case 'doc' 	: m_sIcon = 'docx.png';   break;
			case 'ppt' 	: m_sIcon = 'pptx.png';   break;
			case 'pptx' : m_sIcon = 'pptx.png';   break;
			case 'pot' 	: m_sIcon = '1371517236_pptx_win.png';  break;
			case 'jpg' 	:
			case 'png' 	:
			case 'bmp' 	:
			case 'gif' 	:
			case 'jpeg'	: m_sIcon = '1371518115_jpeg.png';   break;
			case 'html'	:
			case 'htm' 	: m_sIcon = '1371514444_url.png';  break;
			case 'psd' 	: m_sIcon = '1371518192_psd.png';    break;
			case 'pdf' 	: m_sIcon = '1371517166_pdf.png';   break;
			case 'txt' 	: m_sIcon = '1371517247_readme.png';   break;
			case 'mdb' 	: m_sIcon = sDefaultIco;   break;
			case 'zip' 	: m_sIcon = '1371517792_zip.png';   break;
			case 'exe' 	: m_sIcon = sDefaultIco;   break;
			case 'mp3' 	: m_sIcon = '1371517344_mp.png'; break;
			case 'mpeg'	: 
			case 'avi' 	: 
			case 'wav' 	:
			case 'wmv' 	:
			case 'mp4' 	:
			case 'mpg' 	:
			case 'wma' 	: m_sIcon = '1371517300_avi.png'; break;
			case 'mov' 	: m_sIcon = '1371517300_avi.png';   break;
			case 'eml' 	: m_sIcon = '1371517176_pst.png';  break;
			case 'vcf' 	: m_sIcon = sDefaultIco;    break;
			case 'accdb': m_sIcon = 'accdb.png';  break
			case 'pub' 	: m_sIcon = 'pub.png';  break
			case 'vsd' 	: m_sIcon = 'vsd.png';  break
			default    	: m_sIcon = sDefaultIco;

			
		}
		
		return(m_sAttachShareImgURL + m_sIcon);
	}

	
	
    //:::
    function myBubbleSort(arrayName) 
    {
        var dummy;
        for (var i=0; i< (arrayName.length - 1); i++)
        {
            for (var j=i+1; j< arrayName.length; j++)
            {
                if (m_SortBy == "name")
                {
                    s_Value  = arrayName[j].name.toLowerCase();
                    s_Value2 = arrayName[i].name.toLowerCase();
                }
                else
                {
                    s_Value  = parseFloat(arrayName[j].size);
                    s_Value2 = parseFloat(arrayName[i].size);
                }
                
                if (m_SortBy == "sizes" || m_SortBy == "name")
                {
                    if ( s_Value < s_Value2) 
                    {
                        dummy = arrayName[i];
                        arrayName[i] = arrayName[j];
                        arrayName[j] = dummy;
                    }
                }
                else
              {
                    if ( s_Value2 < s_Value) 
                    {
                        dummy = arrayName[i];
                        arrayName[i] = arrayName[j];
                        arrayName[j] = dummy;
                    }
               }
            }
        }
    }
    
    //:::
    function TDI(f_iIndex, ImgObj)
    {
        document.getElementById(('L' + f_iIndex)).style.display = 'none';
        ImgObj.style.display = '';
    }
	//:::::SOCIAL NETWORKS API KEYS ::::::: STARTS
	
	var sServerName = location.hostname;
	sServerName = sServerName .toLowerCase(); 
	
	var m_sGoogledeveloperKey = '';
	var m_sGoogleClientId = '';
	
	var m_aInstagramClient_id = ""
	
	var m_sSkyDriveClientId = 'xxxxxxxxxxx'
	
	switch(sServerName )
	{

	    case 'v12dev.mail2world.com':
	    
			//:::::GOOGLE ::: STARTS
			//:: The API developer key obtained from the Google Developers Console.
			m_sGoogledeveloperKey = 'AIzaSyDJuHvPFe5_nE5xS53PzqlclQIjSxpawpg';
			                   			//:: The Client ID obtained from the Google Developers Console.
			m_sGoogleClientId = '425888500548-be06l0esdukfh0p99qs4ojjemqp62ua9.apps.googleusercontent.com';
			

			
			
			if (m_sHTTPS == "s")
				m_sGoogleClientId = '425888500548-n32af7bgoj0apb7qstpv37jedshb69rs.apps.googleusercontent.com';
				
				m_sGoogledeveloperKey = 'AIzaSyBRcpOm2X5vuQt-sME95qD08v5OfDj4Xio';
				m_sGoogleClientId = '478170200751-4t1k7ik7drv7iourkrnn0v20cb79nqe8.apps.googleusercontent.com';

								
			//:::::GOOGLE ::: ENDS

			//:::::instagram ::: STARTS
			m_aInstagramClient_id 	= "8b49b6222aaa4f8b88ee750618763d67";	
			if (m_sHTTPS == "s")
				m_aInstagramClient_id = '9c6020a9684a4313b6f21310108658dd';			
			//:::::instagram ::: ENDS
			
			//:::::SKyDrive ::: STARTS
			m_sSkyDriveClientId = '000000004C12B09D';
			//:::::SKyDrive ::: ENDS

			
	        break;


	    case 'v12stage.mail2world.com':
	    
			//:::::GOOGLE ::: STARTS
			//:: The API developer key obtained from the Google Developers Console.
			m_sGoogledeveloperKey = 'AIzaSyDJuHvPFe5_nE5xS53PzqlclQIjSxpawpg';
			//:: The Client ID obtained from the Google Developers Console.
			m_sGoogleClientId = '425888500548-kaoojhbr7rc972kfkiqk3c08jh1cuauh.apps.googleusercontent.com';
			//:::::GOOGLE ::: ENDS

			//:::::instagram ::: STARTS
			m_aInstagramClient_id 	= "979295602540446b8172a9969b1ed3fd";	
			//if (m_sHTTPS == "s")
			//	m_aInstagramClient_id = '9c6020a9684a4313b6f21310108658dd'				
			//:::::instagram ::: ENDS
			
			//:::::SKyDrive ::: STARTS
			m_sSkyDriveClientId = 'xxxxxxxxx'
			//:::::SKyDrive ::: ENDS

		
	        break;


	    case 'v12.stage.mail2world.com':
	    
			//:::::GOOGLE ::: STARTS
			//:: The API developer key obtained from the Google Developers Console.
			m_sGoogledeveloperKey = 'AIzaSyBh_WSX9gMLhdM4ek83xjbsGQ0b_XCU8tU';
			//:: The Client ID obtained from the Google Developers Console.
			m_sGoogleClientId = '425888500548-f8o0jg3i3ktco3vusekhqoq78g70nb2q.apps.googleusercontent.com';
			//:::::GOOGLE ::: ENDS

			//:::::instagram ::: STARTS
			m_aInstagramClient_id 	= "979295602540446b8172a9969b1ed3fd";	
			//if (m_sHTTPS == "s")
			//	m_aInstagramClient_id = '9c6020a9684a4313b6f21310108658dd'				
			//:::::instagram ::: ENDS
			
			//:::::SKyDrive ::: STARTS
			m_sSkyDriveClientId = '000000004C12B88B'
			//:::::SKyDrive ::: ENDS

		
	        break


	    case 'mail.infinitummail.com':
	    
			//:::::GOOGLE ::: STARTS
			//:: The API developer key obtained from the Google Developers Console.
			m_sGoogledeveloperKey = 'AIzaSyBh_WSX9gMLhdM4ek83xjbsGQ0b_XCU8tU';
			//:: The Client ID obtained from the Google Developers Console.
			m_sGoogleClientId = '425888500548-nktse08o88d7f1rjenohi5va627mgd58.apps.googleusercontent.com';
			
			if (m_sHTTPS == "s")
				m_sGoogleClientId = '425888500548-6klgp1cgglaj92co91ehh6qs2rv4gnt9.apps.googleusercontent.com';
			//:::::GOOGLE ::: ENDS

			//:::::instagram ::: STARTS
			m_aInstagramClient_id 	= "d12f8d14740849e4ac6cb25aca659a2b";	
			if (m_sHTTPS == "s")
				m_aInstagramClient_id = 'a3dae0d7cda44c22a999f63cd56eaa9b';			
			//:::::instagram ::: ENDS

			//:::::SKyDrive ::: STARTS
			m_sSkyDriveClientId = '000000004013179E'
			//:::::SKyDrive ::: ENDS


			
	        break;

	        
	    default:
	        
	        
	}
	


	//:::::SOCIAL NETWORKS API KEYS ::::::: ENDS


	var m_AllFilesArr = new Array();
	    
	var m_FileDataArr = new Array();
	var m_bUploaderBusy = false;
	var m_sTextDelm = '##_$%|';
		
	var m_iTotalAttachNoneFlash = 0;
		
	var m_iTotalQAttach = 0;
	var m_iTotalQAttachSize = 0;
	var miSelectedFiles = 0;
	var miSelectedFilesDone = 1;
	
	var m_bHideDragnDropScreen = true;
		
	bFlashEnabled = false;
	
	var uploader;
	var uploadDone = true;
	
	var msUploaderApp = 'composer';
	
	// Variable for holding the filelist.
	var fileList;
	var bUploaderCanceled = false;
	
	var m_DragDropTimeID = null;
	
	//:::::::
	//:::::::
	function SelectME()
	{
		$( "button[aria-label='Select Files']" ).click();
	}
	
	//:::::::
	//:::::::
	function UploadME()
	{
		$( "#uploadFilesButton" ).click();
		
	}
	
	//max file ot total size attach for composer in MB
	var m_iRTEMaxAttachSize = 25;
	var m_arrMoveDriveFileId = [];
	var m_newFileList = [];
    //var baseUploaderURL = "/app/mfile.asp";
    var baseUploaderURL = "/webrestapi/graph/mailbox/web/files/Upload";
	//:::::::
	//:::::::
	function fnNewYUIUploader()
	{
	
		//*******************YUI SANDBOX STARTS ***********************
		YUI().use('uploader', function(Y) {
		
			YUI.namespace('YUINameSpaceUpload');
		
			var bmultipleFiles = true;
			 YUI.YUINameSpaceUpload.fnChnageYUIUploadApp = function(sApp) {
                 uploader.set("uploadURL", baseUploaderURL+"?UploaderApp=" + sApp + "&FolderID=");

             }
			
			//////////start if #42
		   	if (Y.Uploader.TYPE != "none" && !Y.UA.ios) 
		   	{
		   
			   	if ($.browser.name == 'safari') 
			   	{
			   		//alert('Its Safari');
			   		bmultipleFiles = false;
			   	}
	
				uploader = new Y.Uploader({width: "250px",
		                                      height: "35px",
		                                      multipleFiles: bmultipleFiles,
		                                      swfURL: "http://" + location.hostname + "/app/flashuploader.swf?t=" + Math.random(),
		                                      uploadURL: baseUploaderURL+"?UploaderApp=" + msUploaderApp + "&FolderID=" + mBackpackFolderID,
		                                      simLimit: 1,
		                                      selectButtonLabel: '',
		                                      withCredentials: false
		                                     });
	
				//////////start if #43
				if (Y.Uploader.TYPE == "html5") 
				{
					uploader.set("dragAndDropArea", window);
		
					uploader.on(["dragenter", "dragover"], function (event) {
							
							var ddmessage = Y.one(window);
			              	if (ddmessage) 
			              	{           
								if (mRTEOpen || mQuickRTEOpen)
				               	{
									mbDropMode = false;
                                    uploader.set("uploadURL", baseUploaderURL +"?UploaderApp=composer&FolderID=" + mBackpackFolderID); 
				               	}
				               	else
				               	{
				               	 	if (m_iCurrentAppIndex != 3)
			            				mBackpackFolderID = '';
			            				
				               	  mbDropMode = true;
                                    uploader.set("uploadURL", baseUploaderURL +"?UploaderApp=backpack&FolderID=" + mBackpackFolderID);
				               	}
			
				                window.clearTimeout(m_DragDropTimeID);
				                
				                m_bHideDragnDropScreen = true;
				                
				                fnDragZoneFullscreen(true);
				                fnDocOnClick();
			            	}
					});
					//////////
		
					uploader.on(["dragleave"], function (event) {
								
		              	var ddmessage = Y.one(window);
		              	if (ddmessage) 
		              	{
			                m_DragDropTimeID = window.setTimeout("fnDragZoneFullscreen()",100);
		              	}
		           	});
		           	//////////
		           
		           	uploader.on(["drop"], function (event) {
		           	
		              	var ddmessage = Y.one(window);
		              	if (ddmessage) 
		              	{
		              		///////////
			                if (m_bHideDragnDropScreen)
			                {
			                	$("#divDropScreen").css( "display", "none" );
			                	UpdateInboxAlert(m_sDragnDropValidFiles, '');
			                
			                	if (mbDropMode == false)
			                	{
			                		fnDragZoneFullscreen();
			                		mbDropMode = false;
			                		m_bHideDragnDropScreen = false;
			                		return;

			                	}
			                
			                	if ( (m_iTotalQAttach == 0) )
			                	{
			                		fnDragZoneFullscreen();
			                		mbDropMode = false;
			                		m_bHideDragnDropScreen = false;
			                	}
			                }
			                ////////////

		              	}
		           	});
		           	//////////
		           
		       	}
		       	//////////end if #43
		       
	
			   	//:::::::::::
			   	//:::::::::::	
		       	uploader.render("#selectFilesButtonContainer");
		 
			   	//:::::::::::
			   	//:::::::::::
		       	uploader.after("fileselect", function (event) {
		       	
		       	
		       		fileList = event.fileList;
		          	m_newFileList = [];
		          	m_arrMoveDriveFileId = [];
		          	
					var bValidDrop = true;
					for (var mi= 0; mi < fileList.length; mi++)
					{
						//alert( ' size:' +  fileList[mi].get("size") + '\n name:' + fileList[mi].get("name") + '\n type:' + fileList[mi].get("type") + '\n id:' + fileList[mi].get("id"))
						
						//invalid drag-n-drop (folders)?!
						if (typeof fileList[mi].get("size") == "undefined")
						{
							bValidDrop = false;
							break;
						}
						else
						{
							//name has no dot and returns the exact folder size?!
							if (   (fileList[mi].get("name").indexOf('.') == -1)   &&   (fileList[mi].get("size") % 4096 == 0)    )
							{
								bValidDrop = false;
								break;
							}
							else if ( fileList[mi].get("size") == 4096 )  //last check a folder with a dot in the name!
							{
								bValidDrop = false;
								break;

							}
						}
						

					}
					
					/////////
					if (bValidDrop == false)
					{
						UpdateInboxAlert(m_sDragnDropValidFiles, '');
						if (mbDropMode == false)
			            {
			                fnDragZoneFullscreen();
			                mbDropMode = false;
			                m_bHideDragnDropScreen = false;
			                return;

			            }
			                
			            if ( (m_iTotalQAttach == 0) )
			            {
			                fnDragZoneFullscreen();
			                mbDropMode = false;
			                m_bHideDragnDropScreen = false;
			            }
						return;
					}
					/////////
		       	
		       		m_bHideDragnDropScreen = false;
		       	
			                if (mRTEOpen || mQuickRTEOpen)
			                {
			  		            mbDropMode = false;
			                	fnDragZoneFullscreen();
			                }
			                else
			                {                
			                	mbDropMode = true;	                
			                	fnDragZoneFullscreen(true);
			                	fnMagicBoxMenu(true);
			                	//fnBuildBackpackFolders('magicbox');
			                	MBOXDisableBtns();
			                }

		       
					if ( ($("#divMagicBoxMenu").css( "display") == "none") && ( (mRTEOpen == false) && (mQuickRTEOpen == false) ) )
		       		{
		       			fnDragZoneFullscreen(true);
			        	fnMagicBoxMenu(true);
			         	MBOXDisableBtns();
		       		}
		       
		       		if (m_SpellStatus == "on")
					{
						fnCloseSpellCheck();
					}
	
		          			          
		
		          	if (uploadDone) 
		          	{
		            	uploadDone = false;
		          	}
		
		          	Y.each(fileList, function (fileInstance) {
		          
						var f_sHTMLCode = "";
						var f_bNewFile = true;
						var f_bSkipFile = false;
						rowCounter = 0;		
						sProgress = "<div style='height:20px; line-height:20px;  background-color:#EDEEEE; color:#535353; text-align: center; width:100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;'>" + mcLang.Text('lang_mbox_26',1) + "</div>";
						sSize = ShowFileSize(fileInstance.get("size"));	
						sAction = ShowAction(fileInstance.get("id"), 1, '');
						m_newFileList.push(fileInstance);
						m_iTotalQAttachSize += fileInstance.get("size");	
						m_FileDataArr.push(fileInstance.get("id"));						
							
						if ( mbDropMode == true)
						{
							sName = ShowFileIcon(fileInstance.get("name"),25,fileInstance.get("id"));
									sCheckBox = '<div style="padding-left:11px; float:left;  height:34px; line-height:34px; display:block;">&nbsp;<input type="checkbox" value="ON" disabled="disabled" id="CMBX' + fileInstance.get("id") + '" onclick="MOXCBO(this, event)"/>&nbsp;&nbsp;</div>';
									f_sHTMLCode += '<div id="' + fileInstance.get("id") + '" atrmovedir="" imgpr="" asize="' + fileInstance.get("size") + '" cattname="' + escape(fileInstance.get("name")) + '" onmouseout="fnPrevImgOff()" onmouseover="fnPrevImg(this,false)" style="cursor:default; clear: both; height:34px; line-height:34px; ;color:#60666f; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px;">' +
										 			sCheckBox + '<div class="UploadFile" id="' + fileInstance.get("id") + 'ns" style="float:left; width:250px;  height:34px; line-height:34px;" title="' + fileInstance.get("name") + ' (' + sSize + ')" >&nbsp;&nbsp;' + sName + ' (' + sSize + ')</div>' +
													'<div style="float:left; width:105px;  height:20px; line-height:20px;  margin-top:7px; text-overflow: ellipsis; white-space: nowrap" id="' + fileInstance.get("id") + 'p">' + sProgress + '</div>' +
													'<div style="float:right; width:45px;  height:34px; line-height:34px; padding-right:15px" id="' + fileInstance.get("id") + 'a">' + sAction + '</div>' +
													'</div>';
						}
						else
						{
							sCheckBox = '';
							sName = ShowFileIcon(fileInstance.get("name"),0,fileInstance.get("id"));
							f_sHTMLCode += '<div id="' + fileInstance.get("id") + '" imgpr="" asize="' + fileInstance.get("size") + '" cattname="' + escape(fileInstance.get("name")) + '" onmouseout="fnPrevImgOff()" onmouseover="fnPrevImg(this,false)" style="cursor:default; clear: both; height:27px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px;">' +
										 	sCheckBox + '<div  title="' + escape(fileInstance.get("name")) + ' - ' + sSize + '" class="UploadFile jqTootltip" id="' + fileInstance.get("id") + 'ns" style="float:left; width:205px; line-height:24px;"><div style="float:left; width:40px; line-height:24px; text-align:right">' + sSize + '</div>&nbsp;&nbsp;' + sName + '</div>' +
											'<div style="float:left; width:105px; line-height:16px;" id="' + fileInstance.get("id") + 'p">' + sProgress + '</div>' +
											'<div style="float:right; width:45px; line-height:22px;" id="' + fileInstance.get("id") + 'a">' + sAction + '</div>' +
											'</div>';
						}
							
						m_iTotalQAttach +=1;		
							 
						try
						{	
							if ( mbDropMode == true)
							{
								document.getElementById("divMagicBoxList").innerHTML += f_sHTMLCode; 
								//m_iTotalQAttachSize += fileInstance.get("size");
							}
							else
							{
								document.getElementById("mAttahcMenu").innerHTML += f_sHTMLCode;
								//check max total size for RTE :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
								m_iTotalQAttachSize -= fileInstance.get("size");
								
								/*
								fnAddDebug('m_iTotalQAttachSize:' +m_iTotalQAttachSize + '\n');
								fnAddDebug('both:' + (m_iTotalQAttachSize + fileInstance.get("size") ) + '\n');
								fnAddDebug('Max:' +(m_iTotalQAttachSize + ((m_iRTEMaxAttachSize * 1023)*1023)) + '\n');
								*/
								
								if ( (m_iTotalQAttachSize + fileInstance.get("size") ) > ((m_iRTEMaxAttachSize * 1023)*1023) )
								{				
									sSize = ShowFileSize(fileInstance.get("size"));
									m_arrMoveDriveFileId.push(fileInstance.get("id") + '|' + 0 + '|' + sSize + '|' + encodeURI(fileInstance.get("name")));			
								}
								else
									m_iTotalQAttachSize += fileInstance.get("size");
								//:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::	
							}
								  		
							//show attach popup list
							fnShowAttachList();
							//$(".jqTootltip").tipTip();
								  
						}catch(err) { alert('err in Y.each(fileList, function (fileInstance)') }
					  
		                                    
		      		}); 
		      		//////////
		      				      		
		      		YUI.YUINameSpaceUpload.fnCAllYUIUpload = function() {
		      		
                		uploader.set('fileList', m_newFileList);
		           		$( "#uploadFilesButton" ).click();

             		}
             		
             		if ( mbDropMode == true)
					{
						//:::::::::::::::::::::::::::Check file size for Backpack/majicbox
			            if ( (mRTEOpen == false) && (mQuickRTEOpen == false) )
			            {
			             	arrStorage = m_sBackPackStorage.split("|"); 
						    iUserPercentage = parseInt(arrStorage[0]);
							iUserSise		  = parseInt(arrStorage[1]);
							iMaxQuota		  = parseInt(arrStorage[2]);
							iFreeStorageMB    = ( (iMaxQuota - iUserSise) * 1023 ) * 1023;
							
							//iFreeStorageMB = 1046529;
			             		
			             	if ( m_iTotalQAttachSize >= iFreeStorageMB )
			             	{
			             		alert(m_sDriveUploadLimit);
			             		mbDropMode = false;
								fnRTEClose();
								document.getElementById("divMagicBoxList").innerHTML = '';
								fnDragZoneFullscreen(); 
								return;
			             	}
			             }
			             //::::::::::::::::::::::::::ENDS
					}

             		

		      		           		
             		//::::::::::::::::::::::::::::Check file sizes STARTS
		            if ( (mRTEOpen || mQuickRTEOpen) && (m_arrMoveDriveFileId.length > 0) )
					{
						fnDocOnClick();
		                bturncate = 43;
		                
		                var sMessage = mcLang.Text('lang_mail_91',1) + '<br>';
		                sMessage = sMessage.replace(/_xxMaxAttachSize_xx/gi, m_iRTEMaxAttachSize);
		                for (var i=0; i < m_arrMoveDriveFileId.length; i++)
		                {
		                	arrAttachFile = m_arrMoveDriveFileId[i].split('|');		
							sName = ShowFileIcon(arrAttachFile[3],33,arrAttachFile[0]);
		                 	sMessage += '<br><span title="' + arrAttachFile[3] + ' - ' + arrAttachFile[2] + '">' + sName + ' - ' + arrAttachFile[2] + '</span>'; 		                 	
		                 }  	
		                 sMessage += '<br><br>' + mcLang.Text('lang_mail_92',1); 
		                      	
		                 //prompt user for  action...
						fnYUIPromptAttachLimit(sMessage, mcLang.Text('lang_mail_93',1), mcLang.Text('lang_mail_94',1), 'message icon-bubble', fnBlacnkcall, arguments)
							
					}
					else
					{
						uploader.set('fileList', m_newFileList);
		           		$( "#uploadFilesButton" ).click();
					
					}
					//::::::::::::::::::::::::::::Check file sizes ENDS
             		
                                 
		            
		       });
		       //////////
		       
		       //:::::::::::
			   //:::::::::::	
		       uploader.on("uploaderror", function (event) {
		                
		                
		                
		       });

	
	
			   //:::::::::::
			   //:::::::::::	
		       uploader.on("uploadprogress", function (event) {
		                
		                onUploadProgress(event);
		       });
		       
	
			   //:::::::::::
			   //:::::::::::
		       uploader.on("uploadstart", function (event) {
		            uploader.set("enabled", false);
		            //Y.one("#uploadFilesButton").detach("click");
		             
		            //show attach popup list
					fnShowAttachList();
	
		       });
		       //////////
		       
		
			   //:::::::::::
			   //:::::::::::
		       uploader.on("uploadcomplete", function (event) {
		            
		            //var fileRow = Y.one("#" + event.file.get("id") + "_row");
		            //    fileRow.one(".percentdone").set("text", "Finished!");  
		            // fnAddDebug('\n event.file.get("id") %: Finished!! '); 
		           onUploadComplete(event);
	       
		                
		       });
		       //////////
	
	
			   //:::::::::::
			   //:::::::::::	
		       uploader.on("totaluploadprogress", function (event) {
		       	         
						var sMessage = '';       
		                if (miSelectedFiles > 1)
		                {
			                $('#MBoxTotalProgressBarBG').css( "visibility", "visible");
			                $('#MBoxTotalProgressBar').css( "width", event.percentLoaded + "%");
			                
			               	sMessage = mcLang.Text('lang_mbox_27',1);
							sMessage = sMessage.replace(/_xxFilexx_/gi, miSelectedFilesDone);
							sMessage = sMessage.replace(/_xxTotalxx_/gi, miSelectedFiles);
							sMessage = sMessage.replace(/_xxTotalZisexx_/gi, ShowFileSize(m_iTotalQAttachSize)); 
			                $('#MBoxTitle').html('<b>' + sMessage + '</b>');
		                }
		                else
		                {
			               	sMessage = mcLang.Text('lang_mbox_20',1);
							sMessage = sMessage.replace(/xxxx/gi, ShowFileSize(m_iTotalQAttachSize)); 
			                $('#MBoxTitle').html('<b>' + sMessage + '</b>');
		                }
		                
		                
		                if (event.percentLoaded <= 0)
		                {
		                //show attach popup list
						 fnShowAttachList();
						 }
	
		       });
		       //////////
	
	
			   //:::::::::::
			   //:::::::::::	
		       uploader.on("alluploadscomplete", function (event) {
		       		       
			   		uploader.set("enabled", true);
		            uploader.set("fileList", []);
		            uploadDone = true;
		            
		            m_arrMoveDriveFileId = [];
		                     
		            $('#MBoxTotalProgressBarBG').css( "visibility", "hidden");
		            $('#MBoxTotalProgressBar').css( "width", "0%");
		            
					var sMessage ='';    	 
		            if (miSelectedFiles > 1)
		            {
		            	
		            	sMessage = mcLang.Text('lang_mbox_13',1);
						sMessage = sMessage.replace(/xxxx/g, miSelectedFiles);
						sMessage = sMessage.replace(/_xxsizexx_/gi, ShowFileSize(m_iTotalQAttachSize));
		     			UpdateInboxAlert(sMessage, '');
		            	$('#MBoxTitle').hide().html(sMessage).fadeIn(500);
		            
		            }
		            else
		            {
		            	
		            	sMessage = mcLang.Text('lang_mbox_12',1);
						sMessage = sMessage.replace(/xxxx/gi, ShowFileSize(m_iTotalQAttachSize));
		            	$('#MBoxTitle').hide().html(sMessage).fadeIn(500);
		            	
		            }
	
		            //For Backpack
		            if (m_iCurrentAppIndex == 3)
		            {
						fnBackpackGetFolders(mBackpackFolderID);
		            }
		                     
		           	MBOXEnableBtns();
		                     
		                     
		       	});
		       	//////////
	
			   	//:::::::::::
			   	//:::::::::::	
		       	Y.one("#uploadFilesButton").on("click", function () {
		       
			         if (!uploadDone && uploader.get("fileList").length > 0) {
			         
			        		miSelectedFiles = uploader.get("fileList").length;
			        		miSelectedFilesDone = 1;
			         
			         		//did we cancel an upload in-progress?
			              	if (bUploaderCanceled)
	     					{
	     						uploader.queue.set("fileList", fileList);
	     						uploader.queue.startUpload();
	     						bUploaderCanceled = false;
	     					}
	     					else
	     					{
	     						uploader.uploadAll();
	     					}
			         }
		         
		       	});
		       	//////////
		       
		   	}
		   	else 
		   	{
				//Y.one("#uploaderContainer").set("text", "We are sorry, but to use the uploader, you either need a browser that support HTML5 or have the Flash player installed on your computer.");
		   	}
			//////////start if #42
		
		
		});
		//*******************YUI SANDBOX ENDS ***********************
	
	}


	//:::::::::::
	//:::::::::::	
	function fnRemoveAttachLimitFiles()
	{
		if ( (mRTEOpen || mQuickRTEOpen) && (m_arrMoveDriveFileId.length > 0) )
		{
			fnDocOnClick();
			for (var i=0; i < m_arrMoveDriveFileId.length; i++)
		    {
				arrAttachFile = m_arrMoveDriveFileId[i].split('|');	
				for (var c=0; c < m_newFileList.length; c++)
		    	{
		    		if ( m_newFileList[c].get("id") == arrAttachFile[0] )
		    		{
		    			//$('#' + m_newFileList[c].get("id")).css('display','none');
		    		   f_sID = m_newFileList[c].get("id");
		    		   document.getElementById(f_sID).style.display = "none";
					   m_iTotalQAttach -=1;
					   fnShowAttachCount();

		    			m_newFileList.splice(c,1);
		    			break;
		    		}
		    	}
			}  	
			
			m_arrMoveDriveFileId = [];
						
		}
		
		YUI.YUINameSpaceUpload.fnCAllYUIUpload();

	}
	
	//:::::::::::
	//:::::::::::	
	function fnRTESendViaDrive()
	{  
		//attach limit via Drive POPUP?  //file oversize?...then we used Drive
		if ( (m_bDrivePOPUP == true) && (m_arrMoveDriveFileId.length > 0) && (mRTEOpen || mQuickRTEOpen) )
		{
			sHTML = '<br><br>' + mcLang.Text('lang_mbox_29',1) + ':';
			for (var c=0; c < m_arrMoveDriveFileId.length; c++)
		    {
		    	arrAttachFile = m_arrMoveDriveFileId[c].split('|');
				sURL = location.protocol + '//' + location.host + '/FileCabinet/Download.asp?User=' + m_sUsername + '@' + m_sDomain + '&app=web&FID=' + arrAttachFile[0];   
				sURL = '<a _moz_dirty=""target="_blank" href="' + sURL + '">' + ShowFileIcon(arrAttachFile[3],0,''); + '</a>'
				sHTML += '<br>' + sURL;
		  	}
		
			sMsgBody = $('#RichEditIFrameID').contents().find('body').html();
			sMsgBody = sMsgBody.split('<div origmsg="yes"></div>');
			if ( sMsgBody.length > 1 )
				sMsgBody = sMsgBody[0] + sHTML + '<div origmsg="yes"></div>' + sMsgBody[1];
			else
				sMsgBody = sMsgBody[0] + sHTML
			$('#RichEditIFrameID').contents().find('body').html(sMsgBody);
			////////
		
		}
		else
		{
			YUI.YUINameSpaceUpload.fnChnageYUIUploadApp('backpack');
			YUI.YUINameSpaceUpload.fnCAllYUIUpload();
		}
		 
	}
	
	function fnBlacnkcall()
	{
	
	}

	//:::::::::::
	//:::::::::::
	function fnSetUpUploaderBtn(bShowBtn)
	{
	
		if ( ($.browser.name == "msie" && $.browser.versionNumber == 9) || ($.browser.name == 'safari') )
		{
			if (bShowBtn)
			{
				$("#selectFilesButtonContainer").css( "display", "block" );
				$("#selectFilesButtonContainer").width($("#btnAttach").width() + 15);
				$(".yui3-button").width($("#btnAttach").width() + 15);
				$(".yui3-button").height($("#btnAttach").height());
	
				//Get
				var p = $("#btnAttach");
				var offset = p.offset();
				//set
				$(".yui3-uploader").parent().offset({ top: offset.top, left: offset.left});
				
				$(".yui3-uploader").css({ 'opacity' : 0});
			}
			else
			{
				$("#selectFilesButtonContainer").css( "display", "none" );
			}
		}
		

	
	}

	//:::::::
	//:::::::
	function InitQuickAttach(sApp)
	{
		if (mRTEOpen || mQuickRTEOpen)
			mbDropMode = false;
	
		msUploaderApp = sApp;
		
		if (m_iCurrentAppIndex != 3)
	    	mBackpackFolderID = '';

				
        uploader.set("uploadURL", baseUploaderURL +"?UploaderApp=" + msUploaderApp + "&FolderID=" + mBackpackFolderID);
		//$( ".yui3-button" ).click();		
		$("button[aria-label='']").click();
		
	}

	// Actually uploads the files. In this case,
	// uploadAll() is used for automated queueing and upload 
	// of all files on the list.
	// You can manage the queue on your own and use "upload" instead,
	// if you need to modify the properties of the request for each
	// individual file.
	function upload() 
	{

		if (fileList != null) {

			if ( (m_FileDataArr.length)  )
			{
				if (m_iCurrentAppIndex != 3)
	            	mBackpackFolderID = '';

				uploader.set("multipleFiles", false);
                uploader.upload(m_FileDataArr.shift(), baseUploaderURL +"?UploaderApp=" + msUploaderApp + "&FolderID=" + mBackpackFolderID, {postvar1: "foo", postvar2: "bar"});
			}
		}	
	}


	// Do something on each file's upload progress event.
	//:::::::
	//:::::::
	function onUploadProgress(event) 
	{
		//fnAddDebug('\n totaluploadprogress %:' + event.percentLoaded; 
	
		prog = event.percentLoaded;
		sColor = "#3B3B3B"
		sbarColor = "orange"
		
		if (prog <=5)
			prog = 5
		
		if (prog >= 30)
		{
			sbarColor = "yellow"
			sColor = "#3B3B3B"
		}
		
		var fAction = 0	
		if (prog > 80)
		{
			prog = 80;
			sbarColor = "green"
			fAction = 3
		}
		
		sProgStatus = ''//prog; 

		progbar = "<div style='height:16px;width:100px;'><div style='height:16px;background-color:#EDEEEE; color:" + sColor + "; background: url(" + m_sRessIMGURL + "/attach/barflat_" + sbarColor + ".gif); text-align: center; width:" + prog + "px;'>" + sProgStatus + "</div></div>";
		document.getElementById(event.file.get("id") + "p").innerHTML = progbar;	
		document.getElementById(event.file.get("id") + "a").innerHTML = ShowAction(event.file.get("id"), fAction, '');
		m_bUploaderBusy = true;
		
		document.getElementById("AttachBusy").style.visibility = 'visible';
	}
	
	// Do something when each file's upload is complete.
	//:::::::
	//:::::::
	function onUploadComplete(event) {
	
		//top.fnRTEUpdate();

		progbar = "<div style='height:16px;  background: url(" + m_sRessIMGURL + "attach/bar_white.gif)'><div style='height:16px;background-color:#fff; color:#185715; background: url(" + m_sRessIMGURL + "attach/bar_green.gif); text-align: center;  '>100%</div></div>";
	
		//alert(event.file.get("size"));
	
		//document.getElementById(event.file.get("id") + "p").style.visibility = 'hidden';
		if ( mbDropMode == true)
		{
			//Fined selected Drive folderID
			//alert( $('#mBackPackDirsList').find( "a:contains('" + mBackpackFolderID + "')" ).html() );
			if (m_iCurrentAppIndex == 3)
				sDriveName = $( ".LeftPanelDirClick" ).attr('atrdname');
			else
				sDriveName = 'Drivetop';
		
			document.getElementById(event.file.get("id") + "p").innerHTML = '&nbsp;<img style="height:16px; width:16px;" src="' + m_sRessIMGURL + 'mbox_folder.png">&nbsp;&nbsp;' + sDriveName;
		}
		else
		{
			//document.getElementById(event.file.get("id") + "p").innerHTML = '';
			document.getElementById(event.file.get("id") + "p").style.visibility = 'hidden';
		}
		
		document.getElementById(event.file.get("id") + "a").innerHTML = ShowAction(event.file.get("id"), 2, '');
		m_bUploaderBusy = false;		
		document.getElementById("AttachBusy").style.visibility = 'hidden';
		miSelectedFilesDone +=1;
		
		//remove ID from array
	  	RemoveFromArr(event.file.get("id"));

 		var f_sServerData = event.data;
 		var arrData  = f_sServerData.split('|');
 		 
 		//file oversize?...then we used Drive
 		if ( (mRTEOpen || mQuickRTEOpen) && (m_arrMoveDriveFileId.length > 0) )
 		{
			f_sID = event.file.get("id");
		    document.getElementById(f_sID).style.display = "none";
			m_iTotalQAttach -=1;
			fnShowAttachCount();
			fnShowAttachList();

			sURL = location.protocol + '//' + location.host + '/FileCabinet/Download.asp?User=' + m_sUsername + '@' + m_sDomain + '&app=web&FID=' + arrData[3];   
			sURL = '<a _moz_dirty=""target="_blank" href="' + sURL + '">' + ShowFileIcon(event.file.get("name"),0,''); + '</a>'
			sHTML= '<br>' + sURL;
			sHTML = '<br><br>' + mcLang.Text('lang_mbox_29',1) + ':' + sHTML;

			sMsgBody = $('#RichEditIFrameID').contents().find('body').html();
			sMsgBody = sMsgBody.split('<div origmsg="yes"></div>');
			if ( sMsgBody.length > 1 )
				sMsgBody = sMsgBody[0] + sHTML + '<div origmsg="yes"></div>' + sMsgBody[1];
			else
				sMsgBody = sMsgBody[0] + sHTML
			$('#RichEditIFrameID').contents().find('body').html(sMsgBody);

			//fnUpdateRTEText('<p style="margin-top:2px; margin-bottom:2px"><br/></p>' + sHTML); 
			for (var c=0; c < m_arrMoveDriveFileId.length; c++)
		    {
		    	arrAttachFile = m_arrMoveDriveFileId[c].split('|');
				if ( event.file.get("id") == arrAttachFile[0] )
				{
					m_arrMoveDriveFileId.splice(c,1);
		    		break;
				}
		   }
			
			m_bUploaderBusy = false;
 			return;
 		}
 		

		m_AllFilesArr.push( event.file.get("id") + m_sTextDelm + arrData[0] );
		

		if (arrData.length >= 3)
		{
			document.getElementById(event.file.get("id")).setAttribute("imgpr", arrData[0] + '|' + arrData[1] + '|' + arrData[2]);
			
			if ( mbDropMode == true)
			{
				fnShowMBoxThumb(arrData[0], event.file.get("id"));
				document.getElementById(event.file.get("id")).setAttribute("backpackid", arrData[3]);
			}
		
		}
		else
		{
			document.getElementById(event.file.get("id")).setAttribute("imgpr", '');
			
			if ( mbDropMode == true)
			{
				document.getElementById(event.file.get("id")).setAttribute("backpackid", arrData[1]);
			}

		}
		
		m_bUploaderBusy = false;
					 	
	}
	
	// :::::::::::::::::::::::::::::::::::::::::::::::::::: MagicBox Tools ::::::::::::::::::::::::::::::::::::::::::::::::::: //

	//:::::::
	//:::::::	
	function fnShowMBoxThumb(sGUID, sID)
	{	
		if (document.getElementById(sID).getAttribute('imgpr').length > 5)
			document.getElementById('MboxP' + sID).src = m_sAttach_PrevURL + sGUID + '/prev_s.jpg';		
	}
	
	//:::::::
	//:::::::	
	function MPOXCAll(Obj)
	{
		var bMainCheckbox = Obj.checked;
	      
	   	for (var j = 0; j < m_AllFilesArr.length; j++)
	    {
	    	 sFile = m_AllFilesArr[j].split(m_sTextDelm)[0];
	         if (sFile != '#null')
	         {
	         	ObjBox = document.getElementById(("CMBX" + sFile));
	            if (ObjBox == null)
		            continue;

		        //ObjBox.checked = true;
		        //$(ObjBox).click();
		        ObjBox.checked = false;
	
	            if (Obj.checked)
	            {
	            	$(ObjBox).click();
	            	ObjBox.parentNode.parentNode.style.backgroundColor = "#cbe8f6";
	            }    
	            else
	            	ObjBox.parentNode.parentNode.style.backgroundColor = "";
	            	
	            $( "#MBOXCall" ).prop('checked', bMainCheckbox);
	         }
	    }
	    
	    m_bDontShowPOPOpt = true;
	    
	   fnShowMBoxActions();
	   
	   

	   
	}


	//:::::::
	//:::::::	
	function fnMagicBoxClose()
	{
	
		if (m_bUploaderBusy) 
		{
			var sMessage = mcLang.Text('lang_mbox_21',0)
			sMessage = sMessage.replace(/_xxbreaklinexx_/gi, "\n\n")
			if(confirm(sMessage))
			{
			
			}
			else 
				return;
		}
		
		mbDropMode = false;
		fnRTEClose();
		document.getElementById("divMagicBoxList").innerHTML = '';
		fnDragZoneFullscreen(); 
		
	}


	//:::::::
	//:::::::	
	function fnMBoxCheckBoxOpt(v_CheckOption)
	{
	
		for (var j = 0; j < m_AllFilesArr.length; j++)
	    {
	    	sFile = m_AllFilesArr[j].split(m_sTextDelm)[0];
	    	
	    	if (sFile == '#null')
	    		continue;
	    
		    ObjBox = document.getElementById(("CMBX" + sFile));
		    
            if (ObjBox == null)
	            continue;
	            
			if (v_CheckOption == 'All')
				document.getElementById("MBOXCall").checked = true;
			else
				document.getElementById("MBOXCall").checked = false;
	            
	        ObjBox.checked = false;
	        ObjBox.parentNode.parentNode.style.backgroundColor = "";
	                    
			var b_CheckIt = false;
						
			if (v_CheckOption == 'None')
	       		continue;	       

	       	if (v_CheckOption == 'All')
	       	{
	       		b_CheckIt = true;	       
	       	}
	       	else
	       	{
	       		sName = document.getElementById(sFile).getAttribute('cattname')
	       		b_CheckIt = fnMBOXCheckType(v_CheckOption, sName)
	       	}
	       
	       if (b_CheckIt)
	       {
	       		ObjBox.parentNode.parentNode.style.backgroundColor = "#cbe8f6";
	       		ObjBox.checked = true;
	       }

     
	    }
        
		fnShowMBoxActions();
	
	}


	//:::::::
	//:::::::	
	function MBOXDisableBtns()
	{
		
		$("#MBoxGoToMyfilesBtn").removeClass( "yui3-button-disabled" );
		$("#MBoxGoToMyfilesBtn").addClass( "yui3-button-disabled" );
		
		$("#MBoxDoneBtn").removeClass( "yui3-button-disabled" );
		$("#MBoxDoneBtn").addClass( "yui3-button-disabled" );

		//checkbox
		document.getElementById("MBOXAI").disabled = true;
		document.getElementById("MBOXAI").checked = false;
		document.getElementById("MBOXCall").checked = false;
		document.getElementById("MBOXCall").disabled = true;
		
		
		$("#btnArrangeMPOX").css( "display", "none");
		
		fnShowMBoxActions();
	
	}


	//:::::::
	//:::::::	
	function MBOXEnableBtns()
	{
		$("#MBoxGoToMyfilesBtn").removeClass( "yui3-button-disabled" );
		$("#MBoxDoneBtn").removeClass( "yui3-button-disabled" );		
	
		//checkbox
		document.getElementById("MBOXAI").disabled = false;
		document.getElementById("MBOXCall").disabled = false;
		
		$("#btnArrangeMPOX").css( "display", "");
		
		fnShowMBoxActions();
		fnMBoxSortList();
		
	}


	//:::::::
	//:::::::	
	function fnMBoxSortList()
	{
	
	
	}


	//:::::::
	//:::::::
	function fnMBoxChangeMoveFolder(uidFolderID, iIndex)
	{

		for (var j = 0; j < m_AllFilesArr.length; j++)
	    {
	    	sFile = m_AllFilesArr[j].split(m_sTextDelm)[0];
	    	if (sFile == '#null')
	    		continue;
	    
		    ObjBox = document.getElementById(("CMBX" + sFile)); 
            if (ObjBox == null)
	            continue;
	            
			if (ObjBox.checked)
			{
				bturncate = 13;
				sDirName = document.getElementById('BPDMDir'+ iIndex).innerHTML;
				if (sDirName.length > bturncate)
					sDirName = sDirName.substr(0, bturncate) + '...';

				 sDirName = '&nbsp;<img style="height:16px; width:16px;" src="' + m_sRessIMGURL + 'mbox_folder_org.png">&nbsp;&nbsp;' + sDirName;
				 
				 $('#' + sFile).attr('atrMoveDir', uidFolderID);
				 
				 $('#' + sFile + "p").hide().html(sDirName).fadeIn(500);
				 				 
			}
			
	    }
	    
	    //document.getElementById("MBOXAI").checked = false;
		//fnMBoxCheckBoxOpt('None');
	
	}

	//:::::::
	//:::::::	
	function fnMBoxShowCheckOpt()
	{
		if (m_bUploaderBusy) 
        {
        	UpdateInboxAlert(mcLang.Text('lang_mbox_30',1), '1359077142_info_16.png');
        	return;
        }
        else
			fnShowPOPOpt('MBOXCall', 'mMBoxCheckBoxOptions',-10,-7);
		
	}

	//:::::::
	//:::::::	
	function MPOXCheckAI(Objc)
	{
		
		if (Objc.checked == false)
		{
			$('#MBoxDoneBtn').html(mcLang.Text('lang_mbox_37',1)); 
			$('#MBoxDoneBtn').attr('saction','done');
		}
		else
		{
			$('#MBoxDoneBtn').html(mcLang.Text('lang_mbox_17',1));
			$('#MBoxDoneBtn').attr('saction','apply');
		}

		
		for (var j = 0; j < m_AllFilesArr.length; j++)
	    {
	    	sFile = m_AllFilesArr[j].split(m_sTextDelm)[0];
	    	if (sFile == '#null')
	    		continue;
	    	
	    	ObjBox = document.getElementById(("CMBX" + sFile)); 
            if (ObjBox == null)
	            continue;
	            
	        var cattname = document.getElementById(sFile).getAttribute('cattname');
	        var ext = cattname.substr(cattname.lastIndexOf('.') + 1);
			ext = ext.toLowerCase();
			
			sNewFolderID = '';
			sNewFolderName='';
			
			if (Objc.checked == false)
				ext = 'XXXXX';

			sIcon = m_sRessIMGURL + 'mbox_folder_org.png';

			switch (ext) 
			{	
				//Documents?
				case 'txt'  :		
				case 'docx' :
				case 'doc'  :
				case 'dot'  :
				case 'docm' : 
				case 'ppt'  :
				case 'dotx' :
				case 'dotm' :
				case 'xls'  : 
				case 'xlm'  :
				case 'xlsx' :
				case 'xlsm' :
				case 'xltx' : 
				case 'xltm' :
				case 'ppt'  : 
				case 'pptx' :
				case 'pot'  :
				case 'html' :
				case 'htm'  :
				case 'txt'  :
				case 'zip'  :
				case 'rar'  :
				case 'pdf'  :
				case 'psd'  :
				case 'eml'  :
				case 'vcf'  :
				case 'mdb'  :
								sNewFolderID  = m_sMyFiles_DocumentsID.split('|')[0];
								sNewFolderName= m_sMyFiles_DocumentsID.split('|')[1];  
								break;
				//Photos?
				case 'jpg'  :
				case 'png'  :
				case 'bmp'  :
				case 'gif'  :
				case 'tiff' :
				case 'tif' :
				case 'jpeg' : 
								sNewFolderID  = m_sMyFiles_PhotosID.split('|')[0];
								sNewFolderName= m_sMyFiles_PhotosID.split('|')[1];  
								break;
				//Videos?
				case 'mpeg' : 
				case 'avi'  : 
				case 'wmv'  :
				case 'mpg'  :	
				case 'mov'  :
								sNewFolderID  = m_sMyFiles_VideosID.split('|')[0];
								sNewFolderName= m_sMyFiles_VideosID.split('|')[1];  
								break;

				//Audio?
				case 'mp3'  :
				case 'wma'  : 
				case 'wav'  :
								sNewFolderID  = m_sMyFiles_AudioID.split('|')[0];
								sNewFolderName= m_sMyFiles_AudioID.split('|')[1];  
								break;

				//Other?
				case 'exe'  :
				default     : 

								if (m_iCurrentAppIndex == 3)
								{
									sNewFolderName = $( ".LeftPanelDirClick" ).attr('atrdname');
									sNewFolderID  = mBackpackFolderID;
								}
								else
								{
									sNewFolderID  = m_sMyFiles_DesktopID.split('|')[0];
									sNewFolderName= m_sMyFiles_DesktopID.split('|')[1];
								}
								
								sIcon = m_sRessIMGURL + 'mbox_folder.png'
								break;
			}

			sDirName = '&nbsp;<img style="height:16px; width:16px;" src="' + sIcon + '">&nbsp;&nbsp;' + sNewFolderName; 
			$('#' + sFile).attr('atrMoveDir', sNewFolderID);
			$('#' + sFile + "p").hide().html(sDirName).fadeIn(500);
	    			    	
	    
	    }	
	    	
	}


	//:::::::
	//:::::::
	function fnMBoxDoneBtn()
	{
		if (m_bUploaderBusy) 
        {
        	return;
        }
        
        if ( $('#MBoxDoneBtn').attr('saction') == 'done' )
        	fnMagicBoxClose();


		var sGUIDs  = '';
		var iTotal  = 0;
		mMBoxChecks = 0;
		
		for (var j = 0; j < m_AllFilesArr.length; j++)
	    {
	    	sFile = m_AllFilesArr[j].split(m_sTextDelm)[0];
	    	if (sFile == '#null')
	    		continue;
	    	
	    	ObjBox = document.getElementById(("CMBX" + sFile)); 
            if (ObjBox == null)
	            continue;
	            
	        iTotal +=1;
	    	
	    	movedirID = $('#' + sFile).attr('atrmovedir');
	    	if (movedirID.length > 5)
	    	{
	    		sGUIDs += $('#' + sFile).attr('backpackid') + '$$$' + movedirID + '|';
	    		mMBoxChecks +=1;	
	    	}
	    			    	
	    
	    }	    
    
		 $.ajax({
	     type: "GET",
	     url: '../../app/backpack_api.asp',
	     data: "action=movefiles&uidFolderID=MagicBoxMove&FilesID=" + sGUIDs,
	     success: function(data) {
	     
	     		if (mMBoxChecks)
	     		{
		     		if (mMBoxChecks > 1)
		     		{
		     			var sMessage = mcLang.Text('lang_mbox_31',1);
						sMessage = sMessage.replace(/xxxx/gi, mMBoxChecks);
		     			UpdateInboxAlert(sMessage , '');
		     		}
		     		else
		     		{
		     			UpdateInboxAlert(mcLang.Text('lang_mbox_32',1), '');
		     		}
	     			
	     		}
	          
	          	
				//inside backpack? refresh view with new folder
				if (m_iCurrentAppIndex == 3)
				{				
					if(mBackpackFolderID.length)
						fnBackpackGetFolders(mBackpackFolderID);
					else
						fnBackpackGetFolders(msBackPackMainID);

					$('#CallBackpack').checked = false;
				}
				
	
				}
	   		});
	   		

		fnMagicBoxClose()
	}


	//:::::::
	//:::::::
	function fnMBoxGoToMyfilesBtn()
	{
		if (m_bUploaderBusy) 
        {
        	return;
        }
        
        fnMBoxDoneBtn();
		fnApp(3, false);
	}



	//:::::::
	//:::::::	
	function fnMBOXCheckType(sType, cattname )
	{
		var ext = cattname.substr(cattname.lastIndexOf('.') + 1);
		ext = ext.toLowerCase();
		sMatch = false;
		
		switch (sType) 
		{			
			case 'Photos' : 
				  			if ( ext =='jpg' || ext =='png' || ext =='bmp' || ext =='gif' || ext =='jpeg' || ext =='tiff' || ext =='tif')
				  				sMatch  = true; 
							break;

			case 'Videos' : 
				  			if ( ext =='mpeg' || ext =='avi' || ext =='wmv' || ext =='mpg' || ext =='wma' || ext =='mov')
				  				sMatch  = true; 
							break;
							
			case 'Audio' : 
				  			if ( ext =='mp3' || ext =='wav' )
				  				sMatch  = true; 
							break;
							
			case 'Other' : 
				  			if ( ext !='jpg' && ext !='png' && ext !='bmp' && ext !='gif' && ext !='jpeg' && ext !='mpeg' && ext !='avi' && ext !='wmv' && ext !='mpg' && ext !='wma' && ext !='mov' && ext !='mp3' && ext !='wav' && ext !='tiff' && ext !='tif')
								sMatch  = true;
							break;
		}

		return(sMatch);
	
	}


	//:::::::
	//:::::::	
	function MOXCBO(ObjBox, e)
	{
		fnDocOnClick();
 	    var ParentRow = ObjBox.parentNode.parentNode;
        
        if (ObjBox.checked)
            ParentRow.style.backgroundColor = "#cbe8f6";
        else
            ParentRow.style.backgroundColor = "";
            
        YAHOO.util.Event.stopPropagation(e);
        fnShowMBoxActions();
	
	}


	//:::::::
	//:::::::
	function fnShowMBoxActions()
	{
		var iTotalChecks = 0;
		var sDisplay = 'none';
		for (var j = 0; j < m_AllFilesArr.length; j++)
	    {
	    	sFile = m_AllFilesArr[j].split(m_sTextDelm)[0];
	    	if (sFile == '#null')
	    		continue;
	    
		    ObjBox = document.getElementById(("CMBX" + sFile)); 
            if (ObjBox == null)
	            continue;
	            
			if (ObjBox.checked)
			{
				iTotalChecks +=1;
				 //break;
			}
			
			if (m_bUploaderBusy == false)
				ObjBox.disabled = false;
	    }

	    if (iTotalChecks)
	    	sDisplay = '';
	    
	    if ( iTotalChecks == 0 )
			$( "#MBOXCall" ).prop('checked', false);
		else if ( iTotalChecks == m_AllFilesArr.length )
		{
			$( "#MBOXCall" ).prop('checked', true);
		}
		else
			$( "#MBOXCall" ).prop('checked', false);
			
	    
	    	
	    $("#btnMBOXDelte").css( "display", sDisplay);
	    $("#btnMBOXEmail").css( "display", sDisplay);
	    $("#btnMBOXMove").css( "display", sDisplay);
	    
	
	}

	//:::::::
	//:::::::	
	function fnMBoxGetTotalChecks()
	{
		var iTotal = 0;
		for (var j = 0; j < m_AllFilesArr.length; j++)
	    {
	    	sFile = m_AllFilesArr[j].split(m_sTextDelm)[0];
	    	if (sFile == '#null')
	    		continue;
	    	
	    	ObjBox = document.getElementById(("CMBX" + sFile)); 
            if (ObjBox == null)
	            continue;
	            
	    	if (ObjBox.checked)
				iTotal +=1;
	    }
	    return(iTotal);

	}

	
	var mMBoxChecks = 0;
	//:::::::
	//:::::::
	function fnMBoxDelete()
	{
		var sGUIDs  = '';
		var iTotal  = 0;
		mMBoxChecks = 0;
		
		var iTotalChecks = fnMBoxGetTotalChecks();
			
		var sDeleteMsg = 'Are you sure you want to delete this file from your Drive?'; //mcLang.Text('lang_mbox_22',1);
		if (iTotalChecks > 1)
		{
			var sMessage = mcLang.Text('lang_mbox_23',1);
			sMessage = "Are you sure you want to delete _xxTotalFilesxx_ files from your Drive?"
		 	//sMessage = sMessage.toUpperCase();

			sMessage = sMessage.replace(/_xxTotalFilesxx_/gi, iTotalChecks);
			sDeleteMsg = sMessage;
		}
		
		if(confirm(sDeleteMsg))
		{
		
		}
		else 
			return;

		
		for (var j = 0; j < m_AllFilesArr.length; j++)
	    {
	    	sFile = m_AllFilesArr[j].split(m_sTextDelm)[0];
	    	if (sFile == '#null')
	    		continue;
	    	
	    	ObjBox = document.getElementById(("CMBX" + sFile)); 
            if (ObjBox == null)
	            continue;
	            
	        iTotal +=1;
	    	if ( ObjBox.checked && (document.getElementById(sFile).style.display != "none") )
	    	{    
		    	sGUIDs += $('#' + sFile).attr('backpackid') + '|';
		    	mMBoxChecks +=1;
		    	ObjBox.checked = false;
		    	document.getElementById(sFile).style.display = "none";
		    	
		    	m_iTotalQAttachSize -= parseInt(document.getElementById(sFile).getAttribute('asize')) ;
				miSelectedFiles -=1;
				
	    	}
	    
	    }
	    
	    fnUpdateMBoxStatusBar();
	    
	    
	    if (miSelectedFiles < 1 )
	    	fnMagicBoxClose();

	 	
		 $.ajax({
	     type: "GET",
	     url: '../../app/backpack_api.asp',
	     data: "action=deletefiles&FilesID=" + sGUIDs, // appears as $_GET['id'] @ ur backend side
	     success: function(data) {
	     
	     		if (mMBoxChecks > 1)
	     		{
		     		var sMessage = mcLang.Text('lang_mbox_24',1);
					sMessage = sMessage.replace(/xxxx/gi, mMBoxChecks);
		     		UpdateInboxAlert(sMessage , '');    			     		
	     		}
	     		else
	     			UpdateInboxAlert(mcLang.Text('lang_mbox_25',1), '');
	          
	          	
				//inside backpack? refresh view with new folder
				if (m_iCurrentAppIndex == 3)
				{
					if(mBackpackFolderID.length)
						fnBackpackGetFolders(mBackpackFolderID);
					else
						fnBackpackGetFolders(msBackPackMainID);

					$('#CallBackpack').checked = false;
				}
				
	
				}
	   		});
	   		
	   		
	}


	//:::::::
	//:::::::
	function fnMBoxEmail()
	{

		var sGUIDs  = '';
		var iTotal  = 0;

		for (var j = 0; j < m_AllFilesArr.length; j++)
	    {
	    	sFile = m_AllFilesArr[j].split(m_sTextDelm)[0];
	    	if (sFile == '#null')
	    		continue;
	    	
	    	ObjBox = document.getElementById(("CMBX" + sFile)); 
            if (ObjBox == null)
	            continue;
	            
	        iTotal +=1;
	    	if (ObjBox.checked)
	    	{    
		    	sGUIDs += $('#' + sFile).attr('backpackid') + '|';
	    	}
	    
	    }
	    
	    
	    if (iTotal > 0) 
	    {

			 $.ajax({
		     type: "GET",
		     url: '../../app/backpack_RTE_f.asp',
		     data: "action=attachfile&FilesID=" + sGUIDs, // appears as $_GET['id'] @ ur backend side
		     success: function(data) {
		          
		          	fnMagicBoxClose();
					fnBackPack_AttachFileRTE(data, false)
					
				}
		   	 });
	    }

	}
	

	//:::::::
	//:::::::
    function myBubbleSort(arrayName, sSortBy) 
    {
        for (var i=0; i< (arrayName.length - 1); i++)
        {
            for (var j=i+1; j< arrayName.length; j++)
            {
                if (sSortBy == "name")
                {
                    s_Value  = arrayName[j].name.toLowerCase();
                    s_Value2 = arrayName[i].name.toLowerCase();
                }
                else
                {
                    s_Value  = parseFloat(arrayName[j].size);
                    s_Value2 = parseFloat(arrayName[i].size);
                }
                
                if (sSortBy == "sizes" || m_SortBy == "name")
                {
                    if ( s_Value < s_Value2) 
                    {
                        var dummy = arrayName[i];
                        arrayName[i] = arrayName[j];
                        arrayName[j] = dummy;
                    }
                }
                else
              {
                    if ( s_Value2 < s_Value) 
                    {
                        var dummy = arrayName[i];
                        arrayName[i] = arrayName[j];
                        arrayName[j] = dummy;
                    }
               }
            }
        }
    }




//------@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ //


 	
	//:::::::
	//::::::: 
	function fnUpdateDivWidth() {

		return;
		var f_iLargestDIV = 0;
	  	for (var m = 0; m < m_FileDataArr.length; m++) {
	  		iCurrentDiv = document.getElementById(m_FileDataArr[m] + 'ns').offsetWidth;
	  		if (iCurrentDiv > f_iLargestDIV)
	  			f_iLargestDIV = iCurrentDiv;
	  	}
	  	
	   	for (m = 0; m < m_FileDataArr.length; m++) {
	   		YAHOO.util.Dom.setStyle(document.getElementById(m_FileDataArr[m] + 'ns'), 'width', (f_iLargestDIV  + "px"));
	  	}

	}
	  
	
	var mPrevOnMouse = false;
	
	//:::::::
	//:::::::
	function fnPrevImgOff()
	{
		mPrevOnMouse = false;
		document.getElementById('imgdivPrv').style.display = 'none';
	}
	
	//:::::::
	//:::::::
	function fnPrevImg(oObj, bFromMsgPrev)
	{
	
		if (oObj.getAttribute('imgpr').length == 0)
		{
			document.getElementById('imgdivPrv').style.display = 'none';
			document.getElementById('imgPrv').src = m_sRessIMGURL + 'trans.png';
			return;
		}
		
		var sUploadListID = 'mPOPOpt';
		
		if ( mbDropMode)
			sUploadListID = 'divMagicBoxMenu';
		
	
		document.getElementById('imgdivPrv').style.display = 'block';
		
		var arrData  = oObj.getAttribute('imgpr');
		

		arrData  = arrData.split('|'); 


		YAHOO.util.Dom.setStyle('imgdivPrv', 'width', arrData[1] + "px");
		YAHOO.util.Dom.setStyle('imgdivPrv', 'height', arrData[2] + "px");
		
		var stemp = document.getElementById('imgPrv').src;
		if ( stemp.indexOf(arrData[0]) > 0)
		{
			document.getElementById('imgdivPrv').style.display = 'block';
			return;
		}
		
		
		if ( mbDropMode == true)
			document.getElementById("imgPrv").className = "ImgPrevPic";
		else
			document.getElementById("imgPrv").className = "ImgPrevPicRTE";
		
		document.getElementById('imgPrv').src = m_sAttach_PrevURL + arrData[0] + '/prev.jpg';		
		
		var mPOPOpt_Width = parseInt(document.getElementById(sUploadListID).offsetWidth);
		
		var xy = YAHOO.util.Dom.getXY(sUploadListID);
		
		var mPOPOpt_Height = parseInt(arrData[2]);


		if ( (xy[1] + mPOPOpt_Height) > m_ClientHeight )
		{
			xy[1] = (m_ClientHeight - mPOPOpt_Height) - 10;
		}
		else
			xy[1] -= 0;
			
			//fnAddDebug('xy[1]:' + xy[1]);
				
		
		
		//if this for attach in msg-prev, then show it on the other side, else on the right!
		if (bFromMsgPrev)
		{
			xy[0] -= arrData[1];
			xy[0] -= 6;
		}
		else
		{
			
			
			if (mbDropMode)
			{
				xy[0] -= arrData[1];
				xy[0] -= 6;
				xy[1] += 35;

			
			}
			else
				xy[0] += 375; //355;
			 //xy[0] += 165;
		}

	
		YAHOO.util.Dom.setXY('imgdivPrv', xy);	
		
		
		mPrevOnMouse = true;
		
		document.getElementById('imgdivPrv').style.display = 'none';
		//YAHOO.util.Event.stopEvent(e);

	}
/////////////////////////////////////



	//:::::::
	//:::::::
	function fnDrivePrevImgOff()
	{
		mPrevOnMouse = false;
		document.getElementById('imgdivPrv').style.display = 'none';
	}
	
	//:::::::
	//:::::::
	function fnDrivePrevImg(iIndex)
	{
	

		YAHOO.util.Dom.setStyle('imgdivPrv', 'width', 110 + "px");
		YAHOO.util.Dom.setStyle('imgdivPrv', 'height', 70 + "px");
	
		
		if ( mbDropMode == true)
			document.getElementById("imgPrv").className = "ImgPrevPic";
		else
			document.getElementById("imgPrv").className = "ImgPrevPicRTE";
		
		document.getElementById('imgPrv').src = document.getElementById('aprevbx' + iIndex).src;		
		
		
		var xy = YAHOO.util.Dom.getXY('aprevbx' + iIndex);
		
		YAHOO.util.Dom.setXY('imgdivPrv', xy);
		
		document.getElementById('imgdivPrv').style.display = '';
		
		xy[0] -= 150;
		xy[1] -= 20;
		
		YAHOO.util.Dom.setXY('imgdivPrv', xy);	
		
		
		return;
		
		var mPOPOpt_Height = parseInt(70);


		if ( (xy[1] + mPOPOpt_Height) > m_ClientHeight )
		{
			xy[1] = (m_ClientHeight - mPOPOpt_Height) - 10;
		}
		else
			xy[1] -= 0;
			
			//fnAddDebug('xy[1]:' + xy[1]);
				
		
		
		
		
		//if this for attach in msg-prev, then show it on the other side, else on the right!
		if (bFromMsgPrev)
		{
			xy[0] -= arrData[1];
			xy[0] -= 6;
		}
		else
		{
			
			
			if (mbDropMode)
			{
				xy[0] -= arrData[1];
				xy[0] -= 6;
				xy[1] += 35;

			
			}
			else
				xy[0] += 375; //355;
			 //xy[0] += 165;
		}

	
		YAHOO.util.Dom.setXY('imgdivPrv', xy);	
		
		
		mPrevOnMouse = true;
		
		document.getElementById('imgdivPrv').style.display = 'none';
		//YAHOO.util.Event.stopEvent(e);

	}









/////////////////////////////////	









	
	//:::::::
	//:::::::
	function fnShowimg()
	{
		if (mPrevOnMouse)
			document.getElementById('imgdivPrv').style.display = 'block';
		//else
		//	document.getElementById('imgdivPrv').style.display = 'none';
	
	}
	
	
	//:::::::
	//:::::::
	function fnCheckPos()
	{
	
	}
	
	
	
	//:::::::
	//:::::::
	function ShowFileSize(f_iSize)
	{

		sFileSize = "" +  top.formatSizeUnits(f_iSize) + "";
			
		return(sFileSize);
	}
	
	
	//:::::::
	//:::::::
	function ShowAction(f_sID, iAction, sAttachName)
	{
		var sActionLink = "";
		  

		//cancel attach in que
		if (iAction == 1) 
		{
			sActionLink = '&nbsp;<img src="' + m_sRessIMGURL + 'cancel_icon&16.png" onclick="RemoveFile(\'' + f_sID + '\')" title="' + mcLang.Text('lang_mbox_33',1) + '" style="height:16px; width:16px; cursor:pointer"/>';
			sActionLink = "&nbsp;&nbsp;&nbsp;"
		}
		
		if ((iAction == 0) || (iAction == 3))
			sActionLink = '&nbsp;<img src="' + m_sRessIMGURL + 'ajax-loader.gif" width="16px" height="16px" style="height:16px; width:16px"/>';
			
		//if (iAction == 3)
		//	sActionLink = '<span style="color:#919191"><img src="/../mail/ajax-loader.gif" align="absMiddle" style="border:0px; vertical-align:middle; width:16px; height:16px">&nbsp;attaching...</span>';

		//new attach
		if (iAction == 2)
		{
			var cattname = $('#' + f_sID).attr('cattname');
			var ext = cattname.substr(cattname.lastIndexOf('.') + 1);
			ext = ext.toLowerCase();
			var sEditToolAction = ' style="visibility:hidden" ';
			if ( ext =='jpg' || ext =='png' || ext =='bmp' || ext =='gif' || ext =='jpeg' || ext =='tiff' || ext =='tif')
				sEditToolAction  = '  '
			sActionLink = '&nbsp;<img src="' + m_sRessIMGURL + 'magic_wand_2_icon&16.png" ' + sEditToolAction + ' onclick="EditUploadPic(\'' + f_sID + '\', \'new\')" title="' + mcLang.Text('lang_mbox_19',1) + '" style="height:16px; width:16px; cursor:pointer"/>&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" onclick="DeleteForwardFile(\'' + f_sID + '\')" title="' + mcLang.Text('lang_mail_22',1) + '" style="height:16px; width:16px; cursor:pointer"/>';
		
			//For backpack?
			//if (msUploaderApp == 'backpack')
			//	sActionLink = '';
		
		}
		
		//forward attach	
		if (iAction == 4)
			//sActionLink = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" onclick="DeleteForwardFile(\'' + f_sID + '\')" title="Delete file" style="height:16px; width:16px; cursor:pointer"/>';
		{
			var cattname = sAttachName;
			var ext = cattname.substr(cattname.lastIndexOf('.') + 1);
			ext = ext.toLowerCase();
			var sEditToolAction = ' style="visibility:hidden" ';
			if ( ext =='jpg' || ext =='png' || ext =='bmp' || ext =='gif' || ext =='jpeg' || ext =='tiff' || ext =='tif')
				sEditToolAction  = '  '
			sActionLink = '&nbsp;<img src="' + m_sRessIMGURL + 'magic_wand_2_icon&16.png" ' + sEditToolAction + ' onclick="EditUploadPic(\'' + f_sID + '\', \'forward\')" title="' + mcLang.Text('lang_mbox_34',1) + '" style="height:16px; width:16px; cursor:pointer"/>&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" onclick="DeleteForwardFile(\'' + f_sID + '\')" title="Delete file" style="height:16px; width:16px; cursor:pointer"/>';
		
		}



		return(sActionLink);
	}
	
	
	//:::::::
	//:::::::
	function ShowFileIcon(f_sFileName, bturncate, sID)
	{	
		var m_sAttachShareImgURL = m_sRessIMGURL + 'file_type/';
		var m_sIcon = '';
		var ext = f_sFileName.substr(f_sFileName.lastIndexOf('.') + 1);
		ext = ext.toLowerCase();
		
		var sDefaultIco = '1371517465_url.png';
		
		switch (ext) 
		{			
			case 'xlsx' : m_sIcon = 'xlsx.png';   break;		
			case 'docx' :
			case 'doc' 	: m_sIcon = 'docx.png';   break;
			case 'ppt' 	: m_sIcon = 'pptx.png';   break;
			case 'pptx' : m_sIcon = 'pptx.png';   break;
			case 'pot' 	: m_sIcon = '1371517236_pptx_win.png';  break;
			case 'jpg' 	:
			case 'tiff' :
			case 'tif'  :
			case 'png' 	:
			case 'bmp' 	:
			case 'gif' 	:
			case 'jpeg'	: m_sIcon = '1371518115_jpeg.png';   break;
			case 'html'	:
			case 'htm' 	: m_sIcon = '1371514444_url.png';  break;
			case 'psd' 	: m_sIcon = '1371518192_psd.png';    break;
			case 'pdf' 	: m_sIcon = '1371517166_pdf.png';   break;
			case 'txt' 	: m_sIcon = '1371517247_readme.png';   break;
			case 'mdb' 	: m_sIcon = sDefaultIco;   break;
			case 'zip' 	: m_sIcon = '1371517792_zip.png';   break;
			case 'exe' 	: m_sIcon = sDefaultIco;   break;
			case 'mp3' 	: m_sIcon = '1371517344_mp.png'; break;
			case 'mpeg'	: 
			case 'avi' 	: 
			case 'wav' 	:
			case 'wmv' 	:
			case 'mp4' 	:
			case 'mpg' 	:
			case 'wma' 	: m_sIcon = '1371517300_avi.png'; break;
			case 'mov' 	: m_sIcon = '1371517300_avi.png';   break;
			case 'eml' 	: m_sIcon = '1371517176_pst.png';  break;
			case 'vcf' 	: m_sIcon = sDefaultIco;    break;
			case 'accdb': m_sIcon = 'accdb.png';  break
			case 'pub' 	: m_sIcon = 'pub.png';  break
			case 'vsd' 	: m_sIcon = 'vsd.png';  break
			default    	: m_sIcon = sDefaultIco;

			
		}
		
		if (bturncate)
		{
		if (f_sFileName.length > bturncate)
			f_sFileName = f_sFileName.substr(0, bturncate) + '...';
		}
		
		var sImgID = '';
		
		
		if ( sID != null)
			sImgID = ' id="MboxP' + sID + '" ';
			

		return('<img src="' + m_sAttachShareImgURL + m_sIcon + '" ' + sImgID + ' align="absMiddle" style="border:0px; vertical-align:middle;" width="20"  height="20">&nbsp;&nbsp;' + f_sFileName);
	}
	

	
	//:::::::
	//:::::::
	function RemoveFile(f_sID)
	{
		document.getElementById(f_sID).style.display = "none";
		m_iTotalQAttachSize -= parseInt(document.getElementById(f_sID).getAttribute('asize')) ;
		m_iTotalQAttach -=1;
		fnShowAttachCount();
		
		//remove ID from array
	  	RemoveFromArr(f_sID);
	  	
	  	uploader.removeFile(f_sID);
	}
	
	
	//:::::::
	//:::::::
	function CancelFile(f_sID)
	{
		uploader.cancel();
		m_iTotalQAttach -=1;
		fnShowAttachCount();
		//uploader.removeFile(f_sID);
	}
	
	
	//:::::::
	//:::::::
	function DeleteFile(f_sID)
	{
		document.getElementById(f_sID).style.display = "none";
		for (var j = 0; j < m_AllFilesArr.length; j++) {
	         sFile = m_AllFilesArr[j];
	         if (sFile.indexOf(f_sID) == 0)
	         {
	             m_AllFilesArr[j] = '';
	             break;
	         }
	    }
		m_iTotalQAttach -=1;
		fnShowAttachCount();

	}

	var m_sEditToolMode = 'msgprev';
	var m_sEditToolPicURL = '';
	var m_sEditToolAction = 'new';

	//:::::::
	//:::::::	
	function EditUploadPic(f_sID, sAction)
	{
	
		var arrData = $('#' + f_sID).attr('imgpr');
		arrData  = arrData.split('|');
		
		//alert(arrData[0])
		
		var cattname = $('#' + f_sID).attr('cattname');
		//alert(cattname)
		
		m_sEditToolMode = 'composer';
		
		m_sEditToolAction = sAction;
		
		m_sEditToolPicURL = arrData[0] + '||DirGuid||' + sAction + '||DirGuid||' + cattname;
	
		fnGetAttachForEdit(m_sEditToolPicURL);
		
		//DeleteForwardFile(f_sID);
	}
	
	function fnUpdateComposerAttachPic(newPicURL)
	{
		
		var obj_callback = new clsAjaxcallback(); 
		obj_callback.Ajaxcallback.success = fAXAttachEditUpdate;
		var sURL = '../../app/download_url.asp?sURL=' + escape(newPicURL) + "&UpdatePicURL=" + m_sEditToolPicURL;
		makeRequest(sURL, obj_callback.Ajaxcallback);
	
	}
	
	//:::::::
	//:::::::
	function fAXAttachEditUpdate(o)
	{
		//fnAddDebug();
		var f_sServerData = o.responseText;
		//alert(f_sServerData)
		document.getElementById('imgPrv').src = m_sAttach_PrevURL + f_sServerData + '/prev.jpg';
		
		UpdateInboxAlert('Updated picture', '1359077142_info_16.png');

		
	}

	//:::::::::::
	//:::::::::::	
	function fnUpdateMBoxStatusBar()
	{
		var sMessage = '';
		if (miSelectedFiles > 1)
		{
			sMessage = mcLang.Text('lang_mbox_13',1);
			sMessage = sMessage.replace(/xxxx/gi, miSelectedFiles);
			sMessage = sMessage.replace(/_xxsizexx_/gi, ShowFileSize(m_iTotalQAttachSize));
		    UpdateInboxAlert(sMessage , '');
			$('#MBoxTitle').hide().html(sMessage).fadeIn(500);
		
		}
		else
		{
			sMessage = mcLang.Text('lang_mbox_12',1);
			sMessage = sMessage.replace(/xxxx/gi, ShowFileSize(m_iTotalQAttachSize));
			$('#MBoxTitle').hide().html(sMessage).fadeIn(500);
			
		}
	}

	//:::::::
	//:::::::
	function DeleteForwardFile(f_sID)
	{
		//top.fnRTEUpdate();
	
		for (var j = 0; j < m_AllFilesArr.length; j++) {
	         sFile = m_AllFilesArr[j];
	         if (sFile.indexOf(f_sID) == 0)
	         {
	         	if (mbDropMode )
	         	{
	         	
	         		var sDeleteMsg = mcLang.Text('lang_mbox_22',1);
					if(confirm(sDeleteMsg))
					{
						m_AllFilesArr[j] = '#' + document.getElementById(f_sID).getAttribute('fFIndex');
		             	m_iTotalQAttachSize -= parseInt(document.getElementById(f_sID).getAttribute('asize')) ;
		             	document.getElementById('CMBX' + f_sID).checked = false;
		             	
		             	sGUIDs = $('#' + f_sID).attr('backpackid') + '|';
		             	
		             	$( "#" + f_sID ).remove();
		             	
		             	$.ajax({
					     type: "GET",
					     url: '../../app/backpack_api.asp',
					     data: "action=deletefiles&FilesID=" + sGUIDs, // appears as $_GET['id'] @ ur backend side
					     success: function(data) {
	
								miSelectedFiles -=1;
								
								
								if (miSelectedFiles < 1 )
	    							fnMagicBoxClose();
								
								fnUpdateMBoxStatusBar();
					     		UpdateInboxAlert(mcLang.Text('lang_mbox_25',1), '');
								//inside backpack? refresh view with new folder
								if (m_iCurrentAppIndex == 3)
								{
									if(mBackpackFolderID.length)
										fnBackpackGetFolders(mBackpackFolderID);
									else
										fnBackpackGetFolders(msBackPackMainID);

									$('#CallBackpack').checked = false;
								}
								
								}
					   	});

					}
					else 
						return;
						
	         	}
	         	else
	         	{
		             m_iTotalQAttachSize -= parseInt(document.getElementById(f_sID).getAttribute('asize')) ;
		             m_AllFilesArr[j] = '';
		             $( "#" + f_sID ).remove();
	            }
	             
	             break;
	         }
	    }

		m_iTotalQAttach -=1;
		fnShowAttachCount();
	}
	
	
	//:::::::
	//:::::::
	function  RemoveFromArr(f_sID)
	{
		//remove ID from array
		for (var j = 0; j < m_FileDataArr.length; j++) {
	    	if (m_FileDataArr[j] == f_sID)
	    	{
	    		m_FileDataArr.splice(j,1);
	    		fnShowAttachCount();
	    		break;
	    	}
	  	}

	  	fnShowAttachCount();
	} 


	//:::::::
	//:::::::	
	function ForwardAttach(f_iIndex, f_sName, f_Size, f_sIcon, f_sFolderID)
	{	
		///////////////////
		//alert('m_iTotalQAttach:' + m_iTotalQAttach + '\n' + 'm_iTotalQAttachSize:' + m_iTotalQAttachSize + '\n')
		//////////////
	
	    f_iIndex +=1;	
		var f_iID = 'fAtt' + f_iIndex;
		var iAttachSize = 0;
		
		if (f_Size.length <=1 )
			iAttachSiz = 1023;
		else
			iAttachSiz = parseInt(f_Size) * 1023;
		
		m_iTotalQAttachSize += iAttachSiz;
			
		sProgress = "<div style='height:16px;width:100px;background: url(" + m_sRessIMGURL + "/attach/bar_white.gif); color:#535353; text-align: center;'>0%</div>";
		sSize = ShowFileSize(iAttachSiz);
		sName = ShowFileIcon(f_sName,0);
		sAction = ShowAction(f_iID, 4, f_sName);
		
	    m_AllFilesArr.push( f_iID + m_sTextDelm + f_sFolderID );
		
		fnGetForwardAttachThumb(f_sName, f_iID )
		
		   
		var f_sHTMLCode = '<div id="' +  f_iID + '" fFIndex=' + f_iIndex + ' imgpr="" asize="' + iAttachSiz + '" cattname="' + escape(f_sName) + '" onmouseout="fnPrevImgOff()" onmouseover="fnPrevImg(this,false)" style="cursor:default; clear: both; height:27px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px;">' +
				 		  '<div class="UploadFile" id="' +  f_iID + 'ns" style="float:left; width:310px; line-height:24px;"><div style="float:left; width:40px; line-height:24px; text-align:right">' + sSize + '</div>&nbsp;&nbsp;' + sName + '</div>' +
						  '<div style="float:right; width:45px; line-height:22px;" id="' +  f_iID + 'a">' + sAction + '</div>' +
						  '</div>';
		   				   
	  m_iTotalQAttach +=1;
	  document.getElementById("mAttahcMenu").innerHTML += f_sHTMLCode; 
	  
	  fnShowAttachCount();
	  
	}


	//:::::::
	//:::::::	
	function fnGetForwardAttachThumb(sFileName, sf_iID )
	{
		var ext = sFileName.substr(sFileName.lastIndexOf('.') + 1);
		ext = ext.toLowerCase();
		if ( ext =='jpg' || ext =='png' || ext =='bmp' || ext =='gif' || ext =='jpeg' || ext =='tiff' || ext =='tif')
		{
			var obj_callback = new clsAjaxcallback(); 
			obj_callback.Ajaxcallback.success = fAXForwardAttachThumb;
			var sURL = '../../app/mAttach_api.asp?attach_id=' + sf_iID + '&FileName=' + escape(sFileName);
			makeRequest(sURL, obj_callback.Ajaxcallback);
		}
	}
	
	
	//:::::::
	//:::::::
	function fAXForwardAttachThumb(o)
	{
		//fnAddDebug();
		
		var f_sServerData = o.responseText;
 		var arrData  = f_sServerData.split('|');

		if (arrData.length == 4)
			document.getElementById(arrData[3]).setAttribute("imgpr", f_sServerData);
		else
			document.getElementById(arrData[3]).setAttribute("imgpr", '');
	}
	
	
	//:::::::
	//::::::: For aviary.com web edit tool	 :::::::::::::::::::::::::::::::::
	function fnGetAttachForEdit(sFileName)
	{
		var ext = sFileName.substr(sFileName.lastIndexOf('.') + 1);
		ext = ext.toLowerCase();
		if ( ext =='jpg' || ext =='png' || ext =='bmp' || ext =='gif' || ext =='jpeg' || ext =='tiff' || ext =='tif')
		{
			var obj_callback = new clsAjaxcallback(); 
			obj_callback.Ajaxcallback.success = fAXAttachEdit;
			var sURL = '../../app/mAttach_api.asp?attach_id=xxx&attach_mode=full&FileName=' + escape(sFileName);
			
			//fnAddDebug(sFileName)
			
			makeRequest(sURL, obj_callback.Ajaxcallback);
		}
	}
	
	//:::::::
	//:::::::
	function fAXAttachEdit(o)
	{
		//fnAddDebug();
		
		var f_sServerData = o.responseText;
 		var arrData  = f_sServerData.split('|');

		if (arrData.length == 4)
		{
			//alert(arrData[0]);
			document.getElementById('image1_aviary').src = m_sAttach_PrevURL + arrData[0] + '/prev.jpg';
			launchEditor('image1_aviary', m_sAttach_PrevURL + arrData[0] + '/prev.jpg');
			
		}
		
	}
	
	
	function fnOpenEditTool(sFileName)
	{
		m_sEditToolMode = 'msgprev'; 
		fnGetAttachForEdit(sFileName);
	}
	
	   function launchEditor(id, src) {
	   	   
	       featherEditor.launch({
	           image: id,
	           url: src
	       });
	       
	      return false;
	   }




	//::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
	
	
	//:::::::
	//:::::::
	function ResetAttach()
	{
		//if QuickReply is switching to full composer, then we don't want to reset the attachemtns...
		if (mQuickRTEKeepAttach)
		{
			return;
		}
		
		if (m_iTotalQAttach  >= 1)
	    {
	    	if (uploadDone == false)
	    	{
	    		if (uploader.queue != null)
	    		{
					uploader.queue.cancelUpload();
					uploader.queue.set("fileList", []);
					uploader.set("fileList", []);
					uploader.set("enabled", true);
					fileList = [];
					uploadDone = true;
					bUploaderCanceled = true;
				}

			}
	    	////////////////
	    	
	    }

    	m_AllFilesArr = [];
    	m_FileDataArr = [];

	    m_AllFilesArr.length = 0; 
	    m_FileDataArr.length = 0;
	    document.getElementById("mAttahcMenu").innerHTML = '';
	    
	   
	    document.getElementById("AttachBusy").style.visibility = 'hidden'
	    document.getElementById('AllFiles').value = '';
	    document.getElementById('FolderIDs').value = '';
		m_bUploaderBusy = false;
		m_iTotalQAttach = 0;
		m_iTotalQAttachSize = 0;
		
		fnShowAttachCount();
		
		//for shared files
		m_iTotalDropbox = 0;
		m_iDropboxAttach = 0;
		//
		m_iTotalGdrive = 0;
		m_iGdriveAttach = 0;
		//
		m_iTotalSkydrive = 0;
		m_iSkydriveAttach = 0;
		//
		m_iTotalYoutubeGdrive =0;
		m_iYoutubeGdriveAttach =0;
		//
		m_iTotalMapsGdrive =0;
		m_iMapsGdriveAttach =0;
		//
		m_iTotalInstagram =0;
		m_iInstagramAttach =0;
		//
		m_iTotalTumblr =0;
		m_iTumblrAttach =0;
		//
		m_iTotalBox =0;
		m_iBoxAttach =0;
		//
		m_iTotalFacebook =0;
		m_iFacebookAttach =0;
		//
		m_iTotalTwitter =0;
		m_iTwitterAttach =0;
		//
		m_iTotalAmazon =0;
		m_iAmazonAttach =0;
		//
		m_iTotalflickr =0;
		m_iflickrAttach =0;

		
	}
	
	
	//:::::::
	//:::::::
	function fnGetUploadedAttach()
	{
	    document.getElementById('FolderIDs').value = '';
	    document.getElementById('AllFiles').value = '';
	    var f_sRemoveList = "";
	    
	    for (var j = 0; j < m_AllFilesArr.length; j++) {
	    	var f_FileItem = m_AllFilesArr[j];
	    	if (f_FileItem.length > 0)
	    	{
	    		document.getElementById('FolderIDs').value += '|' + f_FileItem.split(m_sTextDelm)[1];
	    	}	
	  	}
	  	
        //alert('FolderIDs:\n' +  document.getElementById('FolderIDs').value);
        //alert('AllFiles:\n' +  document.getElementById('AllFiles').value); 
	}
	
	

//::::::::::::::::::::::::::::: NONE Attach

	
	
	//:::::::
	//:::::::
	function fnUploadAttach()
	{
	
		if (document.getElementById('AttachAction').value == "upload")
		{
			alert('Please wait until the upload has finished.');
			return;
		}
	
		if (document.getElementById('UploadedFile').value =='')
			{return;}
		
		////////////	
		m_iTotalAttachNoneFlash +=1;	
		f_iIndex = m_iTotalAttachNoneFlash;
		var f_iID = 'file' + f_iIndex + 1;
		
		sProgress = "";
		sSize = '';
		sName = '';
		sAction = '';
		
		f_sHTMLCode  = '<div id="' + f_iID + '" fFIndex=' + f_iIndex + ' style="clear: both; height:27px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; ">' +
		 			   '<div class="UploadFile" id="' + f_iID + 'ns" style="float:left; line-height:24px;">&nbsp;<img src="" + m_sRessIMGURL + "attach/ajax-loader.gif" width="16px" height="16px" align="absMiddle" style="border:0px; vertical-align:middle;" width="16"  height="16">&nbsp;' + mcLang.Text('lang_mbox_35',1) + '&nbsp;&nbsp;&nbsp;&nbsp;</div>' +
					   '</div>';
					   				   

	  	document.getElementById("mAttahcMenu").innerHTML += f_sHTMLCode; 
		////////////
		
		
		document.getElementById('AttachAction').value = "upload";
		document.attach.encoding  = "multipart/form-data";
		document.attach.submit();
	}
	
	
	//:::::::
	//:::::::
	function fnShowAttFile(v_sFileID, f_sName, f_Size, v_sIcon)
	{
		f_iIndex = m_iTotalAttachNoneFlash;
		var f_iID = 'file' + f_iIndex + 1;
		
		if (f_Size.length <=1 )
			f_Size = '1023';
		else
			f_Size = parseInt(f_Size) * 1023;
		
		sProgress = "";
		sSize = ShowFileSize(f_Size);
		sName = ShowFileIcon(f_sName,0,'');
		sAction = ShowAction(f_iID, 2, '');
		
	    m_AllFilesArr.push( f_iID + m_sTextDelm + v_sFileID );
		 
		f_sHTMLCode  = '<div class="UploadFile" id="' + f_iID + 'ns" style="float:left; line-height:24px;" >&nbsp;' + sName + '&nbsp;&nbsp;(' + sSize + ')&nbsp;&nbsp;</div>' +
					   '<div style="float:left; width:150px; line-height:24px;" id="' + f_iID + 'a">' + sAction + '</div>';
					   				   
	  document.getElementById(f_iID).innerHTML = f_sHTMLCode; 
	  document.getElementById('AttachAction').value = "";	
	}
	
	//:::::::::::::::::::::::::::::NONE Attach

	
	var m_iTotalDropbox = 0;
	var m_iDropboxAttach = 0;
	var m_iTotalGdrive = 0;
	var m_iGdriveAttach = 0;
	var m_iTotalSkydrive = 0;
	var m_iSkydriveAttach = 0;
	var m_iTotalYoutubeGdrive =0;
	var m_iYoutubeGdriveAttach =0;
	//
	var m_iTotalMapsGdrive =0;
	var m_iMapsGdriveAttach =0;
	//
	var m_iTotalInstagram =0;
	var m_iInstagramAttach =0;
	
	var m_iTotalTumblr =0;
	var m_iTumblrAttach =0;
	
	var m_iTotalDriveLinks = 0;
	
	var m_iTotalFacebook =0;
	var m_iFacebookAttach =0;
	
	var m_iTotalTwitter =0;
	var m_iTwitterAttach =0;
	
	var m_sAttachShareImgURL = 'http' + m_sHTTPS + '://' + sServerName;
	
	
	 
	function fnOpenDropBox()
	{
	
		options = {
		      linkType: "preview",
		                    // "preview" (default) is a preview link to the document for sharing,
		                    // "direct" is an expiring link to download the contents of the file
		                    // For more information about link types, see Link types
		      success: function(files) {
		                    // Required. Called when a user selects an item in the Chooser  
		                    
		                       
		                       sURL = files[0].link;
		                       sName = files[0].name
		                       
		                       
		                       	var sShareID = 'S' + guid();
		                    											
								sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveSharedPic(\'' + sShareID + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle;"/>';
														
								sName = sName.split('/');
								sName = sName[sName.length - 1]
											
								sDropBoxHTML= '<div ondragstart="return false;" contenteditable="false" id="' + sShareID + '" style="cursor:pointer; clear: both; height:54px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px; margin-top:8px; width:326px">' +
											  '<a class="UploadFile" id="' +  sShareID + 'ns"  href="' + sURL + '" Xonclick="window.open(\'' + sURL + '\', \'Dropbox\', \'width=1050,height=850\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>' +
											  '<img src="' + m_sRessIMGURL + 'dropbox.png"  style="vertical-align: middle; height:20px; width:22px;">&nbsp;<b>Dropbox</b> ' + m_sSharedFiles + ':<br>&nbsp;&nbsp;' + ShowFileIcon(sName,30,'') + '</a>' +
											  '<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalTumblr + 'a" class="rteSharedFiles">' + sAction + '</div>' +
											  '</div>';
							
								fnUpdateRTEText( fnGetRTEText() + sDropBoxHTML );
								fnRTEDisableSelect('#' + sShareID);	

		                       
		                    
		                },
		      cancel:  function() {
		                    // Called when the user closes the dialog
		                    // without selecting a file and does not include any parameters.
		                }
		    };
	 
	
		Dropbox.choose(options); 
	}
	
	
	
	function fOpenDropbox(sURL)
	{
		window.open(sURL, "Dropbox", "width=500,height=500");
		
		//$("#somediv").load(sURL).dialog({modal:true});
	
	}
	
	
	function fnAddDropBox(sURL, sName)
	{
                       
		var sShareID = 'S' + guid();
			                    											
		sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveSharedPic(\'' + sShareID + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle;"/>';
															
		sName = sName.split('/');
		sName = sName[sName.length - 1]
												
		sDropBoxHTML= 	'<div ondragstart="return false;" contenteditable="false" id="' + sShareID + '" style="cursor:pointer; clear: both; height:54px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px; margin-top:8px; width:326px">' +
						'<a class="UploadFile" id="' +  sShareID + 'ns"  href="' + sURL + '" Xonclick="window.open(\'' + sURL + '\', \'Dropbox\', \'width=1050,height=850\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>' +
						'<img src="' + m_sRessIMGURL + 'dropbox.png"  style="vertical-align: middle; height:20px; width:22px;">&nbsp;<b>Dropbox</b> ' + m_sSharedFiles + ':<br>&nbsp;&nbsp;' + ShowFileIcon(sName,30,'') + '</a>' +
						'<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalTumblr + 'a" class="rteSharedFiles">' + sAction + '</div>' +
						'</div>';
							
		fnUpdateRTEText( fnGetRTEText() + sDropBoxHTML );
		fnRTEDisableSelect('#' + sShareID);	

	}

	
	////////////////////////////////////////////
	
	function lookdeep(obj){
	    var A= [], tem;
	    for(var p in obj){
	    	if(obj.hasOwnProperty(p)){
	    		tem= obj[p];
	    		if(tem && typeof tem=='object'){
	    			A[A.length]= p+':{ '+arguments.callee(tem).join(', ')+'}';
	    		}
	    		else A[A.length]= [p+':'+tem.toString()];
	    	}
	    }
	    return A;
	}
	
	
	function openFromSkyDrive() {
	    WL.fileDialog({
	        mode: 'open',
	        select: 'single'
	    }).then(
	        function(response) {
	
			   //var s=lookdeep(response).join('\n');
			   //fnAddDebug(s);
	       
	            //fnAddDebug("The following file is being downloaded:");
	            //fnAddDebug("");
	
	            var files = response.data.files;
	            if (files.length > 0) {
	                var file = files[0];
	                
	               //fnAddDebug(file.name);
	                //fnAddDebug(file.id);
	                //fnAddDebug(file.link);
	               
	                //WL.download({ "path": file.id + "/content" });
	               
	                
					var sShareID = 'S' + guid();
					                    											
					sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveSharedPic(\'' + sShareID + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle;"/>';
											
					sName = file.name
								
					sDropBoxHTML= '<div ondragstart="return false;" contenteditable="false" id="' + sShareID + '" style="cursor:pointer; clear: both; height:54px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px; margin-top:8px; width:326px">' +
								  '<a class="UploadFile" id="' +  sShareID + 'ns"  href="' + file.link + '" Xonclick="window.open(\'' + file.link + '\', \'Dropbox\', \'width=954,height=500\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>' +
								  '<img src="' + m_sRessIMGURL + 'skydrive.png"  style="height:17px; width:27px;">&nbsp;<b>SkyDrive</b> ' + m_sSharedFiles + ':<br>&nbsp;&nbsp;' + ShowFileIcon(sName,30,'') + '</a>' +
								  '<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalTumblr + 'a" class="rteSharedFiles">' + sAction + '</div>' +
								  '</div>';
				
					fnUpdateRTEText( fnGetRTEText() + sDropBoxHTML );
					fnRTEDisableSelect('#' + sShareID);	

		              
		              
	 
	            }
	        },
	        function(errorResponse) {
	            //fnAddDebug("WL.fileDialog errorResponse = " + JSON.stringify(errorResponse));
	        }
	    );
	}
	                    
	
	function  fnAddSkyDrive(name, id, link)
	{					
	
	var sShareID = 'S' + guid();
					                    											
					sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveSharedPic(\'' + sShareID + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle;"/>';
											
					sName = name;								
					sDropBoxHTML= '<div ondragstart="return false;" contenteditable="false" id="' + sShareID + '" style="cursor:pointer; clear: both; height:54px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px; margin-top:8px; width:326px">' +
								  '<a class="UploadFile" id="' +  sShareID + 'ns"  href="' + link + '" Xonclick="window.open(\'' + link + '\', \'Dropbox\', \'width=954,height=500\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>' +
								  '<img src="' + m_sRessIMGURL + 'skydrive.png"  style="height:17px; width:27px;">&nbsp;<b>SkyDrive</b> ' + m_sSharedFiles + ':<br>&nbsp;&nbsp;' + ShowFileIcon(sName,30,'') + '</a>' +
								  '<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalTumblr + 'a" class="rteSharedFiles">' + sAction + '</div>' +
								  '</div>';
				
					fnUpdateRTEText( fnGetRTEText() + sDropBoxHTML );
					fnRTEDisableSelect('#' + sShareID);	

	
	}
	
	//:::::::::::::::::::::::::::::
	
	function fnOpenSkyDrive()
	{
		sREdirectURL = 'http' + m_sHTTPS + '://' + sServerName + '/'
		WL.init({ client_id: m_sSkyDriveClientId, redirect_uri: sREdirectURL  });
	
		WL.login({ "scope": "wl.skydrive wl.signin" }).then(
		    function(response) { 
		        openFromSkyDrive();
		    },
		    function(response) {
		        //fnAddDebug("Failed to authenticate.");
		    }
		);
	
	
	}
	
	//:::::::::::::::::::::::::::::

      // The API developer key obtained from the Google Developers Console.
      var developerKey = m_sGoogledeveloperKey;

      // The Client ID obtained from the Google Developers Console.
      var clientId = m_sGoogleClientId;

      // Scope to use to access user's photos.
      var scope = ['https://www.googleapis.com/auth/photos', 'https://www.googleapis.com/auth/drive.file', 'https://gdata.youtube.com'];

      var pickerApiLoaded = false;
      var oauthToken;

      function onAuthApiLoad() {
        window.gapi.auth.authorize(
            {
              'client_id': clientId,
              'scope': scope,
              'immediate': false
            },
            handleAuthResult);
      }

      function onPickerApiLoad() {
        pickerApiLoaded = true;
        createPicker();
      }

      function handleAuthResult(authResult) {
        if (authResult && !authResult.error) {
          oauthToken = authResult.access_token;
          createPicker();
        }
      }

	var  m_sGoogleApp = 'youtube';
	function fnOpenGoogleDrive(sApp)
	{
	    // Use the Google Loader script to load the google.picker script.
	    //google.setOnLoadCallback(createPicker);
	    //google.load('picker', '1');

		m_sGoogleApp = sApp;
	    gapi.load('auth', {'callback': onAuthApiLoad});
	    gapi.load('picker', {'callback': onPickerApiLoad});
	
	
	}
	
	/*
	              .addView(google.picker.ViewId.DOCS)
	 
	              .addView(google.picker.ViewId.DOCS_IMAGES)
	 
	              .addView(google.picker.ViewId.DOCS_IMAGES_AND_VIDEOS)
	 
	              .addView(google.picker.ViewId.DOCS_VIDEOS)
	 
	              .addView(google.picker.ViewId.DOCUMENTS)
	 
	              .addView(google.picker.ViewId.FOLDERS)
	 
	              .addView(google.picker.ViewId.FORMS)
	 
	              .addView(google.picker.ViewId.IMAGE_SEARCH)
	 
	              .addView(google.picker.ViewId.PDFS)
	 
	              .addView(google.picker.ViewId.PHOTO_ALBUMS)
	 
	              .addView(google.picker.ViewId.PHOTO_UPLOAD)
	 
	              .addView(google.picker.ViewId.PHOTOS)
	 
	              .addView(google.picker.ViewId.PRESENTATIONS)
	 
	              .addView(google.picker.ViewId.RECENTLY_PICKED)
	 
	              .addView(google.picker.ViewId.SPREADSHEETS)
	 
	              .addView(google.picker.ViewId.VIDEO_SEARCH)
	 
	              .addView(google.picker.ViewId.WEBCAM)
	 
	              .addView(google.picker.ViewId.YOUTUBE) 
	              
	              
	*/
	
      // Create and render a Picker object for picking user Photos.
      function createPicker() {
        if (pickerApiLoaded && oauthToken) {
        
          	var picker = new google.picker.PickerBuilder();
          	
		    	switch (m_sGoogleApp) 
		        {
		            case 'drive':   

							picker.addView(google.picker.ViewId.DOCS);
			             	picker.addView(google.picker.ViewId.YOUTUBE);
			             	picker.addView(google.picker.ViewId.VIDEO_SEARCH);
			             	picker.addView(google.picker.ViewId.PHOTOS);
				            picker.addView(google.picker.ViewId.MAPS);
				            break;
		    				    
		            case 'youtube':   

			             	picker.addView(google.picker.ViewId.YOUTUBE);
			             	picker.addView(google.picker.ViewId.VIDEO_SEARCH);
			             	picker.addView(google.picker.ViewId.PHOTOS);
				        	picker.addView(google.picker.ViewId.DOCS);
				            picker.addView(google.picker.ViewId.MAPS);
						    break;
						        
		            case 'maps':   

							picker.addView(google.picker.ViewId.MAPS); 
			             	picker.addView(google.picker.ViewId.YOUTUBE);
			             	picker.addView(google.picker.ViewId.VIDEO_SEARCH);
			             	picker.addView(google.picker.ViewId.PHOTOS);
				        	picker.addView(google.picker.ViewId.DOCS);
				            
						    break;
		
		        }


	          	picker.setOAuthToken(oauthToken);
              	//picker.setDeveloperKey(developerKey);
              	picker.setCallback(pickerCallback);
          		picker.build().setVisible(true);
        }
      }
	
	

	
	// A simple callback implementation.
	function pickerCallback(data) {
	      	var url = 'nothing';
		      if (data[google.picker.Response.ACTION] == google.picker.Action.PICKED) {
		        var doc = data[google.picker.Response.DOCUMENTS][0];
		        URL= doc[google.picker.Document.URL];
		        NAME = doc[google.picker.Document.NAME];
		        MIME_TYPE = doc[google.picker.Document.MIME_TYPE];
		        TYPE = doc[google.picker.Document.TYPE];
		        ICON_URL = doc[google.picker.Document.ICON_URL];
		     
			   //var s=lookdeep(doc).join('\n');
			   //fnAddDebug(s);
			   
			
			   
				   if ( (doc.serviceId == 'youtube') || ( (doc.serviceId == 'search-api') && (doc.type == 'video') ) )
				   {
				   	      	        m_iTotalYoutubeGdrive +=1;
			                    	m_iYoutubeGdriveAttach +=1;
			                    	
			                    	if ( fnRTEElementExists('#divYoutubeGDrive') == 0 )
			                    	{
			                       		fnUpdateRTEText( fnGetRTEText() + '<div id="divYoutubeGDrive" style="color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11.5px;"><br>&nbsp;&nbsp;<img src="' + m_sAttachShareImgURL + '/app/ress/theme/V12/IMG/youtube_small_20.png"  style="vertical-align: middle; height:20px; width:55px;">&nbsp; ' + m_sSharedVideos + ':<div id="divYoutubeGDriveFiles" style="padding:5px; width:326px"></div></div>' );
			                    		fnRTEDisableSelect('#divYoutubeGDrive');
			                    	}
													
									sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveYoutubeGDrive(\'' + m_iTotalYoutubeGdrive + '\')" title="' + mcLang.Text('lang_rte_71',1) + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle"/>';
									
									if (NAME.length > 30)
										f_sFileName = NAME.substr(0, 30) + '...';
									else
										f_sFileName = NAME
				
									sicon = '<img src="' + doc.thumbnails['0'].url + '" align="absMiddle" style="border:0px; vertical-align:middle;" width="120"  height="90">&nbsp;&nbsp;' + f_sFileName;
	
									URL = 'http://www.youtube.com/watch?v=' + doc.id;
						
									sDropBoxHTML= '<div contenteditable="false" id="att_Youtubegdrive' + m_iTotalYoutubeGdrive + '" style="cursor:pointer; clear: both; height:95px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px;">' +
						 		  '<a class="UploadFile" id="' +  m_iTotalYoutubeGdrive + 'ns" title="' + mcLang.Text('lang_rte_72',1) + '" href="' + URL + '" Xonclick="window.open(\'' + URL + '\', \'Dropbox\', \'width=750,height=600\')" style="float:left; width:295px; line-height:95px; height:95px; cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>&nbsp;&nbsp;' + sicon + '</a>' +
								  '<div style="float:right; width:25px; height:95px; line-height:95px;" id="' +  m_iTotalYoutubeGdrive + 'a" class="rteSharedFiles">' + sAction + '</div>' +
								  '</div>';
		
									//$("#divYoutubeGDriveFiles").children("div").remove();
			
			                    	fnRTEAppend('#divYoutubeGDriveFiles', sDropBoxHTML);
	
				   }else if ( doc.serviceId == 'maps' )
				   {
				   
				   			   	    m_iTotalMapsGdrive +=1;
			                    	m_iMapsGdriveAttach +=1;
			                    	
			                    	if ( fnRTEElementExists('#divMapsGDrive') == 0 )
			                    	{
			                       		fnUpdateRTEText( fnGetRTEText() + '<div ondragstart="return false;" id="divMapsGDrive" style="color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11.5px;"><br>&nbsp;&nbsp;<img src="' + m_sRessIMGURL + 'basic2-056.png"  style="vertical-align: middle; height:24px; width:24px;">&nbsp;&nbsp;Google Maps:<div id="divMapsGDriveFiles" style="padding:5px; width:326px"></div></div>' );
			                    		fnRTEDisableSelect('#divMapsGDrive');
			                    	}
													
									sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveMapsGDrive(\'' + m_iTotalMapsGdrive + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle"/>';
	
	
									//addressLines:{ 0:Jeddah, 1:Saudi Arabia}
									NAME = doc.addressLines[0] + ', ' + doc.addressLines[1];
									if (NAME.length > 30)
										f_sFileName = NAME.substr(0, 30) + '...';
									else
										f_sFileName = NAME
				
				
									sicon = '<img src="' + doc.thumbnails['3'].url + '" align="absMiddle" style="border:0px; vertical-align:middle;" width="120"  height="90">&nbsp;&nbsp;' + f_sFileName;
	
				   				  // sDropBoxHTML= '<iframe width="212" height="175" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="' + doc.embedUrl + '"></iframe><br /><small><a href="' + doc.url + '">View Larger Map</a></small>';
		
		
								  sDropBoxHTML= '<div contenteditable="false" id="att_Mapsgdrive' + m_iTotalMapsGdrive + '" style="cursor:pointer; clear: both; height:95px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px;">' +
						 		  '<a class="UploadFile" id="' +  m_iTotalMapsGdrive + 'ns"  href="' + URL + '" Xonclick="window.open(\'' + URL + '\', \'Dropbox\', \'width=750,height=600\')" style="float:left; width:295px; line-height:95px; height:95px; cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:95px; text-align:right; display:none">&nbsp;&nbsp;</div>&nbsp;&nbsp;' + sicon + '</a>' +
								  '<div style="float:right; width:25px; height:95px; line-height:95px;" id="' +  m_iTotalMapsGdrive + 'a" class="rteSharedFiles">' + sAction + '</div>' +
								  '</div>';
	
									//$("#divMapsGDriveFiles").children("div").remove();
			                    	fnRTEAppend('#divMapsGDriveFiles', sDropBoxHTML);
				   }
				   else
				   {
		      	                    m_iTotalGdrive +=1;
			                    	m_iGdriveAttach +=1;
			                    	
			                    	if ( fnRTEElementExists('#divGDrive') == 0 )
			                    	{
			                       		fnUpdateRTEText( fnGetRTEText() + '<div ondragstart="return false;" id="divGDrive" style="color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11.5px;"><br>&nbsp;&nbsp;<img src="' + m_sRessIMGURL + 'gdrive.png"  style="vertical-align: middle; height:17px; width:18px;">&nbsp;<b>Google Drive</b> ' + m_sSharedFiles + ':<div id="divGDriveFiles" style="padding:5px; width:326px"></div></div>' );
			                    		fnRTEDisableSelect('#divGDrive');
			                    	}
													
									sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveGDrive(\'' + m_iTotalGdrive + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle"/>';
									
									sDropBoxHTML= '<div contenteditable="false" id="att_gdrive' + m_iTotalGdrive + '" style="cursor:pointer; clear: both; height:27px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px;">' +
						 		  '<a class="UploadFile" id="' +  m_iTotalGdrive + 'ns"  href="' + URL + '" Xonclick="window.open(\'' + URL + '\', \'Dropbox\', \'width=500,height=500\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>&nbsp;&nbsp;' + ShowFileIcon(NAME,30,'') + '</a>' +
								  '<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalGdrive + 'a" class="rteSharedFiles">' + sAction + '</div>' +
								  '</div>';
		
									//$("#divGDriveFiles").children("div").remove();
			                    	fnRTEAppend('#divGDriveFiles', sDropBoxHTML);
			         }
	
	 			}
	      
	}


	function fnAddGoogle(serviceId, serviceType, URL, NAME, MIME_TYPE, TYPE, ICON_URL, THUMBNAILS, DOCID)
	{

				   if ( (serviceId == 'youtube') || ( (serviceId == 'search-api') && (serviceType == 'video') ) )
				   {
				   	      	        m_iTotalYoutubeGdrive +=1;
			                    	m_iYoutubeGdriveAttach +=1;
			                    	
			                    	if ( fnRTEElementExists('#divYoutubeGDrive') == 0 )
			                    	{
			                       		fnUpdateRTEText( fnGetRTEText() + '<div id="divYoutubeGDrive" style="color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11.5px;"><br>&nbsp;&nbsp;<img src="' + m_sAttachShareImgURL + '/app/ress/theme/V12/IMG/youtube_small_20.png"  style="vertical-align: middle; height:20px; width:55px;">&nbsp; ' + m_sSharedVideos + ':<div id="divYoutubeGDriveFiles" style="padding:5px; width:326px"></div></div>' );
			                    		fnRTEDisableSelect('#divYoutubeGDrive');
			                    	}
													
									sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveYoutubeGDrive(\'' + m_iTotalYoutubeGdrive + '\')" title="' + mcLang.Text('lang_rte_71',1) + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle"/>';
									
									if (NAME.length > 30)
										f_sFileName = NAME.substr(0, 30) + '...';
									else
										f_sFileName = NAME
				
									sicon = '<img src="' + THUMBNAILS + '" align="absMiddle" style="border:0px; vertical-align:middle;" width="120"  height="90">&nbsp;&nbsp;' + f_sFileName;
										
									URL = 'http://www.youtube.com/watch?v=' + DOCID;
						
									sDropBoxHTML= '<div contenteditable="false" id="att_Youtubegdrive' + m_iTotalYoutubeGdrive + '" style="cursor:pointer; clear: both; height:95px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px;">' +
						 		  '<a class="UploadFile" id="' +  m_iTotalYoutubeGdrive + 'ns" title="' + mcLang.Text('lang_rte_72',1) + '" href="' + URL + '" Xonclick="window.open(\'' + URL + '\', \'Dropbox\', \'width=750,height=600\')" style="float:left; width:295px; line-height:95px; height:95px; cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>&nbsp;&nbsp;' + sicon + '</a>' +
								  '<div style="float:right; width:25px; height:95px; line-height:95px;" id="' +  m_iTotalYoutubeGdrive + 'a" class="rteSharedFiles">' + sAction + '</div>' +
								  '</div>';
		
									//$("#divYoutubeGDriveFiles").children("div").remove();
			
			                    	fnRTEAppend('#divYoutubeGDriveFiles', sDropBoxHTML);
	
				   }else if ( serviceId == 'maps' )
				   {
				   
				   			   	    m_iTotalMapsGdrive +=1;
			                    	m_iMapsGdriveAttach +=1;
			                    	
			                    	if ( fnRTEElementExists('#divMapsGDrive') == 0 )
			                    	{
			                       		fnUpdateRTEText( fnGetRTEText() + '<div ondragstart="return false;" id="divMapsGDrive" style="color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11.5px;"><br>&nbsp;&nbsp;<img src="' + m_sRessIMGURL + 'basic2-056.png"  style="vertical-align: middle; height:24px; width:24px;">&nbsp;&nbsp;Google Maps:<div id="divMapsGDriveFiles" style="padding:5px; width:326px"></div></div>' );
			                    		fnRTEDisableSelect('#divMapsGDrive');
			                    	}
													
									sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveMapsGDrive(\'' + m_iTotalMapsGdrive + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle"/>';
	
	
									//addressLines:{ 0:Jeddah, 1:Saudi Arabia}
									NAME = doc.addressLines[0] + ', ' + doc.addressLines[1];
									if (NAME.length > 30)
										f_sFileName = NAME.substr(0, 30) + '...';
									else
										f_sFileName = NAME
				
				
									sicon = '<img src="' + doc.thumbnails['3'].url + '" align="absMiddle" style="border:0px; vertical-align:middle;" width="120"  height="90">&nbsp;&nbsp;' + f_sFileName;
	
				   				  // sDropBoxHTML= '<iframe width="212" height="175" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="' + doc.embedUrl + '"></iframe><br /><small><a href="' + doc.url + '">View Larger Map</a></small>';
		
		
								  sDropBoxHTML= '<div contenteditable="false" id="att_Mapsgdrive' + m_iTotalMapsGdrive + '" style="cursor:pointer; clear: both; height:95px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px;">' +
						 		  '<a class="UploadFile" id="' +  m_iTotalMapsGdrive + 'ns"  href="' + URL + '" Xonclick="window.open(\'' + URL + '\', \'Dropbox\', \'width=750,height=600\')" style="float:left; width:295px; line-height:95px; height:95px; cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:95px; text-align:right; display:none">&nbsp;&nbsp;</div>&nbsp;&nbsp;' + sicon + '</a>' +
								  '<div style="float:right; width:25px; height:95px; line-height:95px;" id="' +  m_iTotalMapsGdrive + 'a" class="rteSharedFiles">' + sAction + '</div>' +
								  '</div>';
	
									//$("#divMapsGDriveFiles").children("div").remove();
			                    	fnRTEAppend('#divMapsGDriveFiles', sDropBoxHTML);
				   }
				   else
				   {
		      	                    m_iTotalGdrive +=1;
			                    	m_iGdriveAttach +=1;
			                    	
			                    	if ( fnRTEElementExists('#divGDrive') == 0 )
			                    	{
			                       		fnUpdateRTEText( fnGetRTEText() + '<div ondragstart="return false;" id="divGDrive" style="color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11.5px;"><br>&nbsp;&nbsp;<img src="' + m_sRessIMGURL + 'gdrive.png"  style="vertical-align: middle; height:17px; width:18px;">&nbsp;<b>Google Drive</b> ' + m_sSharedFiles + ':<div id="divGDriveFiles" style="padding:5px; width:326px"></div></div>' );
			                    		fnRTEDisableSelect('#divGDrive');
			                    	}
													
									sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveGDrive(\'' + m_iTotalGdrive + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle"/>';
									
									sDropBoxHTML= '<div contenteditable="false" id="att_gdrive' + m_iTotalGdrive + '" style="cursor:pointer; clear: both; height:27px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px;">' +
						 		  '<a class="UploadFile" id="' +  m_iTotalGdrive + 'ns"  href="' + URL + '" Xonclick="window.open(\'' + URL + '\', \'Dropbox\', \'width=500,height=500\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>&nbsp;&nbsp;' + ShowFileIcon(NAME,30,'') + '</a>' +
								  '<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalGdrive + 'a" class="rteSharedFiles">' + sAction + '</div>' +
								  '</div>';
		
									//$("#divGDriveFiles").children("div").remove();
			                    	fnRTEAppend('#divGDriveFiles', sDropBoxHTML);
			         }


	
	}





	
	//////////////////////////////// BOX.com
	var m_BoxfilePicker = null;
	
	function fnOpenBox()
	{

		if ( m_BoxfilePicker == null )
		{
			var m_Boxoptions = {
					clientId: 'cp3jky9puo05oyv8k8bxsdhs61tnjpcw',
					linkType: 'shared', //gives permanent link
					mulitselect: 'false'
			};
	
			m_BoxfilePicker = new BoxSelect(m_Boxoptions);
			
			//Success callback handler
			m_BoxfilePicker.success(function(response){ //if a file is successfully picked
					//console.log(response);
					
					for (var i = 0; i < response.length; i++) {
							sURL = response[i].url; //URL of file
							sName = response[i].name; //Name of file
						
						fnAddBoxPic(sName, sURL)
						console.log(sURL);
					};
					
			});
	
			//Fail callback handler
			m_BoxfilePicker.cancel(function(){ //When file picker is closed
					console.log("The user clicked close or X");
			});
		
		}

	
		//Launch popup
		m_BoxfilePicker.launchPopup();

	
	}
	
	function fnAddBoxPic(sName, sURL)
	{           	             											
		var sShareID = 'S' + guid();
		                    											
		sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveSharedPic(\'' + sShareID + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle;"/>';
								
		sName = sName.split('/');
		sName = sName[sName.length - 1]
					
		sDropBoxHTML= '<div ondragstart="return false;" contenteditable="false" id="' + sShareID + '" style="cursor:pointer; clear: both; height:54px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px; margin-top:8px; width:326px">' +
					  '<a class="UploadFile" id="' +  sShareID + 'ns"  href="' + sURL + '" Xonclick="window.open(\'' + sURL + '\', \'Dropbox\', \'width=1050,height=850\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>' +
					  '<img src="' + m_sRessIMGURL + 'box_icon.png"  style="vertical-align: middle; height:24px; width:24px;">&nbsp;<b>Box</b> ' + m_sSharedPictures + ':<br>&nbsp;&nbsp;' + ShowFileIcon(sName,30,'') + '</a>' +
					  '<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalTumblr + 'a" class="rteSharedFiles">' + sAction + '</div>' +
					  '</div>';
	
		fnUpdateRTEText( fnGetRTEText() + sDropBoxHTML );
		fnRTEDisableSelect('#' + sShareID);	

	}
	////////////////////////////////
	
	////////////////////////////////
	var m_sTumblr_name = '';
	
	function fnOpenTumblr()
	{
		sURL = 'http' + m_sHTTPS + '://' + location.hostname + '/tumblrshare/' 
		var w = 800;
		var h = 500;
		var title = 'Tumblr';
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
		window.open(sURL, title, 'toolbar=no, location=yes, directories=no, status=yes, menubar=no, scrollbars=yes, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
	}
	
	function fnAddTumblrPic(sName, sURL)
	{				
		var sShareID = 'S' + guid();
		                    											
		sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveSharedPic(\'' + sShareID + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle;"/>';
								
		sName = sName.split('/');
		sName = sName[sName.length - 1]
					
		sDropBoxHTML= '<div ondragstart="return false;" contenteditable="false" id="' + sShareID + '" style="cursor:pointer; clear: both; height:54px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px; margin-top:8px; width:326px">' +
					  '<a class="UploadFile" id="' +  sShareID + 'ns"  href="' + sURL + '" Xonclick="window.open(\'' + sURL + '\', \'Dropbox\', \'width=1050,height=850\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>' +
					  '<img src="' + m_sRessIMGURL + 'tumblr-24.png"  style="vertical-align: middle; height:24px; width:24px;">&nbsp;<b>Tumblr</b> ' + m_sSharedPictures + ':<br>&nbsp;&nbsp;' + ShowFileIcon(sName,30,'') + '</a>' +
					  '<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalTumblr + 'a" class="rteSharedFiles">' + sAction + '</div>' +
					  '</div>';
	
		fnUpdateRTEText( fnGetRTEText() + sDropBoxHTML );
		fnRTEDisableSelect('#' + sShareID);	
	}
	//////////////////////////////////////
	
	
	function fnRemoveSharedPic(sID)
	{
		fnRTEDelete('#' + sID);
			
	}

	
	
	////////////////////////////////
	var m_sTwitter_name = '';
	
	function fnOpenTwitter()
	{
		sURL = 'http://' + location.hostname + '/twitter/'
		var w = 926;
		var h = 562;
		var title = 'Twitter';
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
		window.open(sURL, title, 'toolbar=no, location=yes, directories=no, status=yes, menubar=no, scrollbars=yes, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
	}
	
	function fnAddTwitterPic(sName, sURL)
	{
		var sShareID = 'S' + guid();
		                    											
		sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveSharedPic(\'' + sShareID + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle;"/>';
								
		sName = sName.split('/');
		sName = sName[sName.length - 1]
					
		sDropBoxHTML= '<div ondragstart="return false;" contenteditable="false" id="' + sShareID + '" style="cursor:pointer; clear: both; height:54px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px; margin-top:8px; width:326px">' +
					  '<a class="UploadFile" id="' +  sShareID + 'ns"  href="' + sURL + '" Xonclick="window.open(\'' + sURL + '\', \'Dropbox\', \'width=1050,height=850\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>' +
					  '<img src="' + m_sRessIMGURL + 'twitter-24.png"  style="vertical-align: middle; height:24px; width:24px;">&nbsp;<b>Twitter</b> ' + m_sSharedPictures + ':<br>&nbsp;&nbsp;' + ShowFileIcon(sName,30,'') + '</a>' +
					  '<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalTumblr + 'a" class="rteSharedFiles">' + sAction + '</div>' +
					  '</div>';
	
		fnUpdateRTEText( fnGetRTEText() + sDropBoxHTML );
		fnRTEDisableSelect('#' + sShareID);	
	}
	//////////////////////////////////////


	//////////////////////////////// Amazon CLOUD
	var m_sAmazon_name = '';
	
	function fnOpenAmazon()
	{
	
		var client_id = 'amzn1.application-oa2-client.5e4ea4b4d2464feeb4f902236f291a17';
		var scope = 'clouddrive:read';
		var response_type = 'token';
		var redirect_uri = 'http' + m_sHTTPS + '://' + location.hostname + '/v12_kam/amazon/amazoncd.html';
		var sURL = 'https://www.amazon.com/ap/oa?client_id=' + client_id + '&scope=' + scope + '&response_type=' + response_type + '&redirect_uri=' + redirect_uri; //use variables

		var w = 926;
		var h = 562;
		var title = 'Amazon';
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
		window.open(sURL, title, 'toolbar=no, location=yes, directories=no, status=yes, menubar=no, scrollbars=yes, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
	}
	
	function fnAddAmazonPic(sName, sURL)
	{
		var sShareID = 'S' + guid();
		                    											
		sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveSharedPic(\'' + sShareID + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle;"/>';
								
		sName = sName.split('/');
		sName = sName[sName.length - 1]
					
		sDropBoxHTML= '<div ondragstart="return false;" contenteditable="false" id="' + sShareID + '" style="cursor:pointer; clear: both; height:54px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px; margin-top:8px; width:326px">' +
					  '<a class="UploadFile" id="' +  sShareID + 'ns"  href="' + sURL + '" Xonclick="window.open(\'' + sURL + '\', \'Dropbox\', \'width=1050,height=850\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>' +
					  '<img src="' + m_sRessIMGURL + 'Amazon_drive.png"  style="vertical-align: middle; height:24px; width:24px;">&nbsp;<b>Amazon Cloud Drive</b> ' + m_sSharedPictures + ':<br>&nbsp;&nbsp;' + ShowFileIcon(sName,30,'') + '</a>' +
					  '<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalTumblr + 'a" class="rteSharedFiles">' + sAction + '</div>' +
					  '</div>';
	
		fnUpdateRTEText( fnGetRTEText() + sDropBoxHTML );
		fnRTEDisableSelect('#' + sShareID);	
	}
		//////////////////////////////////////	
	
	//////////////////////////////// flickr
	var m_sflickr_name = '';
	
	function fnOpenflickr()
	{
		var sURL = 'http' + m_sHTTPS + '://' + location.hostname + '/v12_kam/flickr/flickro.html';
		var w = 926;
		var h = 562;
		var title = 'flickr';
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
		window.open(sURL, title, 'toolbar=no, location=yes, directories=no, status=yes, menubar=no, scrollbars=yes, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
	}
	
	function fnAddflickrPic(sName, sURL)
	{
		var sShareID = 'S' + guid();
		                    											
		sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveSharedPic(\'' + sShareID + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle;"/>';
								
		sName = sName.split('/');
		sName = sName[sName.length - 1]
					
		sDropBoxHTML= '<div ondragstart="return false;" contenteditable="false" id="' + sShareID + '" style="cursor:pointer; clear: both; height:54px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px; margin-top:8px; width:326px">' +
					  '<a class="UploadFile" id="' +  sShareID + 'ns"  href="' + sURL + '" Xonclick="window.open(\'' + sURL + '\', \'Dropbox\', \'width=1050,height=850\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>' +
					  '<img src="' + m_sRessIMGURL + '44-flickr-24.png"  style="vertical-align: middle; height:24px; width:24px;">&nbsp;<b>flickr</b> ' + m_sSharedPictures + ':<br>&nbsp;&nbsp;' + ShowFileIcon(sName,30,'') + '</a>' +
					  '<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalTumblr + 'a" class="rteSharedFiles">' + sAction + '</div>' +
					  '</div>';
	
		fnUpdateRTEText( fnGetRTEText() + sDropBoxHTML );
		fnRTEDisableSelect('#' + sShareID);	
	}
	//////////////////////////////////////	
	
	
	/////
	function fnOpenFacebook()
	{
		sURL = 'https://www.facebook.com/dialog/oauth?response_type=token&display=popup&client_id=603525479657644&redirect_uri=http' + m_sHTTPS + '://' + location.hostname + '/facebook/&scope=user_photos' 
		var w = 800;
		var h = 500;
		var title = 'Tumblr';
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
		window.open(sURL, title, 'toolbar=no, location=yes, directories=no, status=yes, menubar=no, scrollbars=yes, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
	}
	
	function fnAddFacebookPic(sName, sURL, iWidth, iHeight)
	{
		var sShareID = 'S' + guid();
		                    											
		sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveSharedPic(\'' + sShareID + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle;"/>';
								
		sName = sName.split('/');
		sName = sName[sName.length - 1]
					
		sDropBoxHTML= '<div ondragstart="return false;" contenteditable="false" id="' + sShareID + '" style="cursor:pointer; clear: both; height:54px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px; margin-top:8px; width:326px">' +
					  '<a class="UploadFile" id="' +  sShareID + 'ns"  href="' + sURL + '" Xonclick="window.open(\'' + sURL + '\', \'Dropbox\', \'toolbar=no, scrollbars=no, width=' + iWidth + ',height=' + iHeight + '\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>' +
					  '<img src="' + m_sRessIMGURL + 'facebook-3-24.png"  style="vertical-align: middle; height:24px; width:24px;">&nbsp;<b>Facebook</b> ' + m_sSharedPictures + ':<br>&nbsp;&nbsp;' + ShowFileIcon(sName,30,'') + '</a>' +
					  '<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalTumblr + 'a" class="rteSharedFiles">' + sAction + '</div>' +
					  '</div>';
	
		fnUpdateRTEText( fnGetRTEText() + sDropBoxHTML );
		fnRTEDisableSelect('#' + sShareID);		
	}
	
	function fnOpenInstagram()
	{
		/*
		$("#dialog").dialog({
		    autoOpen: true,
		    modal: true,
		    height: 300,
		    width: 700,
		    open: function(ev, ui){
		             $('#myIframe').attr('src','https://instagram.com/oauth/authorize/?client_id=698fb2ea90a848ae883673f65d8f632a&redirect_uri=http://' + location.hostname + '/instagramshare/&response_type=token');
		          }
		});
		$( "#dialog" ).dialog("option","title","new title");
		*/
		
		sURL = 'https://instagram.com/oauth/authorize/?client_id=' + m_aInstagramClient_id + '&redirect_uri=http' + m_sHTTPS + '://' + location.hostname + '/instagramshare/&response_type=token'
		//window.open(sURL, "InstagramPOP", "width=500,height=500");
		
		var w = 800;
		var h = 500;
		var title = 'Instagram';
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
		window.open(sURL, title, 'toolbar=no, location=yes, directories=no, status=yes, menubar=no, scrollbars=yes, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
	
	}
	
	function fnAddInstagramPic(sName, sURL)
	{
		var sShareID = 'S' + guid();
		                    											
		sAction = '&nbsp;<img src="' + m_sRessIMGURL + 'close_16.png" class="cssRemoveShare" onclick="parent.fnRemoveSharedPic(\'' + sShareID + '\')" title="' + top.m_sRemoveLangvar + '" style="height:16px; width:16px; cursor:pointer; vertical-align: middle;"/>';
								
		sName = sName.split('/');
		sName = sName[sName.length - 1]
					
		sDropBoxHTML= '<div ondragstart="return false;" contenteditable="false" id="' + sShareID + '" style="cursor:pointer; clear: both; height:54px; color:#535353; font-family: Arial, Helvetica, sans-serif; FONT-SIZE: 11px; background-color:#F4F4F4; -webkit-border-radius: 4px; -moz-border-radius: 4px; padding-left:5px; margin-bottom:8px; margin-top:8px; width:326px">' +
					  '<a class="UploadFile" id="' +  sShareID + 'ns"  href="' + sURL + '" Xonclick="window.open(\'' + sURL + '\', \'Dropbox\', \'width=1050,height=850\')" style="float:left; width:295px; line-height:24px;cursor:pointer; text-decoration:none !important; color:#535353"><div style="float:left; width:40px; line-height:24px; text-align:right; display:none">&nbsp;&nbsp;</div>' +
					  '<img src="' + m_sRessIMGURL + 'instagram.png"  style="vertical-align: middle; height:19px; width:18px;">&nbsp;<b>Instagram</b> ' + m_sSharedPictures + ':<br>&nbsp;&nbsp;' + ShowFileIcon(sName,30,'') + '</a>' +
					  '<div style="float:right; width:25px; line-height:22px;" id="' +  m_iTotalTumblr + 'a" class="rteSharedFiles">' + sAction + '</div>' +
					  '</div>';
	
		fnUpdateRTEText( fnGetRTEText() + sDropBoxHTML );
		fnRTEDisableSelect('#' + sShareID);	

	}
		
	
	function popupwindow(url, title, w, h) 
	{
	  var left = (screen.width/2)-(w/2);
	  var top = (screen.height/2)-(h/2);
	  return window.open(url, title, 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
	}
	////////////////////////////////
	
	
	
	function fnRemoveYoutubeGDrive(sID)
	{
		fnRTEDelete('#att_Youtubegdrive'+ sID);
		m_iYoutubeGdriveAttach -=1;
		
		if (m_iYoutubeGdriveAttach == 0)
		{
			fnRTEDelete('#divYoutubeGDrive');
			m_iTotalYoutubeGdrive = 0;
		}
	
	}
	
	function fnRemoveMapsGDrive(sID)
	{
		fnRTEDelete('#att_Mapsgdrive'+ sID);
		m_iMapsGdriveAttach -=1;
		
		if (m_iMapsGdriveAttach == 0)
		{
			fnRTEDelete('#divMapsGDrive');
			m_iTotalMapsGdrive = 0;
		}
	
	}
	
	
	function fnRemoveGDrive(sID)
	{
		fnRTEDelete('#att_gdrive'+ sID);
		m_iGdriveAttach -=1;
		
		if (m_iGdriveAttach == 0)
		{
			fnRTEDelete('#divGDrive');
			m_iTotalGdrive = 0;
		}
	
	}
	
	
	function fnRemoveDropbox(sID)
	{
		fnRTEDelete('#att_dropbox'+ sID);
		m_iDropboxAttach -=1;
		
		if (m_iDropboxAttach == 0)
		{
			fnRTEDelete('#divDropbox');
			m_iTotalDropbox = 0;
		}
	
	}
	
	var m_iTotalYoutubeGdrive =0;
	var m_iYoutubeGdriveAttach =0;
	
	




     	
     	var m_iRTEScrollPos = 0;
     	
     	function fnUpdateRTEScrollPos(iScrollPos)
     	{
     		m_iRTEScrollPos = iScrollPos;
     	}

		function fnSetRTEColor(sColor, sAction)
		{
			var m_selection;
		   	if (document.selection)
		   	{
				m_selection = document.getElementById(m_iframeId).contentWindow.document.selection.createRange();
				document.getElementById(m_iframeId).contentWindow.document.body.focus();
		    }
			else
			    m_selection =document.getElementById(m_iframeId).contentWindow.document;
		
			m_selection.execCommand(sAction, false, sColor);
		  
		}
		
				
		function fnRTEClear()
		{
			if ($.browser.name == "Xmsie") 
			{
				$('#RichEditIFrameID').contents().find('body').html('');
				$('#RichEditIFrameID').contents().find('body').html('<div style="padding:10px"><div class="rteDiv"></div></div>');
			}
			else
			{
				$('#RichEditIFrameID').contents().find('body').html('<div class="rteDiv"></div>');
				//$('#RichEditIFrameID').contents().find('body').css('padding', '10px')
			}
		}

		
		function fnRTERemoveHTML()
		{

			var sMessage = mcLang.Text('lang_rte_77',0);
			sMessage = sMessage.replace(/_xxbreaklinexx_/gi, "\n\n");


			var action_
			action_ = confirm(sMessage);
			if (!action_)
				return;

			var myContent1;
			var myContent2;

			sMsgBody = $('#RichEditIFrameID').contents().find('body').html();
			sMsgBody = sMsgBody.split('<div origmsg="yes"></div>');

			if ( sMsgBody.length > 1 )
			{
				myContent1 = '<div>' + sMsgBody[0] + '</div>';
				myContent2 = '<div>' + sMsgBody[1] + '</div>';
				
				myContent1 = myContent1.replace(/<br>/gi, "<br>\n");
            	myContent1= myContent1.replace(/<\/p>/g,'</p>\n\n');
            	myContent1= myContent1.replace(/<\/div>/g,'</div>\n\n');
            	myContent1= myContent1.replace(/<\/tr>/g,'</tr>\n\n');
				myContent1= myContent1.replace(/<\/table>/g,'</table>\n\n');
				
				myContent2 = myContent2.replace(/<br>/gi, "<br>\n");
            	myContent2 = myContent2.replace(/<\/p>/g,'</p>\n');
            	//myContent2 = myContent2.replace(/<\/div>/g,'</div>\n');
            	//myContent2 = myContent2.replace(/<\/tr>/g,'</tr>\n');
				//myContent2 = myContent2.replace(/<\/table>/g,'</table>\n');
				
				myContent1 = $("<div/>").html(myContent1).text(); //$(myContent1).text();
				myContent2 = $("<div/>").html(myContent2).text(); //$(myContent2).text();

				myContent1 = stringreplace(myContent1, "\n", "<br>");
				myContent2 = stringreplace(myContent2, "\n", "<br>");
				
				sMsgBody = myContent1 + '<br> <div origmsg="yes"></div>' +myContent2;
				
			}
			else
			{
				myContent1 = '<div>' + sMsgBody[0] + '</div>';
				
				
				myContent1 = myContent1.replace(/<br>/gi, "<br>\n");
            	myContent1= myContent1.replace(/<\/p>/g,'</p>\n\n');
            	myContent1= myContent1.replace(/<\/div>/g,'</div>\n\n');
            	myContent1= myContent1.replace(/<\/tr>/g,'</tr>\n\n');
				myContent1= myContent1.replace(/<\/table>/g,'</table>\n\n');

				myContent1 = $("<div/>").html(myContent1).text();  //$(myContent1).text();
				
				myContent1 = stringreplace(myContent1, "\n", "<br>");
				sMsgBody = myContent1; 
			}
				
			$('#RichEditIFrameID').contents().find('body').html(sMsgBody);
		
			//textContent
		}
		
		function fnRTEAddSig(sRTESig)
		{
		
			sRTESig = '<div style="margin-top:2px; margin-bottom:2px">' + unescape(sRTESig) + '</div>';
			
			sMsgBody = $('#RichEditIFrameID').contents().find('body').html();
			sMsgBody = sMsgBody.split('<div origmsg="yes"></div>');
			if ( sMsgBody.length > 1 )
				sMsgBody = sMsgBody[0] + sRTESig + '<div origmsg="yes"></div>' + sMsgBody[1];
			else
				sMsgBody = sMsgBody[0] + sRTESig
				
			$('#RichEditIFrameID').contents().find('body').html(sMsgBody);
		
		}
		
		
		function saveSelection() {
		    if (window.getSelection) {
		        sel = window.getSelection();
		        if (sel.getRangeAt && sel.rangeCount) {
		            var ranges = [];
		            for (var i = 0, len = sel.rangeCount; i < len; ++i) {
		                ranges.push(sel.getRangeAt(i));
		            }
		            return ranges;
		        }
		    } else if (document.selection && document.selection.createRange) {
		        return document.selection.createRange();
		    }
		    return null;
		}
		
		function restoreSelection(savedSel) {
		    if (savedSel) {
		        if (window.getSelection) {
		            sel = window.getSelection();
		            sel.removeAllRanges();
		            for (var i = 0, len = savedSel.length; i < len; ++i) {
		                sel.addRange(savedSel[i]);
		            }
		        } else if (document.selection && savedSel.select) {
		            savedSel.select();
		        }
		    }
		}

		
		
		function fnRTEAddEmotoicon(strEmoticon)
		{
			if (mQuickRTEOpen)
			{
				fnQuickRTEAddEmotoicon(strEmoticon);
				return;
			}
			
			document.getElementById(m_iframeId).contentWindow.focus();
			
			if (document.selection)
        	{
		    	m_selection = document.getElementById(m_iframeId).contentWindow.document.selection.createRange();
		    	document.getElementById(m_iframeId).contentWindow.document.body.focus();
        	}

   			var emoticonTitle = strEmoticon.substring(strEmoticon.lastIndexOf("/")+1);
   			var image = '<img src="' + strEmoticon + '" alt="' + emoticonTitle + '" />';
   			insertHTML(image, m_iframeId);
   			
   			//cmdExec(); 
   			
   			//document.getElementById(m_iframeId).contentWindow.document.execCommand("InsertImage", false, image);
		
		}


		function pasteHtmlAtCaret(html, selectPastedContent) {
		    var sel, range;
		    if (window.getSelection) {
		        // IE9 and non-IE
		        sel = window.getSelection();
		        if (sel.getRangeAt && sel.rangeCount) {
		            range = sel.getRangeAt(0);
		            range.deleteContents();
		
		            // Range.createContextualFragment() would be useful here but is
		            // only relatively recently standardized and is not supported in
		            // some browsers (IE9, for one)
		            var el = document.createElement("div");
		            el.innerHTML = html;
		            var frag = document.createDocumentFragment(), node, lastNode;
		            while ( (node = el.firstChild) ) {
		                lastNode = frag.appendChild(node);
		            }
		            var firstNode = frag.firstChild;
		            range.insertNode(frag);
		            
		            // Preserve the selection
		            if (lastNode) {
		                range = range.cloneRange();
		                range.setStartAfter(lastNode);
		                if (selectPastedContent) {
		                    range.setStartBefore(firstNode);
		                } else {
		                    range.collapse(true);
		                }
		                sel.removeAllRanges();
		                sel.addRange(range);
		            }
		        }
		    } else if ( (sel = document.selection) && sel.type != "Control") {
		        // IE < 9
		        var originalRange = sel.createRange();
		        originalRange.collapse(true);
		        sel.createRange().pasteHTML(html);
		        if (selectPastedContent) {
		            range = sel.createRange();
		            range.setEndPoint("StartToStart", originalRange);
		            range.select();
		        }
		    }
		}

		function fnQuickRTEAddEmotoicon(strEmoticon)
		{
			$('#rte_QuickT').focus();
			
   			var emoticonTitle = strEmoticon.substring(strEmoticon.lastIndexOf("/")+1);
   			var image = '<img src="' + strEmoticon + '" alt="' + emoticonTitle + '" />';
   			pasteHtmlAtCaret(image, false);
   			fnTimeResizeQuickRTE();
   			
		
		}

		function fnQuickResponses(iIndex)
		{
		
			$('#rte_QuickT').html('');
			$('#RTE_QuickBActions').height('');
			$('#rte_QuickT').height('');

		
			$('#rte_QuickT').focus();
			pasteHtmlAtCaret( $('#sGRDMT' + iIndex).text() , false)
			fnTimeResizeQuickRTE();
		}
		
		function fnRTEAddImage(strEmoticon)
		{
			document.getElementById(m_iframeId).contentWindow.focus();
			
			if (document.selection)
        	{
		    	m_selection = document.getElementById(m_iframeId).contentWindow.document.selection.createRange();
		    	document.getElementById(m_iframeId).contentWindow.document.body.focus();
        	}

   			var image = '<img src="' + strEmoticon + '"  />';
   			insertHTML(image, m_iframeId);
   					
		}

		
		function fnCleartMsgBtn() 
		{
		
			if (!fnIsRTEEmpty())
			{
		
				if ( fnYUIPrompt('<div>' + mcLang.Text('lang_mail_85',1) + '</div>', mcLang.Text('lang_Gen_13',1), mcLang.Text('lang_Gen_14',1), 'message icon-bubble', fnClearRTE, arguments) )
					return;
			}
		
		}
		
		function fnClearRTE()
		{
			fnRTEClose();
			QComposer('n');
		}
		
		function fnRTEUpdateFont(sFontType)
		{
		
			document.getElementById(m_iframeId).contentWindow.focus();
			if (document.selection)
        	{
		    	m_selection = document.getElementById(m_iframeId).contentWindow.document.selection.createRange();
		    	document.getElementById(m_iframeId).contentWindow.document.body.focus();
        	}

		
			formatText('FontName','xml_TextBody',sFontType);
		}
		
		function fnRTEUpdateFontSize(sSize)
		{
		
			document.getElementById(m_iframeId).contentWindow.focus();
			if (document.selection)
        	{
		    	m_selection = document.getElementById(m_iframeId).contentWindow.document.selection.createRange();
		    	document.getElementById(m_iframeId).contentWindow.document.body.focus();
        	}

			formatText('FontSize','xml_TextBody',sSize)
		}

		
		function fnRTEInsertLink()
		{		
			if (document.selection)
			 {
				m_selection = document.getElementById(m_iframeId).contentWindow.document.selection.createRange();
				document.getElementById(m_iframeId).contentWindow.document.body.focus();
			 }
			else
				m_selection = document.getElementById(m_iframeId).contentWindow.document;
				
			sURLDropMenu = '<select size="1" style="font-size:13.5px" id="RTEurl">' +
			'<option value="http://">http://</option>' +
			'<option value="https://">https://</option>' +
			'<option value="ftp://">ftp://</option>' +
			'<option value="ftps://">ftps://</option>' +
			'<option value=""></option>' +
			'</select>';
			
			//////
			
			var $f = $("#RichEditIFrameID"); 
			$f[0].contentWindow.fnSaveSelection();  //works
			//$f.get(0).contentWindow.MyFunction(); //works
			////
			
			//check for HTTP:// FTTP:// ... etc
			var sSelectedText = '';
			var sURLLink = '';
			sSelectedText = $f[0].contentWindow.getSelectedText() + '';
			sURLLink = sSelectedText;
			
			if ( sSelectedText.split("://").length > 1 )
			{
				sSelectedText = sSelectedText.split("://")[1];
			}
			else
			{
				sURLLink = 'http://' + sURLLink ;
			}
			

			
			
			var sHTML = '<table cellpadding="4">' +
						'	<tr>' +
						'		<td style="white-space: nowrap; text-align: left; font-size:16px !important" colspan="2">' + m_sInsertLinkMenu + '</td>' +
						'	</tr>' +
						'	<tr>' +
						'		<td style="white-space: nowrap; text-align: right">' + m_sInsertLinkTextMenu  + ':&nbsp;&nbsp;</td>' +
						'		<td style="white-space: nowrap"><input id="txtInsertLinkText" value="' + sSelectedText + '" type="text" " style="border:0px; border-bottom:1px #E1E1E1 solid; color:#708194; font-size:16px !important" /></td>' +
						'	</tr>' +
						'	<tr>' +
						'		<td style="white-space: nowrap; text-align: right">' + m_sInsertLinkURLMenu + ':&nbsp;&nbsp;</td>' +
						'		<td style="white-space: nowrap"><input id="txtInsertLink" value="' + sURLLink + '" type="text" onkeydown="fnInsertURLKeyboard(event)" style="border:0px; border-bottom:1px #E1E1E1 solid; color:#708194; font-size:16px !important" /></td>' +
						'	</tr>' +
						'</table>';
			fnYUIGeneralDialog(sHTML , mcLang.Text('lang_trans_12',1), mcLang.Text('lang_rte_67',1), 'icon-none')
		}


		function fnRTEImagePicker()
		{		
			
			var sHTML = '<table cellpadding="4">' +
						'	<tr>' +
						'		<td style="white-space: nowrap; text-align: left; font-size:16px !important" colspan="2">' + m_sInsertImageMenu + '</td>' +
						'	</tr>' +
						'	<tr>' +
						'		<td style="white-space: nowrap; text-align: right">' + m_sInsertImageMenuURL + ':&nbsp;&nbsp;</td>' +
						'		<td style="white-space: nowrap"><input id="txtInsertImgURL" value="http://" type="text" " style="border:0px; border-bottom:1px #E1E1E1 solid; color:#708194; font-size:16px !important" /></td>' +
						'	</tr>' +
						'</table>';
			fnYUIInsertImglDialog(sHTML , mcLang.Text('lang_trans_12',1), mcLang.Text('lang_rte_67',1), 'icon-none')
		}

		
		//:::::::
		//:::::::	
		function fnInsertURLKeyboard(evt)
		{
			evt = (evt) ? evt : event;
			var charCode = (evt.charCode) ? evt.charCode :
				((evt.which) ? evt.which : evt.keyCode);
			
			//enter
			if (charCode == 13) {
			
				mYUIdialog.onCancel(evt);
			}
		}
		
		function fnInsertURL(sURLText, sURL)
		{
  			document.getElementById(m_iframeId).contentWindow.focus();
			if (document.selection)
        	{
		    	m_selection = document.getElementById(m_iframeId).contentWindow.document.selection.createRange();
		    	document.getElementById(m_iframeId).contentWindow.document.body.focus();
        	}
        	
        	/*
        	var $f = $("#RichEditIFrameID");
        	sSelectedText = $f[0].contentWindow.getSelectedText() + '';
        	if ( sSelectedText.length == 0 )
        		sSelectedText = sURL;
        	*/
        	
        	var sHTML = '<a href="' + sURL + '" target="_top" class="linkLine">' + sURLText + '</a>';
        	
        	if ( $.browser.name == "chrome" )
        	{
        	var iframe_window = window.frames["RichEditIFrameID"];
			iframe_window.focus();
			iframe_window.contentDocument.body.focus(); 
			}
        	
   			insertHTML(sHTML, m_iframeId);

		}
		
		//:::::::
		//:::::::
		function fnGetSignature()
		{
		
			var sURL = '../../app/signature_rte.asp';
		    var obj_callback = new clsAjaxcallback();    
		    obj_callback.Ajaxcallback.success = fSignatureModule;
		    makeRequest(sURL, obj_callback.Ajaxcallback);
		}

		//:::::::
		//:::::::	
		function fnRTEShowTranslate() 
		{
			fnShowPOPOpt('rteTranslatebtn', 'mRTETranslate', -390,5);
		}
		
		var m_bGotSignData = false;
		//:::::::
		//:::::::	
		function fSignatureModule(o) 
		{
			if (m_bGotSignData)
			{
				fnShowPOPOpt('rteAddSigbtn', 'mRTESignPicker', -390,5);
				return;
			}
			
			document.getElementById('mRTESignPicker').innerHTML = '';

		    
		    var iTotalValidSign = 0;
		    
			if(o.responseText !== undefined)
		    {
				var sHTTPData = o.responseText; 
		        o = null;
		         
		        sHTTPData = sHTTPData.split('*_*-*_*');
		        var HTMLSig = '';
		    
		        for (var i=0; i < (sHTTPData.length - 1); i++)
		        {
		        	sHTTPData[i] = sHTTPData[i].trim();
		        	
		        	if ((sHTTPData[i]).length > 2)
		        		iTotalValidSign += 1; 
		        	
		        	sHTTPData[i] = sHTTPData[i].replace(/script/gi, " script ");

		        	document.getElementById('mRTESignPicker').innerHTML += '<div class="rtemultiSig" onclick="fnRTEAddSig(this.innerHTML)" style="font-family:sans-serif !important; font-size:small; max-height:100px; overflow:hidden; width:390px; padding-top:10px; padding-bottom:10px; cursor:pointer">' + sHTTPData[i] + '<div>';
		        	
		        	if ( (i+1) < (sHTTPData.length - 1) )
		        		document.getElementById('mRTESignPicker').innerHTML += '<div class="MSLine"></div>';
		        }
		        
		        if (iTotalValidSign == 0)
		        {
		        	UpdateInboxAlert(m_sBlankSignature);
		        	return;
		        }
		        
		        
		        if (sHTTPData.length > 0)
		        { 
					
					$('.rtemultiSig').mouseenter(function() {
  						$(this).css("background-color", "#E5E5E5");
					});
					
					$('.rtemultiSig').mouseleave(function() {
  						$(this).css("background-color", "");
					});

		        	fnShowPOPOpt('rteAddSigbtn', 'mRTESignPicker', -390,5);
		        	m_bGotSignData = true;
		        }
		        		        
			}
		
		}
		
		function fnRTEFullScreen(bMinimized)
		{
		

			if(bMinimized)
			{

				fnRTEMaximize();
			}
		
			/*
			if ( m_sUsername != 'kabed' )
			{
				UpdateInboxAlert('Full-screen feature is in progress.', '1359077142_info_16.png');
				return;
			}
			*/
			
			if (m_bFullScreen == false)
			{		
				m_bFullScreen = true;
				$('#rte_fullscreen').attr('src', m_sRessIMGURL + 'exit_fullscreen.png');
				$('#rte_fullscreen').attr('title', m_sCloseFullView);
				$("#raptor-wrapper-fullscreen").css( "display", "" );
				$( "#raptor-wrapper" ).removeClass( "RTEShadowbox" );
				$( "#raptor-wrapper" ).addClass( "MsgpreFullscreen" );
			}
			else
			{
				m_bFullScreen = false;
				$('#rte_fullscreen').attr('src', m_sRessIMGURL + 'fullscreen.png');
				$('#rte_fullscreen').attr('title', m_sOpenFullView);
				$("#raptor-wrapper-fullscreen").css( "display", "none" );
				$( "#raptor-wrapper" ).removeClass( "MsgpreFullscreen" );
				$( "#raptor-wrapper" ).addClass( "RTEShadowbox" ); 
			}
			
		
	    	$(".jqTootltip").tipTip();

			
			fnResizeRTE();
			
			
			$("#raptor-wrapper").css( {'display' : 'none'} )
			$("#raptor-wrapper").fadeIn( 0, function() { fnResizeRTE() });
			
			
		}
		
		function fnExitRTEFullScreen()
		{
			fnRTEFullScreen(false);	
			$("#raptor-wrapper-fullscreen").css( "display", "none" );
				
		}
		
		function fnRTESelectTrans(iIndex)
		{
			$('#rdbRTETranslate' + iIndex).prop( "checked", true);	
		}
		
		
		function fnRTEUpdate()
		{
			//console.log('m_bRTEUpdate:' + m_bRTEUpdate);
			m_bRTEUpdate = true;
			
		}
/*
 * zClip :: jQuery ZeroClipboard v1.1.1
 * http://steamdev.com/zclip
 *
 * Copyright 2011, SteamDev
 * Released under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Date: Wed Jun 01, 2011
 */

(function(a){a.fn.zclip=function(c){if(typeof c=="object"&&!c.length){var b=a.extend({path:"ZeroClipboard.swf",copy:null,beforeCopy:null,afterCopy:null,clickAfter:true,setHandCursor:true,setCSSEffects:true},c);return this.each(function(){var e=a(this);if(e.is(":visible")&&(typeof b.copy=="string"||a.isFunction(b.copy))){ZeroClipboard.setMoviePath(b.path);var d=new ZeroClipboard.Client();if(a.isFunction(b.copy)){e.bind("zClip_copy",b.copy)}if(a.isFunction(b.beforeCopy)){e.bind("zClip_beforeCopy",b.beforeCopy)}if(a.isFunction(b.afterCopy)){e.bind("zClip_afterCopy",b.afterCopy)}d.setHandCursor(b.setHandCursor);d.setCSSEffects(b.setCSSEffects);d.addEventListener("mouseOver",function(f){e.trigger("mouseenter")});d.addEventListener("mouseOut",function(f){e.trigger("mouseleave")});d.addEventListener("mouseDown",function(f){e.trigger("mousedown");if(!a.isFunction(b.copy)){d.setText(b.copy)}else{d.setText(e.triggerHandler("zClip_copy"))}if(a.isFunction(b.beforeCopy)){e.trigger("zClip_beforeCopy")}});d.addEventListener("complete",function(f,g){if(a.isFunction(b.afterCopy)){e.trigger("zClip_afterCopy")}else{if(g.length>500){g=g.substr(0,500)+"...\n\n("+(g.length-500)+" characters not shown)"}e.removeClass("hover");alert("Copied text to clipboard:\n\n "+g)}if(b.clickAfter){e.trigger("click")}});d.glue(e[0],e.parent()[0]);a(window).bind("load resize",function(){d.reposition()})}})}else{if(typeof c=="string"){return this.each(function(){var f=a(this);c=c.toLowerCase();var e=f.data("zclipId");var d=a("#"+e+".zclip");if(c=="remove"){d.remove();f.removeClass("active hover")}else{if(c=="hide"){d.hide();f.removeClass("active hover")}else{if(c=="show"){d.show()}}}})}}}})(jQuery);var ZeroClipboard={version:"1.0.7",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(a){if(typeof(a)=="string"){a=document.getElementById(a)}if(!a.addClass){a.hide=function(){this.style.display="none"};a.show=function(){this.style.display=""};a.addClass=function(b){this.removeClass(b);this.className+=" "+b};a.removeClass=function(d){var e=this.className.split(/\s+/);var b=-1;for(var c=0;c<e.length;c++){if(e[c]==d){b=c;c=e.length}}if(b>-1){e.splice(b,1);this.className=e.join(" ")}return this};a.hasClass=function(b){return !!this.className.match(new RegExp("\\s*"+b+"\\s*"))}}return a},setMoviePath:function(a){this.moviePath=a},dispatch:function(d,b,c){var a=this.clients[d];if(a){a.receiveEvent(b,c)}},register:function(b,a){this.clients[b]=a},getDOMObjectPosition:function(c,a){var b={left:0,top:0,width:c.width?c.width:c.offsetWidth,height:c.height?c.height:c.offsetHeight};if(c&&(c!=a)){b.left+=c.offsetLeft;b.top+=c.offsetTop}return b},Client:function(a){this.handlers={};this.id=ZeroClipboard.nextId++;this.movieId="ZeroClipboardMovie_"+this.id;ZeroClipboard.register(this.id,this);if(a){this.glue(a)}}};ZeroClipboard.Client.prototype={id:0,ready:false,movie:null,clipText:"",handCursorEnabled:true,cssEffects:true,handlers:null,glue:function(d,b,e){this.domElement=ZeroClipboard.$(d);var f=99;if(this.domElement.style.zIndex){f=parseInt(this.domElement.style.zIndex,10)+1}if(typeof(b)=="string"){b=ZeroClipboard.$(b)}else{if(typeof(b)=="undefined"){b=document.getElementsByTagName("body")[0]}}var c=ZeroClipboard.getDOMObjectPosition(this.domElement,b);this.div=document.createElement("div");this.div.className="zclip";this.div.id="zclip-"+this.movieId;$(this.domElement).data("zclipId","zclip-"+this.movieId);var a=this.div.style;a.position="absolute";a.left=""+c.left+"px";a.top=""+c.top+"px";a.width=""+c.width+"px";a.height=""+c.height+"px";a.zIndex=f;if(typeof(e)=="object"){for(addedStyle in e){a[addedStyle]=e[addedStyle]}}b.appendChild(this.div);this.div.innerHTML=this.getHTML(c.width,c.height)},getHTML:function(d,a){var c="";var b="id="+this.id+"&width="+d+"&height="+a;if(navigator.userAgent.match(/MSIE/)){var e=location.href.match(/^https/i)?"https://":"http://";c+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+e+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+d+'" height="'+a+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+b+'"/><param name="wmode" value="transparent"/></object>'}else{c+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+d+'" height="'+a+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+b+'" wmode="transparent" />'}return c},hide:function(){if(this.div){this.div.style.left="-2000px"}},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide();this.div.innerHTML="";var a=document.getElementsByTagName("body")[0];try{a.removeChild(this.div)}catch(b){}this.domElement=null;this.div=null}},reposition:function(c){if(c){this.domElement=ZeroClipboard.$(c);if(!this.domElement){this.hide()}}if(this.domElement&&this.div){var b=ZeroClipboard.getDOMObjectPosition(this.domElement);var a=this.div.style;a.left=""+b.left+"px";a.top=""+b.top+"px"}},setText:function(a){this.clipText=a;if(this.ready){this.movie.setText(a)}},addEventListener:function(a,b){a=a.toString().toLowerCase().replace(/^on/,"");if(!this.handlers[a]){this.handlers[a]=[]}this.handlers[a].push(b)},setHandCursor:function(a){this.handCursorEnabled=a;if(this.ready){this.movie.setHandCursor(a)}},setCSSEffects:function(a){this.cssEffects=!!a},receiveEvent:function(d,f){d=d.toString().toLowerCase().replace(/^on/,"");switch(d){case"load":this.movie=document.getElementById(this.movieId);if(!this.movie){var c=this;setTimeout(function(){c.receiveEvent("load",null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var c=this;setTimeout(function(){c.receiveEvent("load",null)},100);this.ready=true;return}this.ready=true;try{this.movie.setText(this.clipText)}catch(h){}try{this.movie.setHandCursor(this.handCursorEnabled)}catch(h){}break;case"mouseover":if(this.domElement&&this.cssEffects){this.domElement.addClass("hover");if(this.recoverActive){this.domElement.addClass("active")}}break;case"mouseout":if(this.domElement&&this.cssEffects){this.recoverActive=false;if(this.domElement.hasClass("active")){this.domElement.removeClass("active");this.recoverActive=true}this.domElement.removeClass("hover")}break;case"mousedown":if(this.domElement&&this.cssEffects){this.domElement.addClass("active")}break;case"mouseup":if(this.domElement&&this.cssEffects){this.domElement.removeClass("active");this.recoverActive=false}break}if(this.handlers[d]){for(var b=0,a=this.handlers[d].length;b<a;b++){var g=this.handlers[d][b];if(typeof(g)=="function"){g(this,f)}else{if((typeof(g)=="object")&&(g.length==2)){g[0][g[1]](this,f)}else{if(typeof(g)=="string"){window[g](this,f)}}}}}}};